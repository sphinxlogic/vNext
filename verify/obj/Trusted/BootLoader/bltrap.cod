; Listing generated by Microsoft (R) Optimizing Compiler Version 14.00.50727.762 

	TITLE	D:\OSes\VERVE\verify\src\Trusted\BootLoader\SingLdrPc\bltrap.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?BlIdtr@@3U_IDTR@@A				; BlIdtr
PUBLIC	?BlIdt@@3PAU_IDTE@@A				; BlIdt
_BSS	SEGMENT
?BlIdtr@@3U_IDTR@@A DT 01H DUP (?)			; BlIdtr
	ALIGN	8

?BlIdt@@3PAU_IDTE@@A DQ 020H DUP (?)			; BlIdt
_BSS	ENDS
PUBLIC	?BlTrapEnable@@YIXXZ				; BlTrapEnable
EXTRN	?BlTrapSetIdtr@@YIXPAU_IDTR@@@Z:PROC		; BlTrapSetIdtr
EXTRN	?BlTrapEnter@@YIXXZ:PROC			; BlTrapEnter
EXTRN	__aullshr:PROC
; Function compile flags: /Odtp
; File d:\oses\verve\verify\src\trusted\bootloader\singldrpc\bltrap.cpp
;	COMDAT ?BlTrapEnable@@YIXXZ
_TEXT	SEGMENT
_Enter$3281 = -16					; size = 8
_i$3277 = -4						; size = 4
?BlTrapEnable@@YIXXZ PROC				; BlTrapEnable, COMDAT

; 29   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 10	 sub	 esp, 16			; 00000010H
  00006	56		 push	 esi

; 30   :     for (UINT32 i = 0; i < ARRAY_SIZE(BlIdt); i++) {

  00007	c7 45 fc 00 00
	00 00		 mov	 DWORD PTR _i$3277[ebp], 0
  0000e	eb 09		 jmp	 SHORT $LN3@BlTrapEnab
$LN2@BlTrapEnab:
  00010	8b 45 fc	 mov	 eax, DWORD PTR _i$3277[ebp]
  00013	83 c0 01	 add	 eax, 1
  00016	89 45 fc	 mov	 DWORD PTR _i$3277[ebp], eax
$LN3@BlTrapEnab:
  00019	83 7d fc 20	 cmp	 DWORD PTR _i$3277[ebp], 32 ; 00000020H
  0001d	73 7a		 jae	 SHORT $LN1@BlTrapEnab

; 31   : 
; 32   :         UINT64 Enter = ((UINT64)BlTrapEnter) + i * 8;

  0001f	b8 00 00 00 00	 mov	 eax, OFFSET ?BlTrapEnter@@YIXXZ ; BlTrapEnter
  00024	99		 cdq
  00025	8b 4d fc	 mov	 ecx, DWORD PTR _i$3277[ebp]
  00028	c1 e1 03	 shl	 ecx, 3
  0002b	33 f6		 xor	 esi, esi
  0002d	03 c1		 add	 eax, ecx
  0002f	13 d6		 adc	 edx, esi
  00031	89 45 f0	 mov	 DWORD PTR _Enter$3281[ebp], eax
  00034	89 55 f4	 mov	 DWORD PTR _Enter$3281[ebp+4], edx

; 33   : 
; 34   :         BlIdt[i].Offset0To15  =(UINT16)((Enter >>  0) & 0xffff);

  00037	8b 55 f0	 mov	 edx, DWORD PTR _Enter$3281[ebp]
  0003a	81 e2 ff ff 00
	00		 and	 edx, 65535		; 0000ffffH
  00040	8b 45 f4	 mov	 eax, DWORD PTR _Enter$3281[ebp+4]
  00043	83 e0 00	 and	 eax, 0
  00046	8b 4d fc	 mov	 ecx, DWORD PTR _i$3277[ebp]
  00049	66 89 14 cd 00
	00 00 00	 mov	 WORD PTR ?BlIdt@@3PAU_IDTE@@A[ecx*8], dx

; 35   :         BlIdt[i].Offset16To31 = (UINT16)((Enter >> 16) & 0xffff);

  00051	8b 45 f0	 mov	 eax, DWORD PTR _Enter$3281[ebp]
  00054	8b 55 f4	 mov	 edx, DWORD PTR _Enter$3281[ebp+4]
  00057	b1 10		 mov	 cl, 16			; 00000010H
  00059	e8 00 00 00 00	 call	 __aullshr
  0005e	25 ff ff 00 00	 and	 eax, 65535		; 0000ffffH
  00063	83 e2 00	 and	 edx, 0
  00066	8b 55 fc	 mov	 edx, DWORD PTR _i$3277[ebp]
  00069	66 89 04 d5 06
	00 00 00	 mov	 WORD PTR ?BlIdt@@3PAU_IDTE@@A[edx*8+6], ax

; 36   : #if defined(BOOT_X64)
; 37   :         BlIdt[i].Selector = LM_CODE_SELECTOR;
; 38   : #else
; 39   :         BlIdt[i].Selector = PM_CODE_SELECTOR;

  00071	8b 45 fc	 mov	 eax, DWORD PTR _i$3277[ebp]
  00074	66 c7 04 c5 02
	00 00 00 20 00	 mov	 WORD PTR ?BlIdt@@3PAU_IDTE@@A[eax*8+2], 32 ; 00000020H

; 40   : #endif
; 41   :         BlIdt[i].Flags = 0;

  0007e	8b 4d fc	 mov	 ecx, DWORD PTR _i$3277[ebp]
  00081	c6 04 cd 04 00
	00 00 00	 mov	 BYTE PTR ?BlIdt@@3PAU_IDTE@@A[ecx*8+4], 0

; 42   :         BlIdt[i].Access = 0x8e;

  00089	8b 55 fc	 mov	 edx, DWORD PTR _i$3277[ebp]
  0008c	c6 04 d5 05 00
	00 00 8e	 mov	 BYTE PTR ?BlIdt@@3PAU_IDTE@@A[edx*8+5], 142 ; 0000008eH

; 43   : 
; 44   : #if defined(BOOT_X64)
; 45   :         BlIdt[i].Offset32To63 = (UINT32)((Enter >> 32) & 0xffffffff);
; 46   : #endif
; 47   : 
; 48   :     }

  00094	e9 77 ff ff ff	 jmp	 $LN2@BlTrapEnab
$LN1@BlTrapEnab:

; 49   :     BlIdtr.Limit = 32 * 8;

  00099	66 c7 05 00 00
	00 00 00 01	 mov	 WORD PTR ?BlIdtr@@3U_IDTR@@A, 256 ; 00000100H

; 50   :     BlIdtr.Base = (UINT64)BlIdt;

  000a2	b8 00 00 00 00	 mov	 eax, OFFSET ?BlIdt@@3PAU_IDTE@@A ; BlIdt
  000a7	99		 cdq
  000a8	a3 02 00 00 00	 mov	 DWORD PTR ?BlIdtr@@3U_IDTR@@A+2, eax
  000ad	89 15 06 00 00
	00		 mov	 DWORD PTR ?BlIdtr@@3U_IDTR@@A+6, edx

; 51   : 
; 52   :     BlTrapSetIdtr(&BlIdtr);

  000b3	b9 00 00 00 00	 mov	 ecx, OFFSET ?BlIdtr@@3U_IDTR@@A ; BlIdtr
  000b8	e8 00 00 00 00	 call	 ?BlTrapSetIdtr@@YIXPAU_IDTR@@@Z ; BlTrapSetIdtr

; 53   : }

  000bd	5e		 pop	 esi
  000be	8b e5		 mov	 esp, ebp
  000c0	5d		 pop	 ebp
  000c1	c3		 ret	 0
?BlTrapEnable@@YIXXZ ENDP				; BlTrapEnable
_TEXT	ENDS
PUBLIC	??_C@_05HAJCMBLP@?5?$CF02x?$AA@			; `string'
PUBLIC	??_C@_05GOOEJNEL@?5?5?$CFp?3?$AA@		; `string'
PUBLIC	??_C@_0BA@MJDKEIPF@?5?5?$CFp?3?5?$CFp?5?$CFp?5?$CFp?6?$AA@ ; `string'
PUBLIC	??_C@_0BD@PPCAEFDO@?5?5?$CFp?3?5?$CFp?5?$CFp?5?$CFp?5?$CFp?6?$AA@ ; `string'
PUBLIC	??_C@_03GPDAHCCA@?5?$CFp?$AA@			; `string'
PUBLIC	??_C@_0M@IHNIDGFO@?5?5?$CFp?3?5?$CFp?5?$CFp?$AA@ ; `string'
PUBLIC	??_C@_07BHLOBMCB@?5?5?$CF8x?3?6?$AA@		; `string'
PUBLIC	??_C@_0ED@OFJMDAEI@?5?5?5?5?5Frame?3?5?5?5?5?5next?5?5?5return?5?5?5@ ; `string'
PUBLIC	??_C@_01EEMJAFIK@?6?$AA@			; `string'
PUBLIC	??_C@_0BP@FGJNIPMP@?5?5esp?$DN?$CFp?5ebp?$DN?$CFp?5esi?$DN?$CFp?5edi?$DN?$CFp?6?$AA@ ; `string'
PUBLIC	??_C@_0BP@NGFJDGBA@?5?5eax?$DN?$CFp?5ebx?$DN?$CFp?5ecx?$DN?$CFp?5edx?$DN?$CFp?6?$AA@ ; `string'
PUBLIC	??_C@_0CI@CGBDFPHM@?5?5eip?$DN?$CFp?5efl?$DN?$CFp?5cr2?$DN?$CFp?5cs?$DN?$CF2x?5nu@ ; `string'
PUBLIC	??_C@_0CE@DFHPAAJD@?6?$CK?$CK?$CK?5Fatal?5Trap?3?50x?$CF2x?3?$CFp?5?$FLerr?$DN?$CF@ ; `string'
PUBLIC	?BlTrapFatal@@YIXKPAU_BL_TRAP_CONTEXT@@@Z	; BlTrapFatal
EXTRN	?BlVideoPrintf@@YAEPBDZZ:PROC			; BlVideoPrintf
;	COMDAT ??_C@_05HAJCMBLP@?5?$CF02x?$AA@
CONST	SEGMENT
??_C@_05HAJCMBLP@?5?$CF02x?$AA@ DB ' %02x', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_05GOOEJNEL@?5?5?$CFp?3?$AA@
CONST	SEGMENT
??_C@_05GOOEJNEL@?5?5?$CFp?3?$AA@ DB '  %p:', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0BA@MJDKEIPF@?5?5?$CFp?3?5?$CFp?5?$CFp?5?$CFp?6?$AA@
CONST	SEGMENT
??_C@_0BA@MJDKEIPF@?5?5?$CFp?3?5?$CFp?5?$CFp?5?$CFp?6?$AA@ DB '  %p: %p %'
	DB	'p %p', 0aH, 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0BD@PPCAEFDO@?5?5?$CFp?3?5?$CFp?5?$CFp?5?$CFp?5?$CFp?6?$AA@
CONST	SEGMENT
??_C@_0BD@PPCAEFDO@?5?5?$CFp?3?5?$CFp?5?$CFp?5?$CFp?5?$CFp?6?$AA@ DB '  %'
	DB	'p: %p %p %p %p', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_03GPDAHCCA@?5?$CFp?$AA@
CONST	SEGMENT
??_C@_03GPDAHCCA@?5?$CFp?$AA@ DB ' %p', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0M@IHNIDGFO@?5?5?$CFp?3?5?$CFp?5?$CFp?$AA@
CONST	SEGMENT
??_C@_0M@IHNIDGFO@?5?5?$CFp?3?5?$CFp?5?$CFp?$AA@ DB '  %p: %p %p', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_07BHLOBMCB@?5?5?$CF8x?3?6?$AA@
CONST	SEGMENT
??_C@_07BHLOBMCB@?5?5?$CF8x?3?6?$AA@ DB '  %8x:', 0aH, 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0ED@OFJMDAEI@?5?5?5?5?5Frame?3?5?5?5?5?5next?5?5?5return?5?5?5@
CONST	SEGMENT
??_C@_0ED@OFJMDAEI@?5?5?5?5?5Frame?3?5?5?5?5?5next?5?5?5return?5?5?5@ DB ' '
	DB	'    Frame:     next   return     arg0     arg1     arg2     a'
	DB	'rg3', 0aH, 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_01EEMJAFIK@?6?$AA@
CONST	SEGMENT
??_C@_01EEMJAFIK@?6?$AA@ DB 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BP@FGJNIPMP@?5?5esp?$DN?$CFp?5ebp?$DN?$CFp?5esi?$DN?$CFp?5edi?$DN?$CFp?6?$AA@
CONST	SEGMENT
??_C@_0BP@FGJNIPMP@?5?5esp?$DN?$CFp?5ebp?$DN?$CFp?5esi?$DN?$CFp?5edi?$DN?$CFp?6?$AA@ DB ' '
	DB	' esp=%p ebp=%p esi=%p edi=%p', 0aH, 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0BP@NGFJDGBA@?5?5eax?$DN?$CFp?5ebx?$DN?$CFp?5ecx?$DN?$CFp?5edx?$DN?$CFp?6?$AA@
CONST	SEGMENT
??_C@_0BP@NGFJDGBA@?5?5eax?$DN?$CFp?5ebx?$DN?$CFp?5ecx?$DN?$CFp?5edx?$DN?$CFp?6?$AA@ DB ' '
	DB	' eax=%p ebx=%p ecx=%p edx=%p', 0aH, 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0CI@CGBDFPHM@?5?5eip?$DN?$CFp?5efl?$DN?$CFp?5cr2?$DN?$CFp?5cs?$DN?$CF2x?5nu@
CONST	SEGMENT
??_C@_0CI@CGBDFPHM@?5?5eip?$DN?$CFp?5efl?$DN?$CFp?5cr2?$DN?$CFp?5cs?$DN?$CF2x?5nu@ DB ' '
	DB	' eip=%p efl=%p cr2=%p cs=%2x num=%02x', 0aH, 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0CE@DFHPAAJD@?6?$CK?$CK?$CK?5Fatal?5Trap?3?50x?$CF2x?3?$CFp?5?$FLerr?$DN?$CF@
CONST	SEGMENT
??_C@_0CE@DFHPAAJD@?6?$CK?$CK?$CK?5Fatal?5Trap?3?50x?$CF2x?3?$CFp?5?$FLerr?$DN?$CF@ DB 0aH
	DB	'*** Fatal Trap: 0x%2x:%p [err=%p]', 0aH, 00H ; `string'
; Function compile flags: /Odtp
CONST	ENDS
;	COMDAT ?BlTrapFatal@@YIXKPAU_BL_TRAP_CONTEXT@@@Z
_TEXT	SEGMENT
_Context$ = -44						; size = 4
_Trap$ = -40						; size = 4
_i$3337 = -36						; size = 4
_i$3329 = -32						; size = 4
_i$3323 = -28						; size = 4
_i$3315 = -24						; size = 4
_end$3310 = -20						; size = 4
_i$3300 = -16						; size = 4
_eip$ = -12						; size = 4
_esp$ = -8						; size = 4
_ebp$ = -4						; size = 4
?BlTrapFatal@@YIXKPAU_BL_TRAP_CONTEXT@@@Z PROC		; BlTrapFatal, COMDAT
; _Trap$ = ecx
; _Context$ = edx

; 73   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 2c	 sub	 esp, 44			; 0000002cH
  00006	89 55 d4	 mov	 DWORD PTR _Context$[ebp], edx
  00009	89 4d d8	 mov	 DWORD PTR _Trap$[ebp], ecx

; 74   :     BlVideoPrintf("\n*** Fatal Trap: 0x%2x:%p [err=%p]\n",
; 75   :                   Trap, Context, Context->Err);

  0000c	8b 45 d4	 mov	 eax, DWORD PTR _Context$[ebp]
  0000f	8b 48 28	 mov	 ecx, DWORD PTR [eax+40]
  00012	51		 push	 ecx
  00013	8b 55 d4	 mov	 edx, DWORD PTR _Context$[ebp]
  00016	52		 push	 edx
  00017	8b 45 d8	 mov	 eax, DWORD PTR _Trap$[ebp]
  0001a	50		 push	 eax
  0001b	68 00 00 00 00	 push	 OFFSET ??_C@_0CE@DFHPAAJD@?6?$CK?$CK?$CK?5Fatal?5Trap?3?50x?$CF2x?3?$CFp?5?$FLerr?$DN?$CF@
  00020	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  00025	83 c4 10	 add	 esp, 16			; 00000010H

; 76   : 
; 77   : #if defined(BOOT_X86)
; 78   : 
; 79   :     BlVideoPrintf("  eip=%p efl=%p cr2=%p cs=%2x num=%02x\n",
; 80   :                   Context->Eip, Context->Efl, Context->Cr2,
; 81   :                   (UINT32)Context->Cs0, (UINT32)Context->Num);

  00028	8b 4d d4	 mov	 ecx, DWORD PTR _Context$[ebp]
  0002b	8b 51 24	 mov	 edx, DWORD PTR [ecx+36]
  0002e	52		 push	 edx
  0002f	8b 45 d4	 mov	 eax, DWORD PTR _Context$[ebp]
  00032	8b 48 30	 mov	 ecx, DWORD PTR [eax+48]
  00035	51		 push	 ecx
  00036	8b 55 d4	 mov	 edx, DWORD PTR _Context$[ebp]
  00039	8b 02		 mov	 eax, DWORD PTR [edx]
  0003b	50		 push	 eax
  0003c	8b 4d d4	 mov	 ecx, DWORD PTR _Context$[ebp]
  0003f	8b 51 34	 mov	 edx, DWORD PTR [ecx+52]
  00042	52		 push	 edx
  00043	8b 45 d4	 mov	 eax, DWORD PTR _Context$[ebp]
  00046	8b 48 2c	 mov	 ecx, DWORD PTR [eax+44]
  00049	51		 push	 ecx
  0004a	68 00 00 00 00	 push	 OFFSET ??_C@_0CI@CGBDFPHM@?5?5eip?$DN?$CFp?5efl?$DN?$CFp?5cr2?$DN?$CFp?5cs?$DN?$CF2x?5nu@
  0004f	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  00054	83 c4 18	 add	 esp, 24			; 00000018H

; 82   :     BlVideoPrintf("  eax=%p ebx=%p ecx=%p edx=%p\n",
; 83   :                   Context->Eax, Context->Ebx, Context->Ecx, Context->Edx);

  00057	8b 55 d4	 mov	 edx, DWORD PTR _Context$[ebp]
  0005a	8b 42 14	 mov	 eax, DWORD PTR [edx+20]
  0005d	50		 push	 eax
  0005e	8b 4d d4	 mov	 ecx, DWORD PTR _Context$[ebp]
  00061	8b 51 18	 mov	 edx, DWORD PTR [ecx+24]
  00064	52		 push	 edx
  00065	8b 45 d4	 mov	 eax, DWORD PTR _Context$[ebp]
  00068	8b 48 1c	 mov	 ecx, DWORD PTR [eax+28]
  0006b	51		 push	 ecx
  0006c	8b 55 d4	 mov	 edx, DWORD PTR _Context$[ebp]
  0006f	8b 42 20	 mov	 eax, DWORD PTR [edx+32]
  00072	50		 push	 eax
  00073	68 00 00 00 00	 push	 OFFSET ??_C@_0BP@NGFJDGBA@?5?5eax?$DN?$CFp?5ebx?$DN?$CFp?5ecx?$DN?$CFp?5edx?$DN?$CFp?6?$AA@
  00078	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  0007d	83 c4 14	 add	 esp, 20			; 00000014H

; 84   :     BlVideoPrintf("  esp=%p ebp=%p esi=%p edi=%p\n",
; 85   :                   Context->Esp, Context->Ebp, Context->Esi, Context->Edi);

  00080	8b 4d d4	 mov	 ecx, DWORD PTR _Context$[ebp]
  00083	8b 51 0c	 mov	 edx, DWORD PTR [ecx+12]
  00086	52		 push	 edx
  00087	8b 45 d4	 mov	 eax, DWORD PTR _Context$[ebp]
  0008a	8b 48 10	 mov	 ecx, DWORD PTR [eax+16]
  0008d	51		 push	 ecx
  0008e	8b 55 d4	 mov	 edx, DWORD PTR _Context$[ebp]
  00091	8b 42 08	 mov	 eax, DWORD PTR [edx+8]
  00094	50		 push	 eax
  00095	8b 4d d4	 mov	 ecx, DWORD PTR _Context$[ebp]
  00098	8b 51 04	 mov	 edx, DWORD PTR [ecx+4]
  0009b	52		 push	 edx
  0009c	68 00 00 00 00	 push	 OFFSET ??_C@_0BP@FGJNIPMP@?5?5esp?$DN?$CFp?5ebp?$DN?$CFp?5esi?$DN?$CFp?5edi?$DN?$CFp?6?$AA@
  000a1	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  000a6	83 c4 14	 add	 esp, 20			; 00000014H

; 86   : 
; 87   :     ULONG_PTR * ebp = (ULONG_PTR *)Context->Ebp;

  000a9	8b 45 d4	 mov	 eax, DWORD PTR _Context$[ebp]
  000ac	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  000af	89 4d fc	 mov	 DWORD PTR _ebp$[ebp], ecx

; 88   :     BlVideoPrintf("\n");

  000b2	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6?$AA@
  000b7	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  000bc	83 c4 04	 add	 esp, 4

; 89   :     BlVideoPrintf("     Frame:     next   return     arg0     arg1     arg2     arg3\n");

  000bf	68 00 00 00 00	 push	 OFFSET ??_C@_0ED@OFJMDAEI@?5?5?5?5?5Frame?3?5?5?5?5?5next?5?5?5return?5?5?5@
  000c4	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  000c9	83 c4 04	 add	 esp, 4

; 90   :     for (int i = 0; i < 10; i++) {

  000cc	c7 45 f0 00 00
	00 00		 mov	 DWORD PTR _i$3300[ebp], 0
  000d3	eb 09		 jmp	 SHORT $LN20@BlTrapFata
$LN19@BlTrapFata:
  000d5	8b 55 f0	 mov	 edx, DWORD PTR _i$3300[ebp]
  000d8	83 c2 01	 add	 edx, 1
  000db	89 55 f0	 mov	 DWORD PTR _i$3300[ebp], edx
$LN20@BlTrapFata:
  000de	83 7d f0 0a	 cmp	 DWORD PTR _i$3300[ebp], 10 ; 0000000aH
  000e2	0f 8d b8 00 00
	00		 jge	 $LN18@BlTrapFata

; 91   :         if (ebp < (ULONG_PTR*)0x10000 || ebp > (ULONG_PTR*)0x7fffffff) {

  000e8	81 7d fc 00 00
	01 00		 cmp	 DWORD PTR _ebp$[ebp], 65536 ; 00010000H
  000ef	72 09		 jb	 SHORT $LN16@BlTrapFata
  000f1	81 7d fc ff ff
	ff 7f		 cmp	 DWORD PTR _ebp$[ebp], 2147483647 ; 7fffffffH
  000f8	76 16		 jbe	 SHORT $LN17@BlTrapFata
$LN16@BlTrapFata:

; 92   :             BlVideoPrintf("  %8x:\n", (ULONG_PTR)ebp);

  000fa	8b 45 fc	 mov	 eax, DWORD PTR _ebp$[ebp]
  000fd	50		 push	 eax
  000fe	68 00 00 00 00	 push	 OFFSET ??_C@_07BHLOBMCB@?5?5?$CF8x?3?6?$AA@
  00103	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  00108	83 c4 08	 add	 esp, 8

; 93   :             break;

  0010b	e9 90 00 00 00	 jmp	 $LN18@BlTrapFata
$LN17@BlTrapFata:

; 94   :         }
; 95   :         ULONG_PTR *end = (ULONG_PTR *)ebp[0];

  00110	8b 4d fc	 mov	 ecx, DWORD PTR _ebp$[ebp]
  00113	8b 11		 mov	 edx, DWORD PTR [ecx]
  00115	89 55 ec	 mov	 DWORD PTR _end$3310[ebp], edx

; 96   :         if (end < ebp) {

  00118	8b 45 ec	 mov	 eax, DWORD PTR _end$3310[ebp]
  0011b	3b 45 fc	 cmp	 eax, DWORD PTR _ebp$[ebp]
  0011e	73 09		 jae	 SHORT $LN15@BlTrapFata

; 97   :             end = ebp + 6;

  00120	8b 4d fc	 mov	 ecx, DWORD PTR _ebp$[ebp]
  00123	83 c1 18	 add	 ecx, 24			; 00000018H
  00126	89 4d ec	 mov	 DWORD PTR _end$3310[ebp], ecx
$LN15@BlTrapFata:

; 98   :         }
; 99   : 
; 100  :         BlVideoPrintf("  %p: %p %p",
; 101  :                       (ULONG_PTR)ebp, ebp[0], ebp[1]);

  00129	8b 55 fc	 mov	 edx, DWORD PTR _ebp$[ebp]
  0012c	8b 42 04	 mov	 eax, DWORD PTR [edx+4]
  0012f	50		 push	 eax
  00130	8b 4d fc	 mov	 ecx, DWORD PTR _ebp$[ebp]
  00133	8b 11		 mov	 edx, DWORD PTR [ecx]
  00135	52		 push	 edx
  00136	8b 45 fc	 mov	 eax, DWORD PTR _ebp$[ebp]
  00139	50		 push	 eax
  0013a	68 00 00 00 00	 push	 OFFSET ??_C@_0M@IHNIDGFO@?5?5?$CFp?3?5?$CFp?5?$CFp?$AA@
  0013f	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  00144	83 c4 10	 add	 esp, 16			; 00000010H

; 102  :         for (int i = 2; i < 6 && ebp + i < end; i++) {

  00147	c7 45 e8 02 00
	00 00		 mov	 DWORD PTR _i$3315[ebp], 2
  0014e	eb 09		 jmp	 SHORT $LN14@BlTrapFata
$LN13@BlTrapFata:
  00150	8b 4d e8	 mov	 ecx, DWORD PTR _i$3315[ebp]
  00153	83 c1 01	 add	 ecx, 1
  00156	89 4d e8	 mov	 DWORD PTR _i$3315[ebp], ecx
$LN14@BlTrapFata:
  00159	83 7d e8 06	 cmp	 DWORD PTR _i$3315[ebp], 6
  0015d	7d 27		 jge	 SHORT $LN12@BlTrapFata
  0015f	8b 55 e8	 mov	 edx, DWORD PTR _i$3315[ebp]
  00162	8b 45 fc	 mov	 eax, DWORD PTR _ebp$[ebp]
  00165	8d 0c 90	 lea	 ecx, DWORD PTR [eax+edx*4]
  00168	3b 4d ec	 cmp	 ecx, DWORD PTR _end$3310[ebp]
  0016b	73 19		 jae	 SHORT $LN12@BlTrapFata

; 103  :             BlVideoPrintf(" %p", ebp[i]);

  0016d	8b 55 e8	 mov	 edx, DWORD PTR _i$3315[ebp]
  00170	8b 45 fc	 mov	 eax, DWORD PTR _ebp$[ebp]
  00173	8b 0c 90	 mov	 ecx, DWORD PTR [eax+edx*4]
  00176	51		 push	 ecx
  00177	68 00 00 00 00	 push	 OFFSET ??_C@_03GPDAHCCA@?5?$CFp?$AA@
  0017c	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  00181	83 c4 08	 add	 esp, 8

; 104  :         }

  00184	eb ca		 jmp	 SHORT $LN13@BlTrapFata
$LN12@BlTrapFata:

; 105  :         BlVideoPrintf("\n");

  00186	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6?$AA@
  0018b	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  00190	83 c4 04	 add	 esp, 4

; 106  : 
; 107  :         ebp = (ULONG_PTR *)ebp[0];

  00193	8b 55 fc	 mov	 edx, DWORD PTR _ebp$[ebp]
  00196	8b 02		 mov	 eax, DWORD PTR [edx]
  00198	89 45 fc	 mov	 DWORD PTR _ebp$[ebp], eax

; 108  :     }

  0019b	e9 35 ff ff ff	 jmp	 $LN19@BlTrapFata
$LN18@BlTrapFata:

; 109  : 
; 110  :     BlVideoPrintf("\n");

  001a0	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6?$AA@
  001a5	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  001aa	83 c4 04	 add	 esp, 4

; 111  :     ULONG_PTR * esp = (ULONG_PTR *)(Context->Esp);

  001ad	8b 4d d4	 mov	 ecx, DWORD PTR _Context$[ebp]
  001b0	8b 51 04	 mov	 edx, DWORD PTR [ecx+4]
  001b3	89 55 f8	 mov	 DWORD PTR _esp$[ebp], edx

; 112  :     for (int i = 0; i < 6; i++) {

  001b6	c7 45 e4 00 00
	00 00		 mov	 DWORD PTR _i$3323[ebp], 0
  001bd	eb 09		 jmp	 SHORT $LN11@BlTrapFata
$LN10@BlTrapFata:
  001bf	8b 45 e4	 mov	 eax, DWORD PTR _i$3323[ebp]
  001c2	83 c0 01	 add	 eax, 1
  001c5	89 45 e4	 mov	 DWORD PTR _i$3323[ebp], eax
$LN11@BlTrapFata:
  001c8	83 7d e4 06	 cmp	 DWORD PTR _i$3323[ebp], 6
  001cc	7d 37		 jge	 SHORT $LN9@BlTrapFata

; 113  :         BlVideoPrintf("  %p: %p %p %p %p\n", esp, esp[0], esp[1], esp[2], esp[3]);

  001ce	8b 4d f8	 mov	 ecx, DWORD PTR _esp$[ebp]
  001d1	8b 51 0c	 mov	 edx, DWORD PTR [ecx+12]
  001d4	52		 push	 edx
  001d5	8b 45 f8	 mov	 eax, DWORD PTR _esp$[ebp]
  001d8	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  001db	51		 push	 ecx
  001dc	8b 55 f8	 mov	 edx, DWORD PTR _esp$[ebp]
  001df	8b 42 04	 mov	 eax, DWORD PTR [edx+4]
  001e2	50		 push	 eax
  001e3	8b 4d f8	 mov	 ecx, DWORD PTR _esp$[ebp]
  001e6	8b 11		 mov	 edx, DWORD PTR [ecx]
  001e8	52		 push	 edx
  001e9	8b 45 f8	 mov	 eax, DWORD PTR _esp$[ebp]
  001ec	50		 push	 eax
  001ed	68 00 00 00 00	 push	 OFFSET ??_C@_0BD@PPCAEFDO@?5?5?$CFp?3?5?$CFp?5?$CFp?5?$CFp?5?$CFp?6?$AA@
  001f2	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  001f7	83 c4 18	 add	 esp, 24			; 00000018H

; 114  :         esp += 4;

  001fa	8b 4d f8	 mov	 ecx, DWORD PTR _esp$[ebp]
  001fd	83 c1 10	 add	 ecx, 16			; 00000010H
  00200	89 4d f8	 mov	 DWORD PTR _esp$[ebp], ecx

; 115  :     }

  00203	eb ba		 jmp	 SHORT $LN10@BlTrapFata
$LN9@BlTrapFata:

; 116  :     BlVideoPrintf("\n");

  00205	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6?$AA@
  0020a	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  0020f	83 c4 04	 add	 esp, 4

; 117  : 
; 118  :     esp = (ULONG_PTR *)(Context);

  00212	8b 55 d4	 mov	 edx, DWORD PTR _Context$[ebp]
  00215	89 55 f8	 mov	 DWORD PTR _esp$[ebp], edx

; 119  :     for (int i = 0; i < 6; i++) {

  00218	c7 45 e0 00 00
	00 00		 mov	 DWORD PTR _i$3329[ebp], 0
  0021f	eb 09		 jmp	 SHORT $LN8@BlTrapFata
$LN7@BlTrapFata:
  00221	8b 45 e0	 mov	 eax, DWORD PTR _i$3329[ebp]
  00224	83 c0 01	 add	 eax, 1
  00227	89 45 e0	 mov	 DWORD PTR _i$3329[ebp], eax
$LN8@BlTrapFata:
  0022a	83 7d e0 06	 cmp	 DWORD PTR _i$3329[ebp], 6
  0022e	7d 37		 jge	 SHORT $LN6@BlTrapFata

; 120  :         BlVideoPrintf("  %p: %p %p %p\n", esp, esp[0], esp[1], esp[2], esp[3]);

  00230	8b 4d f8	 mov	 ecx, DWORD PTR _esp$[ebp]
  00233	8b 51 0c	 mov	 edx, DWORD PTR [ecx+12]
  00236	52		 push	 edx
  00237	8b 45 f8	 mov	 eax, DWORD PTR _esp$[ebp]
  0023a	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  0023d	51		 push	 ecx
  0023e	8b 55 f8	 mov	 edx, DWORD PTR _esp$[ebp]
  00241	8b 42 04	 mov	 eax, DWORD PTR [edx+4]
  00244	50		 push	 eax
  00245	8b 4d f8	 mov	 ecx, DWORD PTR _esp$[ebp]
  00248	8b 11		 mov	 edx, DWORD PTR [ecx]
  0024a	52		 push	 edx
  0024b	8b 45 f8	 mov	 eax, DWORD PTR _esp$[ebp]
  0024e	50		 push	 eax
  0024f	68 00 00 00 00	 push	 OFFSET ??_C@_0BA@MJDKEIPF@?5?5?$CFp?3?5?$CFp?5?$CFp?5?$CFp?6?$AA@
  00254	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  00259	83 c4 18	 add	 esp, 24			; 00000018H

; 121  :         esp += 4;

  0025c	8b 4d f8	 mov	 ecx, DWORD PTR _esp$[ebp]
  0025f	83 c1 10	 add	 ecx, 16			; 00000010H
  00262	89 4d f8	 mov	 DWORD PTR _esp$[ebp], ecx

; 122  :     }

  00265	eb ba		 jmp	 SHORT $LN7@BlTrapFata
$LN6@BlTrapFata:

; 123  : 
; 124  :     BlVideoPrintf("\n");

  00267	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6?$AA@
  0026c	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  00271	83 c4 04	 add	 esp, 4

; 125  :     UINT8 * eip = (UINT8 *)Context->Eip;

  00274	8b 55 d4	 mov	 edx, DWORD PTR _Context$[ebp]
  00277	8b 42 2c	 mov	 eax, DWORD PTR [edx+44]
  0027a	89 45 f4	 mov	 DWORD PTR _eip$[ebp], eax

; 126  :     BlVideoPrintf("  %p:", eip);

  0027d	8b 4d f4	 mov	 ecx, DWORD PTR _eip$[ebp]
  00280	51		 push	 ecx
  00281	68 00 00 00 00	 push	 OFFSET ??_C@_05GOOEJNEL@?5?5?$CFp?3?$AA@
  00286	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  0028b	83 c4 08	 add	 esp, 8

; 127  :     for (int i = 0; i < 12; i++) {

  0028e	c7 45 dc 00 00
	00 00		 mov	 DWORD PTR _i$3337[ebp], 0
  00295	eb 09		 jmp	 SHORT $LN5@BlTrapFata
$LN4@BlTrapFata:
  00297	8b 55 dc	 mov	 edx, DWORD PTR _i$3337[ebp]
  0029a	83 c2 01	 add	 edx, 1
  0029d	89 55 dc	 mov	 DWORD PTR _i$3337[ebp], edx
$LN5@BlTrapFata:
  002a0	83 7d dc 0c	 cmp	 DWORD PTR _i$3337[ebp], 12 ; 0000000cH
  002a4	7d 19		 jge	 SHORT $LN3@BlTrapFata

; 128  :         BlVideoPrintf(" %02x", eip[i]);

  002a6	8b 45 f4	 mov	 eax, DWORD PTR _eip$[ebp]
  002a9	03 45 dc	 add	 eax, DWORD PTR _i$3337[ebp]
  002ac	0f b6 08	 movzx	 ecx, BYTE PTR [eax]
  002af	51		 push	 ecx
  002b0	68 00 00 00 00	 push	 OFFSET ??_C@_05HAJCMBLP@?5?$CF02x?$AA@
  002b5	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  002ba	83 c4 08	 add	 esp, 8

; 129  :     }

  002bd	eb d8		 jmp	 SHORT $LN4@BlTrapFata
$LN3@BlTrapFata:

; 130  : 
; 131  :     BlVideoPrintf("\n");

  002bf	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6?$AA@
  002c4	e8 00 00 00 00	 call	 ?BlVideoPrintf@@YAEPBDZZ ; BlVideoPrintf
  002c9	83 c4 04	 add	 esp, 4
$LN2@BlTrapFata:

; 132  : 
; 133  : #elif defined(BOOT_X64)
; 134  : 
; 135  :     BlVideoPrintf("  rip=%p rfl=%p cs=%2x num=%02x\n",
; 136  :                   Context->Rip, Context->Rfl, (UINT32)Context->Cs0, (UINT32)Context->Num);
; 137  :     BlVideoPrintf("  rsp=%p rbp=%p cr2=%p\n",
; 138  :                   Context->Rsp, Context->Rbp, Context->Cr2);
; 139  :     BlVideoPrintf("  rax=%p rbx=%p rcx=%p\n",
; 140  :                   Context->Rax, Context->Rbx, Context->Rcx);
; 141  :     BlVideoPrintf("  rdx=%p rsi=%p rdi=%p\n",
; 142  :                   Context->Rdx, Context->Rsi, Context->Rdi);
; 143  :     BlVideoPrintf("  r08=%p r09=%p r10=%p\n",
; 144  :                   Context->R8, Context->R9, Context->R10);
; 145  :     BlVideoPrintf("  r11=%p r12=%p r13=%p\n",
; 146  :                   Context->R11, Context->R12, Context->R13);
; 147  :     BlVideoPrintf("  r14=%p r15=%p\n",
; 148  :                   Context->R14, Context->R15);
; 149  : 
; 150  :     ULONG_PTR * rbp = (ULONG_PTR *)Context->Rbp;
; 151  :     BlVideoPrintf("\n");
; 152  :     BlVideoPrintf("             Frame:             next           return             arg0\n");
; 153  :     for (int i = 0; i < 10; i++) {
; 154  :         if (rbp < (ULONG_PTR*)0x10000 || rbp > (ULONG_PTR*)0x7fffffff) {
; 155  :             BlVideoPrintf("  %p:\n", (ULONG_PTR)rbp);
; 156  :             break;
; 157  :         }
; 158  :         ULONG_PTR *end = (ULONG_PTR *)rbp[0];
; 159  :         if (end < rbp) {
; 160  :             end = rbp + 3;
; 161  :         }
; 162  : 
; 163  :         BlVideoPrintf("  %p: %p %p",
; 164  :                       (ULONG_PTR)rbp, rbp[0], rbp[1]);
; 165  :         for (int i = 2; i < 3 && rbp + i < end; i++) {
; 166  :             BlVideoPrintf(" %p", rbp[i]);
; 167  :         }
; 168  :         BlVideoPrintf("\n");
; 169  : 
; 170  :         rbp = (ULONG_PTR *)rbp[0];
; 171  :     }
; 172  : 
; 173  :     BlVideoPrintf("\n");
; 174  :     ULONG_PTR * rsp = (ULONG_PTR *)(Context->Rsp);
; 175  :     for (int i = 0; i < 6; i++) {
; 176  :         BlVideoPrintf("  %p: %p %p %p\n", rsp, rsp[0], rsp[1], rsp[2]);
; 177  :         rsp += 3;
; 178  :     }
; 179  :     BlVideoPrintf("\n");
; 180  : 
; 181  :     rsp = (ULONG_PTR *)(Context);
; 182  :     for (int i = 0; i < 6; i++) {
; 183  :         BlVideoPrintf("  %p: %p %p %p\n", rsp, rsp[0], rsp[1], rsp[2]);
; 184  :         rsp += 3;
; 185  :     }
; 186  : 
; 187  :     BlVideoPrintf("\n");
; 188  :     UINT8 * rip = (UINT8 *)Context->Rip;
; 189  :     BlVideoPrintf("  %p:", rip);
; 190  :     for (int i = 0; i < 12; i++) {
; 191  :         BlVideoPrintf(" %02x", rip[i]);
; 192  :     }
; 193  : 
; 194  :     BlVideoPrintf("\n");
; 195  : 
; 196  : #endif
; 197  : 
; 198  :     for (;;);

  002cc	eb fe		 jmp	 SHORT $LN2@BlTrapFata

; 199  : }

  002ce	8b e5		 mov	 esp, ebp
  002d0	5d		 pop	 ebp
  002d1	c3		 ret	 0
?BlTrapFatal@@YIXKPAU_BL_TRAP_CONTEXT@@@Z ENDP		; BlTrapFatal
_TEXT	ENDS
END
