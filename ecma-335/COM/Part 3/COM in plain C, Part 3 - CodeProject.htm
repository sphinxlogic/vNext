<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<title>COM in plain C, Part 3 - CodeProject</title> 
    
	<link type="text/css" rel="stylesheet" href="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/Main.css">

    <script type="text/javascript" async="" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/analytics.js"></script><script type="text/javascript" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/jquery.js" defer="defer"></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/article.js" defer="defer"></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/MemberProfilePopup.js" defer="defer"></script>
<script type="text/javascript" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/a.js" defer="defer"></script>

	
<meta http-equiv="content-language" content="en-US">
<meta charset="UTF-8">
<meta name="Description" content="COM collections in C">
<meta name="Keywords" content="C++, C, VBScript, Windows, Visual-Studio, Dev, COM, Beginner,COM / COM+,Platforms, Frameworks &amp; Libraries,Free source code, tutorials">
<meta name="Author" content="Jeff Glatt">
<meta name="Rating" content="General">
<meta name="Revisit-After" content="1 days">
<meta name="application-name" content="CodeProject">
<meta name="google-translate-customization" content="d908bb7ce7aff658-4c2f3a504525c916-g629383f736781a8a-13">

<link rel="dns-prefetch" href="https://ajax.googleapis.com/"> 
<link rel="canonical" href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3">
<meta name="twitter: card" content="summary">
<meta name="twitter: site" content="@CodeProject">
<meta property="og:url" content="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3">
<meta property="og:title" content="COM in plain C, Part 3">
<meta property="og:description" content="COM collections in C">

<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - All Topics" href="https://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=1">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - Artificial Intelligence" href="https://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=31">
<link rel="alternate" type="application/rss+xml" title="CodeProject Lounge Postings" href="https://www.codeproject.com/webservices/LoungeRSS.aspx">
<meta name="robots" content="index, follow">
<link rel="search" type="application/opensearchdescription+xml" title="CodeProject" href="https://www.codeproject.com/info/OpenSearch.xml">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="apple-touch-icon" sizes="144x144" href="https://www.codeproject.com/favicon/apple-touch-icon.png"> 
<link rel="icon" type="image/png" sizes="32x32" href="https://www.codeproject.com/favicon/favicon-32x32.png"> 
<link rel="icon" type="image/png" sizes="16x16" href="https://www.codeproject.com/favicon/favicon-16x16.png"> 
<link rel="manifest" href="https://www.codeproject.com/favicon/manifest.json"> 
<link rel="mask-icon" href="https://www.codeproject.com/favicon/safari-pinned-tab.svg" color="#ff9900">
	<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "TechArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3"
   },
  "headline": "COM in plain C, Part 3",
  "url": "https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3",
  "discussionUrl": "https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3#_comments",
  "isFamilyFriendly": "true",
  "image": "https://codeproject.global.ssl.fastly.net/App_Themes/CodeProject/Img/Article100.png",
  "keywords": "C++,C,VBScript,Windows,Visual-Studio,Dev,COM,Beginner",
  "commentCount": "15",
  "editor" : {
    "@type" : "Person",
    "name" : "Smitha Nishant",
    "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=28970"
  },
  "license": "http://www.codeproject.com/info/cpol10.aspx",
  "publisher" : {
    "@type" : "Organization",
    "name" : "CodeProject"
  },
  "description": "COM collections in C",
  "articleSection": "COM / COM+",
  "author" : [{
      "@type" : "Person",
      "name" : "Jeff Glatt",
      "url" : "https://www.codeproject.com/script/Membership/View.aspx?mid=88625"
    }],
  "datePublished": "2006-05-07",
  "dateCreated": "2006-05-07",
  "dateModified": "2006-05-07"
,
  "aggregateRating" : {
    "@type" : "aggregateRating",
    "ratingValue" : 4.90,
    "ratingCount" : 42,
    "bestRating" : 5,
    "worstRating" : 1
  }
}</script>

<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "item" : {
      "@id" : "/Chapters/8/Platforms-Frameworks-Libraries.aspx",
      "name" : "Platforms, Frameworks & Libraries"
    }
  },{
    "@type": "ListItem",
    "position": 2,
    "item" : {
      "@id" : "/KB/COM/",
      "name" : "COM / COM+"
    }
  }]
}</script>


	<!-- base href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3" -->
	
    


<script type="text/javascript">
function defrm () { /* thanks twitter */
    document.write = '';
    window.top.location = window.self.location;
    setTimeout(function() { document.body.innerHTML = ''; }, 0);
    window.self.onload = function(evt) { document.body.innerHTML = ''; };
}

if (window.top !== window.self) {
    try {
        if (window.top.location.host) { /* will throw for all except chrome */ }
        else { defrm(); /* chrome */ }
    } catch (ex) { defrm(); /* everyone else */ }
}

// Specific case where a site is screwing with us.
if (typeof(DemoUrl) !== 'undefined') {
    document.write(unescape('%3Cme') + 'ta http' + '-equiv="re' + 'fresh con' +
                           'tent="1;url=' + DemoUrl + unescape('"%3CE'));
}
</script>
	





<!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" type="text/javascript" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/js"></script>
    <script type="text/javascript">
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-1735123-1' , {'user_id': '55e1d411-e955-4cb4-9978-1528f21616a2'});
    </script>


<style type="text/css"></style></head>	

<body class="firefox firefox72">

<a class="access-link" href="#Main"><img alt="Click here to Skip to main content" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/t.gif"></a>




<div class="page-background">

	
	

	

	
    <div id="ctl00_STM" class="site-top-menu fixed">
        <div class="main-content">
            

<div class="container memberbar clearfix flex-container flex-extend">

	<div id="ctl00_MemberBar_GenInfo" class="flex-item align-left">14,417,643 members</div>

	<div class="flex-item">
		
	</div>

	<div class="flex-item align-right">

		

		<span id="ctl00_MemberBar_ReadLaterList_ReadLaterListDiv" class="tooltip member-message">
	<span id="ReadLaterListIcon" class="readlaterlist-count openable hidden"></span>
	<div class="tooltip-flyout readlaterlist-dropdown">
		<div id="ItemsToRead" class="readlaterlist-list"></div>
	</div>
</span><span id="ctl00_MemberBar_Messages_NotificationDiv" class="tooltip member-message">
	<a id="ctl00_MemberBar_Messages_NotificationCount" title="1 message" class="notification-count openable" href="https://www.codeproject.com/script/Membership/MyNotifications.aspx">1</a>

	<div class="tooltip-flyout notification-dropdown">
		

		<div id="ctl00_MemberBar_Messages_Confirm" class="bold spaced">
            <img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/caution.png" style="width:20px;height:20px;vertical-align:bottom">
            <a id="ctl00_MemberBar_Messages_EmailConfirm" href="https://www.codeproject.com/script/Membership/SendConfirmRequest.aspx?rp=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3">Click here to confirm your email address. </a>
		</div>

		
		
		<div id="Notifications" class="notification-list">
			<img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/loading24.gif" alt="loading" style="margin:auto;">
		</div>
		<div class="spaced">
			
		</div>
	</div>
</span><span id="ctl00_MemberBar_TotalPoints" title="Total reputation points"><a class="bold member-rep-box silver" title="Reputation points earned: 826" href="https://www.codeproject.com/script/Reputation/List.aspx?mid=527156">826</a></span><span id="ctl00_MemberBar_CurRat" class="member-links tooltip openable">
				<a id="ctl00_MemberBar_MyProfile" class="me desktop-only tablet-only" dir="ltr" href="https://www.codeproject.com/Members/jon57">jon57</a>
                <a id="ctl00_MemberBar_MyProfileMob" class="me mobile-only" href="https://www.codeproject.com/Members/jon57">â˜°</a>
                <div class="tooltip-flyout">
					
					<div class="list-item"><a id="ctl00_MemberBar_MySettingsDefault" href="https://www.codeproject.com/script/Membership/Modify.aspx">My Settings</a></div>
					
					<div class="list-item"><a id="ctl00_MemberBar_MyBookmarks" href="https://www.codeproject.com/script/Bookmarks/List.aspx?obtid=2">My Bookmarks</a></div>
					<div class="list-item"><a id="ctl00_MemberBar_MyArticles" href="https://www.codeproject.com/script/Articles/MemberArticles.aspx?amid=527156">My Articles</a></div>
					<div class="list-item"><a id="ctl00_MemberBar_MyMessages" href="https://www.codeproject.com/script/Forums/Messages.aspx?fmid=527156">My Messages</a></div>
					<div class="list-item"><a id="ctl00_MemberBar_MyQuestions" href="https://www.codeproject.com/script/Answers/MemberPosts.aspx?tab=questions&amp;mid=527156&amp;showall=True">My Questions</a></div>
					<div class="list-item"><a id="ctl00_MemberBar_MyAnswers" href="https://www.codeproject.com/script/Answers/MemberPosts.aspx?tab=answers&amp;mid=527156&amp;showall=True">My Answers</a></div>
					<div class="list-item"><a id="ctl00_MemberBar_MyComments" href="https://www.codeproject.com/script/comments/MemberComments.aspx?mid=527156">My Comments</a></div>
					
					
					<div id="ctl00_MemberBar_MyFollowingHolder">
					    <div class="list-item"><a id="ctl00_MemberBar_MyFollowing" href="https://www.codeproject.com/script/follow/Edit.aspx">Things I Follow</a></div>
					    <div class="list-item"><a id="ctl00_MemberBar_MyFollowers" href="https://www.codeproject.com/script/follow/Followers.aspx">My Followers</a></div>
					</div>
					
        
					<form name="unsubForm" id="unsubForm" action="/script/Membership/LogOff.aspx?rp=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3" method="post" class="tight">
                    <input type="hidden" name="AntiForgeryToken" value="e82756ee-ccd1-43de-910d-7f5dd2636494">
                    <input type="submit" value="Sign out" class="list-item border-none extended align-left" onclick="return doSignout();" style="background-color: transparent; color: #999; cursor:pointer">
                    
                    </form>

                    <script type="text/javascript">//<!--
			        function doSignout()
			        {
    			        document.unsubForm.action = "/script/Membership/LogOff.aspx?rp=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3"
				        document.unsubForm.submit();
				        return true;
			        }//-->
			        </script>
                    
				</div>
			</span>

		
	</div>
</div>
        </div>
    </div>

	
    <div id="ctl00_SH" class="site-header fixed">
        <div class="main-content">
            <div class="logo"><a href="https://www.codeproject.com/"><img id="ctl00_Logo" tabindex="1" title="CodeProject" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/logo250x135.gif" alt="Home" style="height:135px;width:250px;border-width:0px;"></a></div>
            <div class="promo"><div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Platforms-Frameworks-Libraries/COM-COMplus/COM" data-country="US" data-tags="C++, C, VBScript, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5" data-cookieconsent="true"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Platforms-Frameworks-Libraries/COM-COMplus/COM&sz=728x90&c=971274"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Platforms-Frameworks-Libraries/COM-COMplus/COM&sz=728x90&c=971274"  width="728px" height="90px" target="_blank"/></a></noscript></div></div>
        </div>
    </div>

	
	<div id="ctl00_TPR" class="sub-headerbar clearfix fixed">
    <div class="float-right">
		

<div class="searchbar">

<form method="get" action="/search.aspx?sbo=kw" name="Search" class="tight">


<table class="search" cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><input tabindex="2" class="search subdue" id="sb_tb" autocomplete="off" value="Search for articles, questions, tips" name="q"></td><td><input type="image" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/search.gif"></td></tr></tbody></table>

<div class="hover-container">
	<div id="SearchFilter" class="search-advanced small-text align-left" style="display: none;">
	<b>Search within:<br></b>
		
		<input type="radio" id="sb_kw" name="sbo" value="kw" checked="checked"><label for="sb_kw">Articles</label><br>
<input type="radio" id="sb_qa" name="sbo" value="qa"><label for="sb_qa">Quick Answers</label><br>
<input type="radio" id="sb_fm" name="sbo" value="fm"><label for="sb_fm">Messages</label><br>


		
		

		
		
	</div>
</div>
</form>

</div>
    </div>
    <div class="float-left">
		

<div class="navbar clearfix">
<ul class="navmenu openable">

<li class="desktop-only"><a id="ctl00_TopNavBar_Home" href="https://www.codeproject.com/">home</a>


</li><li class="openable"><a id="ctl00_TopNavBar_Art" class="down selected" href="https://www.codeproject.com/script/Articles/Latest.aspx">articles</a>

	<ul>
		<li class="openable"><a id="ctl00_TopNavBar_ArtTopicList" class="fly" onmouseover="navBarMenu.ShowMap(this, 'ctl00_TopNavBar_MapFlyout');" href="https://www.codeproject.com/script/Content/SiteMap.aspx">Chapters and Sections<span class="has-submenu">&gt;</span></a><ul id="ctl00_TopNavBar_MapFlyout" class="taxonomy">
			<li>
				<div id="siteMap"></div>
			</li>
			</ul>
		</li>
		
		<li><a id="ctl00_TopNavBar_ArtLatestArts" class="fly" href="https://www.codeproject.com/script/Articles/Latest.aspx?at=1,3,7">Latest Articles</a></li>
		
		<li><a id="ctl00_TopNavBar_ArtTop" class="fly" href="https://www.codeproject.com/script/Articles/TopArticles.aspx?ta_so=5">Top Articles</a></li>
		
		
		<li><a id="ctl00_TopNavBar_ArtGuide" class="fly" href="https://www.codeproject.com/info/Submit.aspx">Posting/Update Guidelines</a></li>
		<li><a id="ctl00_TopNavBar_ArtHelpForum" class="fly" href="https://www.codeproject.com/Forums/1641/Article-Writing.aspx">Article Help Forum</a></li>
		
		<li><a id="ctl00_TopNavBar_ArtPostArticle" class="fly highlight1" href="https://www.codeproject.com/script/Articles/Submit.aspx">
			<img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/write13.png" width="13" height="13"> Submit an article or tip
			</a></li>
        
		<li><a id="ctl00_TopNavBar_ArtImportGitHub" class="fly highlight3" href="https://www.codeproject.com/script/Articles/ImportArticle.aspx">
			<img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/write13.png" width="13" height="13"> Import GitHub Project
			</a></li>
        
		<li><a id="ctl00_TopNavBar_ArtPostBlog" class="fly highlight2" href="https://www.codeproject.com/script/Articles/BlogFeed.aspx">
			<img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/write13.png" width="13" height="13"> Import your Blog
			</a></li>		
        
        <li class="last"></li>
	</ul>

</li>



<li class="openable">
<a id="ctl00_TopNavBar_Answers" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active">
    <span class="desktop-only tablet-only">quick answers</span><span class="mobile-only">Q&amp;A</span>
</a>
	<ul>
		<li id="ctl00_TopNavBar_AQL"><a id="ctl00_TopNavBar_ArticleQuestion" class="fly highlight1" href="#_comments">
			<img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/write13.png" width="13" height="13"> Ask a Question about this 
			article</a>
		</li>

		<li><a id="ctl00_TopNavBar_QAAsk" class="fly highlight2" href="https://www.codeproject.com/Questions/ask.aspx"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/write13.png" width="13" height="13"> Ask a Question</a></li>

		<li><a id="ctl00_TopNavBar_QAUnanswered" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=unanswered">View Unanswered Questions</a></li>
		<li><a id="ctl00_TopNavBar_QALatest" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active">View All Questions</a></li>
        
				<li><a id="ctl00_TopNavBar_QATR_ctl00_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=81" style="padding-left:30px">View C# questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl01_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=842" style="padding-left:30px">View VB.NET questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl02_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=85" style="padding-left:30px">View ASP.NET questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl03_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=93" style="padding-left:30px">View SQL questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl04_Tag" class="fly" href="https://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=87" style="padding-left:30px">View Javascript questions</a></li>
			
    
		<li class="last"></li>
	</ul>

</li>



<li class="openable"><a id="ctl00_TopNavBar_Forums" href="https://www.codeproject.com/script/Forums/List.aspx">
        <span class="desktop-only tablet-only">discussions</span><span class="mobile-only">forums</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_MessageBoardsAll" class="fly" href="https://www.codeproject.com/script/Forums/List.aspx">All Message Boards...</a></li>
		<li class="openable"><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1580997/Application-Lifecycle.aspx">Application Lifecycle<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="https://www.codeproject.com/Forums/1533717/Running-a-Business.aspx">Running a Business</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/1533716/Sales-Marketing.aspx">Sales / Marketing</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/1651/Collaboration-Beta-Testing.aspx">Collaboration / Beta Testing</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/3304/Work-Issues.aspx">Work  Issues</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/369270/Design-and-Architecture.aspx">Design and Architecture</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/12076/ASP-NET.aspx">ASP.NET</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1580226/JavaScript.aspx">JavaScript</a>
</li>
<li class="openable"><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1647/C-Cplusplus-MFC.aspx">C / C++ / MFC<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="https://www.codeproject.com/Forums/4486/ATL-WTL-STL.aspx">ATL /  WTL / STL</a></li>
<li><a class="fly" href="https://www.codeproject.com/Forums/3785/Managed-Cplusplus-CLI.aspx">Managed C++/CLI</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1649/Csharp.aspx">C#</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1627782/Free-Tools.aspx">Free Tools</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1827460/Objective-C-and-Swift.aspx">Objective-C and Swift</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1725/Database.aspx">Database</a>
</li>
<li class="openable"><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/186301/Hardware-Devices.aspx">Hardware &amp; Devices<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="https://www.codeproject.com/Forums/1644/System-Admin.aspx">System Admin</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1606152/Hosting-and-Servers.aspx">Hosting and Servers</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1643/Java.aspx">Java</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1942421/Linux-Programming.aspx">Linux Programming</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1650/NET-Framework.aspx">.NET Framework</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1848626/Android.aspx">Android</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1876716/iOS.aspx">iOS</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/13695/Mobile.aspx">Mobile</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1540733/SharePoint.aspx">SharePoint</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1004257/Silverlight-WPF.aspx">Silverlight / WPF</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1646/Visual-Basic.aspx">Visual Basic</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1640/Web-Development.aspx">Web Development</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/suggestions.aspx">Site Bugs / Suggestions</a>
</li>
<li><a class="fly" style="padding-left:30px" href="https://www.codeproject.com/Forums/1652005/Spam-and-Abuse-Watch.aspx">Spam and Abuse Watch</a>
</li>

		<li class="last"></li>
	</ul>

</li>

<li class="openable"><a id="ctl00_TopNavBar_Features" href="https://www.codeproject.com/Feature/">
      <span class="desktop-only tablet-only">features</span><span class="mobile-only">stuff</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_Comps" class="fly" href="https://www.codeproject.com/script/Contests/CurrentCompetitions.aspx?cmpTpId=3&amp;awsac=true">Competitions</a></li>
		<li><a id="ctl00_TopNavBar_News" class="fly" href="https://www.codeproject.com/script/News/List.aspx">News</a></li>
		<li><a id="ctl00_TopNavBar_Insider" class="fly" href="https://www.codeproject.com/Feature/Insider/">The Insider Newsletter</a></li>
    	<li><a id="ctl00_TopNavBar_DailyBuild" class="fly" href="https://www.codeproject.com/Feature/DailyBuild">The Daily Build Newsletter</a></li>
		<li><a id="ctl00_TopNavBar_Newsletters" class="fly" href="https://www.codeproject.com/script/Mailouts/Archive.aspx?mtpid=1">Newsletter archive</a></li>
		<li><a id="ctl00_TopNavBar_Surveys" class="fly" href="https://www.codeproject.com/script/Surveys/List.aspx">Surveys</a></li>
		<li><a id="ctl00_TopNavBar_Showcase" class="fly" href="https://www.codeproject.com/KB/showcase/">Product Showcase</a></li>
        
		<li><a id="ctl00_TopNavBar_Stuff" class="fly" href="https://www.codeproject.com/Info/Stuff.aspx">CodeProject Stuff</a></li>
		<li class="last"></li>
	</ul>

</li>


<li class="openable"><a id="ctl00_TopNavBar_Lounge" href="https://www.codeproject.com/Lounge.aspx">
            <span class="desktop-only tablet-only">community</span><span class="mobile-only">lounge</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_WhosWho" class="fly" href="https://www.codeproject.com/script/Membership/Profiles.aspx">Who's Who</a></li>
		<li><a id="ctl00_TopNavBar_MVPs" class="fly break" href="https://www.codeproject.com/script/Contests/Winners.aspx?obtid=1&amp;cmpTpId=2&amp;cid=0">Most Valuable Professionals</a></li>
		

		<li><a id="ctl00_TopNavBar_LoungeLnk" class="fly highlight2" href="https://www.codeproject.com/Lounge.aspx">The Lounge &nbsp;</a></li>
		<li><a id="ctl00_TopNavBar_WhereAmILink" class="fly" href="https://www.codeproject.com/Forums/1939564/Where-I-am-Member-Photos.aspx">Where I Am: Member Photos</a></li>
		<li><a id="ctl00_TopNavBar_InsiderLnk" class="fly" href="https://www.codeproject.com/Insider.aspx">The Insider News</a></li>
		<li><a id="ctl00_TopNavBar_WeirdWonderful" class="fly" href="https://www.codeproject.com/Feature/WeirdAndWonderful.aspx">The Weird &amp; The Wonderful</a></li>
		<li></li>
		

		
		<li class="openable"><a class="fly" href="https://www.codeproject.com/Forums/1580229/Hindi.aspx">Non-English Language
			<span class="has-submenu">&gt;</span></a>
		<ul>
		<li><a class="fly" href="https://www.codeproject.com/Forums/1580229/Hindi.aspx">General Indian Topics</a></li>
		
		</ul>
		</li><li class="last"></li>
		
	</ul>

</li>


<li class="openable" style="margin-left:20px"><a id="ctl00_TopNavBar_Help" href="https://www.codeproject.com/KB/FAQs/">
    <span class="desktop-only tablet-only">help</span><span class="mobile-only">?</span>
</a>


	<ul>
		<li><a id="ctl00_TopNavBar_HelpWhatIs" class="fly" href="https://www.codeproject.com/info/guide.aspx">What is 'CodeProject'?</a></li>
		<li><a id="ctl00_TopNavBar_HelpGeneral" class="fly break" href="https://www.codeproject.com/KB/FAQs/">General FAQ</a></li>
		<li><a id="ctl00_TopNavBar_HelpPostQuestion" class="fly break highlight2" href="https://www.codeproject.com/Questions/ask.aspx">Ask a Question</a></li>
		<li><a id="ctl00_TopNavBar_HelpBugs" class="fly" href="https://www.codeproject.com/suggestions.aspx">Bugs and Suggestions</a></li>
		<li><a id="ctl00_TopNavBar_HelpArticles" class="fly" href="https://www.codeproject.com/Forums/1641/Article-Writing.aspx">Article Help Forum</a></li>
		
		
		
		
		<li><a id="ctl00_TopNavBar_HelpAboutUs" class="fly" href="https://www.codeproject.com/info/about.aspx">About Us</a></li>
		<li class="last"></li>
	</ul>

</li>

</ul>

</div>
    </div>
	<div class="sub-headerbar-divider"></div>
	</div>		
	

	<div id="A" class="container-content-wrap fixed"> 

	<div class="container-content">

        
		<div class="clearfix">
			<div class="container-breadcrumb float-left ">
				<div><a href="https://www.codeproject.com/script/Content/SiteMap.aspx">Articles</a> Â» <a href="https://www.codeproject.com/Chapters/8/Platforms-Frameworks-Libraries.aspx">Platforms, Frameworks &amp; Libraries</a> Â» <a href="https://www.codeproject.com/KB/COM/">COM / COM+</a> Â» <a href="https://www.codeproject.com/KB/COM/#COM">COM</a></div>
			</div>

            <div class="float-left">
				
			</div>

			<div class="edit-links float-right">
				



 
&nbsp;










			</div>

			<div class="article-nav float-right">
                
				


<div style="display:inline-block;position:relative;top:-6px;margin-right:20px">
    <a id="ctl00_ActionLinks_ArticleFollow_FollowBtn" title="" class="button unfollowed align-center invisiblewith-subline tooltip" data-enabletooltip="true" data-tooltip="Have any updates for this Article appear in your Timeline so you can stay up to date" style="display: inline-block;">Follow<div class="speech-bubble-container-up" style="width:150px">  <div class="speech-bubble-up" style="text-align:center"> Have any updates for this Article appear in your Timeline so you can stay up to date</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></a>
	<a id="ctl00_ActionLinks_ArticleFollow_UnfollowBtn" title="" class="button followed align-center invisiblewith-subline tooltip" data-enabletooltip="true" data-tooltip="Stop following this Article" style="display:none;">Unfollow<div class="speech-bubble-container-up" style="width:150px">  <div class="speech-bubble-up" style="text-align:center"> Stop following this Article</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></a>

</div>



<span id="ctl00_ActionLinks_BookmarkMd_bookmark" data-type="bookmark" data-ref="2_14037_1" data-size="medium" data-mode="bookmark"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark48.png" style="width:24px;height:24px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span> 

<a id="ctl00_ActionLinks_PrintMd" data-tooltip="Print" data-enabletooltip="true" data-width="auto" href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?display=Print" class="tooltip" title="">
   <img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/print48.png" style="border:0" width="24px" height="24px">
<div class="speech-bubble-container-up" style="width:auto">  <div class="speech-bubble-up" style="text-align:center"> Print</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></a>



<span id="ctl00_ActionLinks_R">
    
    
</span>
			</div>
		</div>

        
		<div class="extended article-container-parts">

			
			<div id="AT" class="article-container  fixed"> 

				<div class="article">

					<form name="aspnetForm" method="post" action="/Articles/14037/COM-in-plain-C-Part-3" id="aspnetForm" style="margin:0;padding:0">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="hUCpev32lKXr4BQimWkSJhq2enraQ5L1NrCv1KlTDXQsScMF1iGd0mm40Qm1URTTdVbCwZmQTidVXevcd+QRaqZi+FkWFla/u0oUA6SnguEXNnzNykssex4z5YAhyygPbf4ve9hN+k9oZTdJDwmgSN10XKilKkLq0U7C1tlcT3jhtfLMdVzSVRFaFNFPtzEdsWKkw2HoDjke+e9j4b3upowcAzqObsIuxddcWgpFU2dqh49bYz0GRNrzPmtTNRQYzxKUaNXVvxopccRRq0UNeJL+uCY/cdJ2v4etrPb0q6T8mE08EENHdFJ+3hNNUrmYKrR2EUyZoqUql5SuVoLLyx4deGoeOyOKvFd/vhnd+30N/Itmj7ATJqZWm1NpUMbqfx5nFR26j4LEqVIPMrwexTn9Zq70UtrXzEhD/AJcqG267aD24fSm7NeN/PREADfFD/xvDo0yq8K3BYNEoVXIrUprBT3lp1Ent9MuTQTfJnckR/aMnjY3eSf9LkDiwhG+Z1VkVbEkRukDDlIfc+Ey7z6SglGpV65k+Ohmy5LYBhp98WXm6GI4uCA656EPfD4yC00UWFZviDU+1rpb/GUBACnUl9K1EXewPhNf0UyjUAo4xFWtylb+1MhT1DZ3GAE3uCZjZDlJbfFCpAoBRazsTCoGYEQ0YMtCfUdxrnta5BL1xGkngqIwH6wqUoEdv4ln+VPBkXfdMslHVeRI98KnkV0tqLLDhgsDDS7AAlz3VGz+XFsRnlD+BcIk99KiamzQJWHURxCRml6/brVgKy/LXYEKO9BZCs+CbZA5mtyhd1YzOWlFiktiTzURM5uuY4dK+N8T6aYlL0ADzACwmACsOAERbU6BXq2Q5gjX3j19pkf9e+ilZmAF6f+h2nntvKLMRQVOHlhtnHgrZ3idyFwxGnWDBbSVqrU4rl4PkWOJLEBTiS3lOfrNEqMNUErtnHrcgOtD/p1M87KNZxMwCmsAyAufGUATkWhWkhCcwqLalVKHHOr/y0PxILZFq5tise05M05Ay6+JBeebZyyZiMFoSmhF7JYMu7SIEmSDS+m/sxqVDFmHjSnz3D9WQBvTe1JTYEaSwoeyaGVAtM2c0CF2Lpr/I8Z2FgNwGiK00OpUHvvHvOtIMljyJh8fPhFaSdu0A2ey9Y9DpM0Tv503wHmy5DUwvk+bJ14cIHEyMjEx9tEI6/aAWyz/6WxwiNBh1nDQCfkE4M7p12aHX2w6TPi6ABo1vhVa3IFjCyiAxnSgD6skPFp6x+LaMGDjDRTAv3z/0nKRYKO6uFPuQALFCk1riQO0YP1iXUv2Jpva4bGtBxDOVFWQGezwSrdakSerLd2c9E0Rkwvlxue6sIN93kj/j+r/RsgdxIYX48P6CxJs3tl7FZDPW/eWuCl+PLQ3LUg5XwJmU3KUYkjzLXdOUx7VxkiDMoVoWijAS4mpyJypXvIuz2RHn909I5Z9fhxVr0HVnfJTgZrNK88rHXKJ+8p+bOPZg7pFf/IZ66bCZa8ePtn/4dANlIoKrudD0OVN85fAXwcLxaDSuJaoltxvSiHtW5ln73ezvjNBcs+Bik05zLFEfZ6LpSbmZSIeJRCkFOQwiiRvKMiaS8ec3PHdYJLFlU8W8+4zEx0f05iqaUIvxYL9ONG5xTmmnchieSo9oYXo7Hnq5bUSP7fWgxihiuawCvX786KpiVCMX1M//jh7n9UU90xL5GkQzh6qKOni38HrJbazr9lIRglkalhSD8/AZ2xIuI9nmJ/Pjp1iYPhnCvQRqDQjG0MlqZG63qN+kMtZWt5u1/NzomTM9JLEZnqQ5M6V/+XBfsQ5QivlFLcpD/9onxftiRHjv5TviWW1Fw8Prvfrc5p16s9DVtGcvfeiFE7oOlk8iuAE6ttkuQ+iZiSPuCpOyckDxmZ31zO0LrMKJ2wGxMvGjCXio0pZHBYzoAZGPD4zYjbVsWXDqkti7ARFg0YAKHGGPozP/SHFYhJVtC6UlcPu6pwO6l2aYFCQ859WrGcWgoMw1zjWmjaM5dvwM9hwYYPMH378xYgDLq3hxFUOSS+Ror4wD8IIDEMPCNf3jMunbKRF+jZy36yf/i2Uk/IuzWGLtv07M9epBUNWUZkkTDEjd7ffvNfOB57nWZDI2D17VUXQWNESza8pGf9gsJEzpy09gt3wPscWaImibY8/smjW/eoWL+8Ii6PWQ//pXVAH3ML6xmZ66mEi/Nct8/sBUoyG6TyA4HPJrkZA24eVgVxxVwwmCNmaha5rWbluctFzq7jhqssSQP6qwKF7XWuCp91dmuP8/WSS6du5MY2Zav6NbYD3jKf08dT6qGzr+iYuQjxvZeDdmzivVCNQw1i7koykCh1Wsu2fpacFvukijcuF7M1ooJa+A9gpo78YckjGjZNLPoiKoaHMpbJqz1VPg2A6LTQxBndBNgIPgRN7Sw==">
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="10C1FD69">
</div>

					
					 
					<div class="header">
					    <a name="Main"></a>

					    
					    <a name="_articleTop" id="_articleTop"></a>
					    <div class="title">
					        <h1 id="ctl00_ArticleTitle">COM in plain C, Part 3</h1>
					    </div>

                        <div>
					        
					        <div class="entry flex-container">

                                

                                <div class="flex-item" style="flex:1 1 auto">
                                    <div class="flex-container" style="justify-content:space-between;flex-wrap:wrap-reverse">
                                       <span id="ctl00_Authors" class="author flex-item"><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625" rel="author">Jeff Glatt</a></span> 

                                        <div class="flex-item" style="margin-top:-7px;height:35px">
                                            <div id="ctl00_RateArticle_RateItemWrapper" class="container-rating small-text" name="RateItem_14037">

	<table class="small-text" width="100%" cellspacing="0" cellpadding="0">
	<tbody><tr>
		<td id="ctl00_RateArticle_VoteResultDiv" class="rating-result align-right">
			<span class="align-right"></span>
			<img class="loading invisible" alt="loading..." src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/loading16.gif" width="16px" height="16px"> 
		</td>

	
		<td class="voteTbl" style="white-space:nowrap" align="right">
			<table class="small-text">
			<tbody><tr>
				
				<td id="ctl00_RateArticle_StartForm" nowrap="nowrap" align="right"><b>Rate me!</b> </td>

				<td id="ctl00_RateArticle_VoteFormDiv" class="nowrap tooltip rating-stars-voter-large" style="padding-top:1px">

                    
					

<meta itemprop="upvoteCount" content="36">


<table id="ctl00_RateArticle_ItemRating_RatingTable" style="margin:0 1px;" class="hide-on-hover float-left" cellspacing="0" cellpadding="0">
	<tbody><tr>
		<td class="nowrap">

        <div style="width:120px;height:28px;position:relative" class="nowrap rating-stars-large"><div style="width:117px;height:24px;" class="clipped align-left float-left"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/stars-fill-lg.png"></div><div style="width:3px;height:24px;position:relative" class="clipped"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/stars-empty-lg.png" style="position:absolute;top:0;right:0"></div>

		
	</div></td>
		<td id="ctl00_RateArticle_ItemRating_VR" class="nowrap">
		<span id="ctl00_RateArticle_ItemRating_VotesR">4.90  (42 votes)</span>
		
	</td>
	</tr>
</tbody></table>

<span id="ctl00_RateArticle_ItemRating_RatingText"></span>


                    
					<span id="ctl00_RateArticle_RB" class="ajaxHist radio voting show-on-hover" style="display: none;">
						<span id="ctl00_RateArticle_VoteRBL"><input id="ctl00_RateArticle_VoteRBL_0" type="radio" name="ctl00$RateArticle$VoteRBL" value="1" style="display: none;"><input id="ctl00_RateArticle_VoteRBL_1" type="radio" name="ctl00$RateArticle$VoteRBL" value="2" style="display: none;"><input id="ctl00_RateArticle_VoteRBL_2" type="radio" name="ctl00$RateArticle$VoteRBL" value="3" style="display: none;"><input id="ctl00_RateArticle_VoteRBL_3" type="radio" name="ctl00$RateArticle$VoteRBL" value="4" style="display: none;"><input id="ctl00_RateArticle_VoteRBL_4" type="radio" name="ctl00$RateArticle$VoteRBL" value="5" style="display: none;"></span> 
					<div class="rating-star-block"><a href="#" rating="1" class="star outline" title="vote 1">vote 1</a><a href="#" rating="2" class="star outline" title="vote 2">vote 2</a><a href="#" rating="3" class="star outline" title="vote 3">vote 3</a><a href="#" rating="4" class="star outline" title="vote 4">vote 4</a><a href="#" rating="5" class="star outline" title="vote 5">vote 5</a></div></span>

                    
					

                    
	                <div id="ctl00_RateArticle_RCD" class="hover-container tooltip-flyout rating-comment" style="top:12px">
		                Add a reason or comment to your vote:
                        <a href="#" id="clear-rate_ctl00_RateArticle_RCD" title="close" class="rating-close">x</a>
                        <br>
                        <textarea class="RateComment" rows="5" cols="60" style="width:96%;"></textarea>
		                <span id="ctl00_RateArticle_CommentReq" class="subdue">Adding a comment to your rating is optional</span>
		            </div>

                    
                        

				</td>

				
                <td id="ctl00_RateArticle_VR" class="nowrap show-on-hover tooltip" style="display: none;">

		            <span id="ctl00_RateArticle_VotesR">4.90  (42 votes)</span>

                    
					<div id="ctl00_RateArticle_histPHR" class="speech-bubble-container-up-right" style="width:175px;margin-top:24px;right:-15px;top:6px">
						<div class="speech-bubble-up-right">
							<div id="ctl00_RateArticle_HistogramR">

</div>
							<img id="ctl00_RateArticle_LoadingR" class="align-middle" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/loading24.gif" style="border-width:0px;">
						</div>
						<div class="speech-bubble-pointer-up-right">
							<div class="speech-bubble-pointer-up-right-inner"></div>
						</div>
					</div>
                </td>


				<td style="padding-left:5px">	
					<input type="submit" name="ctl00$RateArticle$SubmitRateBtn" value="Vote!" id="ctl00_RateArticle_SubmitRateBtn" class="button" style="display: none;">
				</td>
			</tr>
			</tbody></table>

			
		</td>
	</tr>
	</tbody></table>

</div>
                                        </div>
                                    </div>

                                    <div class="flex-container">
                                        <span id="ctl00_LastUpdated" class="date flex-item-tight" title="Date last updated">7 May 2006</span><a id="ctl00_LicenseLink" title="The Code Project Open License (CPOL)" class="license flex-item-tight" href="http://www.codeproject.com/info/cpol10.aspx">CPOL</a>
                                    </div>
                                </div>
					        </div>

                            

                        </div>

                        <div id="ctl00_description" class="summary">COM collections in C</div><span id="ctl00_thumbnailUrl" class="date" content="https://codeproject.global.ssl.fastly.net/script/Articles/Images/article100x80.png"></span>			

                    </div>
                    
					
					

					

					
					
					

						
					

					<div id="ctl00_confirmError" class="advise"><img style="float:left;margin-right:10px" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/warning48.png" width="48px" height="48px"><b>Is your email address OK?</b> You are signed up for our 
						newsletters but your email address is either unconfirmed, or has not been 
						reconfirmed in a long time. Please <b>click <a id="ctl00_RequestConfirmLink2" href="https://www.codeproject.com/script/Membership/SendConfirmRequest.aspx?rp=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3">here</a> to have a confirmation email
                        sent</b> so we can confirm your email address and start sending you 
                        newsletters again. Alternatively, you can 
						<a id="ctl00_SubscribeLink2" href="https://www.codeproject.com/script/Membership/Subscribe.aspx">update your subscriptions</a>.</div>

						
						<div id="contentdiv" class="text">
						



<ul class="download">
<li><a href="https://www.codeproject.com/KB/COM/com_in_c3/com_in_c3_src.zip">Download source files - 174 Kb</a> </li></ul>
<h2>Contents</h2>
<ul>
<li><a href="#Intro">Introduction</a> 
</li><li><a href="#DEFINE">Defining a collection object</a> 
</li><li><a href="#BOOK">Some helper functions</a> 
</li><li><a href="#COLLECT">Our collection object's functions</a> 
</li><li><a href="#HOW">How an application obtains our collection object</a> 
</li><li><a href="#VB1">A VBScript example</a> 
</li><li><a href="#C1">A C example</a> 
</li><li><a href="#ENUM">An IEnumVARIANT object</a> 
</li><li><a href="#VB2">Another VBScript example</a> 
</li><li><a href="#C2">Another C example</a> 
</li><li><a href="#GENERIC">A more generic approach</a> 
</li><li><a href="#ADD">Add/Remove items</a> </li></ul>
<h2><a name="intro">Introduction</a></h2>
<p>Sometimes, we may need to maintain a list of items. For example, 
let's say that our COM component is designed to operate some hardware 
PCI card we've designed. And, let's say that a user can install several 
of these cards into one computer, and we want our component to control 
all of the available cards, letting an application retrieve information 
about each card, and access each card individually.</p>
<p>In other words, when our component runs, it needs to query what cards
 are in the system, and make available to an application, a list of 
information about all of them. For the sake of argument, let's assume 
that the only information we need to make available is the "name" of 
each card, where the first card in the system will be named "Port 1", 
the second card will be named "Port 2", etc.</p>
<p>Since we don't know ahead of time how many cards will be in a system,
 the best approach would be to create some struct that can be linked to 
others of its kind, in a linked list. For example, maybe we'll define an
 <code>IENUMITEM</code> struct to hold information about a card:</p><div class="pre-action-link" id="premain92607" style="width:100%;display:block;"><span id="prehide92607" onclick="processCodeBlocks.togglePre(92607);">Hide</span>  &nbsp; <span id="copycode92607" onclick="return processCodeBlocks.copyCode(92607);">Copy Code</span></div><pre id="pre92607" style="margin-top: 0px;" class="notranslate">typedef struct _IENUMITEM {
   // To link several IENUMITEMs into a list.
   struct _IENUMITEM  *next;
   // This item's value (ie, its port name).
   char               *value;
} IENUMITEM;</pre>
<p>And if we have three ports, our linked list of <code>IENUMITEM</code>s would look something like this (where we normally would <code>GlobalAlloc</code> the <code>IENUMITEM</code>s, but I'll just statically declare/initialize them below for quick edification):</p><div class="pre-action-link" id="premain562647" style="width:100%;display:block;"><span id="prehide562647" onclick="processCodeBlocks.togglePre(562647);">Hide</span>  &nbsp; <span id="copycode562647" onclick="return processCodeBlocks.copyCode(562647);">Copy Code</span></div><pre id="pre562647" style="margin-top: 0px;" class="notranslate">IENUMITEM Port1 = {&amp;Port2, "Port 1"};
IENUMITEM Port2 = {&amp;Port3, "Port 2"};
IENUMITEM Port3 = {0, "Port 3"};</pre>
<p>In COM lingo, we refer to a group of related items as a "collection".
 So, the linked list of three items above would be our collection.</p>
<p>But there's one problem with our <code>IENUMITEM</code> above. It has a <code>char *</code> member, which is not automation compatible. We could change this to a <code>BSTR</code>, which is automation compatible. Better yet, let's put a <code>VARIANT</code> right in the <code>IENUMITEM</code>. This has the advantage of making an <code>IENUMITEM</code>
 generic (i.e., it can store any kind of automation data type). And as 
we'll see later, we have to return an item's value to an application, 
using a <code>VARIANT</code>. So, since we need to deal with a <code>VARIANT</code> anyway, let's store it in our <code>IENUMITEM</code> that way. Here's the new definition of an <code>IENUMITEM</code>:</p><div class="pre-action-link" id="premain794873" style="width:100%;display:block;"><span id="prehide794873" onclick="processCodeBlocks.togglePre(794873);">Hide</span>  &nbsp; <span id="copycode794873" onclick="return processCodeBlocks.copyCode(794873);">Copy Code</span></div><pre id="pre794873" style="margin-top: 0px;" class="notranslate">typedef struct _IENUMITEM {
   struct _IENUMITEM  *next;
   VARIANT            *value;
} IENUMITEM;</pre>
<p>And, here is how we may allocate one, and set its value to "Port 1" (error checking omitted):</p><div class="pre-action-link" id="premain427584" style="width:100%;display:block;"><span id="prehide427584" onclick="processCodeBlocks.togglePre(427584);">Hide</span>  &nbsp; <span id="copycode427584" onclick="return processCodeBlocks.copyCode(427584);">Copy Code</span></div><pre id="pre427584" style="margin-top: 0px;" class="notranslate">IENUMITEM  *enumItem;

enumItem = (IENUMITEM *)GlobalAlloc(GMEM_FIXED, sizeof(IENUMITEM));
enumItem-&gt;next = 0;
enumItem-&gt;value.vt = VT_BSTR;
enumItem-&gt;value.bstrVal = SysAllocString(L"Port 1");</pre>
<h2><a name="DEFINE">Defining</a> a collection object</h2>
<p>Remember that some script languages do not have the concept of a 
pointer. Such a language can't possibly walk the above list on its own, 
because the first member of each <code>IENUMITEM</code> is a pointer to the next <code>IENUMITEM</code>. So, we need to provide an object that helps the application (using our COM object) walk this list, fetching each item's value.</p>
<p>Because Microsoft left it up to the Visual Basic programmers (ugh) to come up with this object, they chose to base it upon an <code>IDispatch</code>. In other words, the VTable for our object must start with the three <code>IUnknown</code> functions as all COM objects do (<code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code>), and then must be followed immediately with the four standard <code>IDispatch</code> functions (<code>GetTypeInfoCount</code>, <code>GetTypeInfo</code>, <code>GetIDsOfNames</code>, and <code>Invoke</code>).
 Our object must then have three more functions. In our IDL file, when 
we define the VTable (i.e., the interface) for this object we'll create,
 we must name these three extra functions <code>Count</code>, <code>Item</code>, and <code>_NewEnum</code>.
 In our actual VTable for the object, we can use any name we want for 
the pointers (although I'll stick to those names). Why? Because no one 
is ever going to directly call them. No one will ever even know that 
we're going to add these three functions to our VTable. These functions 
must be called only indirectly via the <code>Invoke</code> function of our object -- even if you're using a language like C that <b>could</b>
 have called them directly if only Microsoft's Visual Basic programmers 
had designed this to accommodate more powerful languages. That's the 
terrible price we all pay for letting Visual Basic programmers design 
this. Furthermore, in our IDL file, we must assign the ID <code>DISPID_VALUE</code> to the <code>Item</code> function, and <code>DISPID_NEWENUM</code> to the <code>_NewEnum</code> function. We <b>must</b>. The <code>Count</code>
 function can be assigned any positive number of our choosing for its 
ID. Does there appear to be any sense of consistency or logic to this 
whatsoever? No? Remember -- Visual Basic programmers.</p>
<p>We'll also need to generate a new GUID for this object's VTable, for use in our IDL file (i.e., the type library).</p>
<p>Let's look at the definition of this object. We can call it anything we like. I'll choose to call it an <code>ICollection</code>:</p><div class="pre-action-link" id="premain519038" style="width:100%;display:block;"><span id="prehide519038" onclick="processCodeBlocks.togglePre(519038);">Hide</span>  &nbsp; <span id="preShrink519038" onclick="processCodeBlocks.shrinkExpand(519038);">Shrink</span> <img id="preimg519038" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(519038);">  &nbsp; <span id="copycode519038" onclick="return processCodeBlocks.copyCode(519038);">Copy Code</span></div><pre id="pre519038" style="margin-top: 0px;" processed="true" class="notranslate">// Our ICollection VTable's GUID
// {F69902B1-20A0-4e99-97ED-CD671AA87B5C}
DEFINE_GUID(IID_ICollection, 0xf69902b1, 0x20a0, 0x4e99, 0x97, 
            0xed, 0xcd, 0x67, 0x1a, 0xa8, 0x7b, 0x5c);

// Our ICollection's VTable
#undef  INTERFACE
#define INTERFACE ICollection
DECLARE_INTERFACE_ (INTERFACE, IDispatch)
{
   // IUnknown functions
   STDMETHOD  (QueryInterface) (THIS_ REFIID, void **) PURE;
   STDMETHOD_ (ULONG, AddRef)  (THIS) PURE;
   STDMETHOD_ (ULONG, Release) (THIS) PURE;
   // IDispatch functions
   STDMETHOD_ (ULONG, GetTypeInfoCount) (THIS_ UINT *) PURE;
   STDMETHOD_ (ULONG, GetTypeInfo) (THIS_ UINT, LCID, 
                                    ITypeInfo **) PURE;
   STDMETHOD_ (ULONG, GetIDsOfNames) (THIS_ REFIID, LPOLESTR *,
               UINT, LCID, DISPID *) PURE;
   STDMETHOD_ (ULONG, Invoke) (THIS_ DISPID, 
               REFIID, LCID, WORD, DISPPARAMS *,
               VARIANT *, EXCEPINFO *, UINT *) PURE;
   // Extra functions
   STDMETHOD (Count) (THIS_ long *);
   STDMETHOD (Item) (THIS_ long, VARIANT *);
   STDMETHOD (_NewEnum) (THIS_ IUnknown **);  
};</pre>
<p>This shouldn't look totally unfamiliar. First, I ran <i>GUIDGEN.EXE</i> to create another GUID. I pasted it above, and gave it the variable name <code>IID_ICollection</code>. That's the GUID for our <code>ICollection</code> object's VTable.</p>
<p>Next, we define our <code>ICollection</code> object's VTable. We're using the same macro we used when we defined our <code>IExample2</code> VTable in the last article. And as mentioned earlier, it starts with the three <code>IUnknown</code> functions, followed by the four <code>IDispatch</code> functions, just like <code>IExample2</code>
 did when we added support for scripting languages. These functions are 
going to perform the same duties as the respective functions did in <code>IExample2</code>.</p>
<p>Finally, we add the three extra functions <code>Count</code>, <code>Item</code>, and <code>_NewEnum</code>. Later, we'll examine what they do.</p>
<p>Remember that the above macro automatically defines our <code>ICollection</code> object as so:</p><div class="pre-action-link" id="premain963576" style="width:100%;display:block;"><span id="prehide963576" onclick="processCodeBlocks.togglePre(963576);">Hide</span>  &nbsp; <span id="copycode963576" onclick="return processCodeBlocks.copyCode(963576);">Copy Code</span></div><pre id="pre963576" style="margin-top: 0px;" class="notranslate">typedef struct {
   ICollectionVtbl  *lpVtbl;
} ICollection;</pre>
<p>In other words, it is defined to have only one data member -- a pointer to our <code>ICollection</code>'s VTable. This member is named <code>lpVtbl</code>, of course. But, we need to add an extra <code>DWORD</code> member to keep a reference count (just like we did to <code>IExample2</code>, and consequently defined a <code>MyRealIExample2</code> to accommodate any extra data members). So, we'll define a <code>MyRealICollection</code> as so:</p><div class="pre-action-link" id="premain639235" style="width:100%;display:block;"><span id="prehide639235" onclick="processCodeBlocks.togglePre(639235);">Hide</span>  &nbsp; <span id="copycode639235" onclick="return processCodeBlocks.copyCode(639235);">Copy Code</span></div><pre id="pre639235" style="margin-top: 0px;" class="notranslate">typedef struct {
   ICollectionVtbl  *lpVtbl;
   DWORD            count;
} MyRealICollection;</pre>
<p>Now, let's take a look at how we'll define the VTable (interface) in our IDL file:</p><div class="pre-action-link" id="premain950276" style="width:100%;display:block;"><span id="prehide950276" onclick="processCodeBlocks.togglePre(950276);">Hide</span>  &nbsp; <span id="copycode950276" onclick="return processCodeBlocks.copyCode(950276);">Copy Code</span></div><pre id="pre950276" style="margin-top: 0px;" class="notranslate">[uuid(F69902B1-20A0-4e99-97ED-CD671AA87B5C), oleautomation, object]
interface ICollection : IDispatch
{
   [propget, id(1)] 
   HRESULT Count([out, retval] long *);
   [propget, id(DISPID_VALUE)] 
   HRESULT Item([in] long, [out, retval] VARIANT *);
   [propget, id(DISPID_NEWENUM), restricted]
   HRESULT _NewEnum([out, retval] IUnknown **);
};</pre>
<p>Note that we've used the new GUID created for our <code>ICollection</code> VTable.</p>
<p>We use the <code>oleautomation</code> keyword because our functions will accept only automation compatible data types, and return such.</p>
<p>Finally, we use the <code>object</code> keyword to indicate that this
 VTable belongs to some object. It's not going to be an object that an 
application gets hold of via our <code>IClassFactory</code>. (Later, we'll see how an application gets hold of one of our <code>ICollection</code> objects.) In fact, an application is never going to be told that our <code>ICollection</code> object is anything except a standard <code>IDispatch</code> object (i.e., our <code>ICollection</code> object is going to masquerade as an ordinary <code>IDispatch</code> as far as an application or script engine is concerned). Since our object is going to masquerade as an ordinary <code>IDispatch</code>, there's no need to specifically define our <code>ICollection</code> object itself inside of our IDL file (unlike we had to do with <code>IExample2</code>
 when we listed what interfaces were in it, and which interface was the 
default). All scripting languages and applications already know all 
about an ordinary <code>IDispatch</code> object, so there's no need to put any information about this <code>IDispatch</code>-impersonator (<code>ICollection</code>) object itself in our IDL file. We need to define only its VTable as above, and mark that VTable as belonging to some object.</p>
<p>Note that, on the interface line, we do specify that this VTable contains <code>IDispatch</code> functions in the expected place and order. So, it certainly can masquerade as an <code>IDispatch</code>.</p>
<p>We, then, list the three extra functions. Notice that they are all defined as <code>propget</code>. Also notice that the <code>Item</code> function has an ID (DISPID) of <code>DISPID_VALUE</code>, and the <code>_NewEnum</code> function has an ID of <code>DISPID_NEWENUM</code>. (We also use the <code>restricted</code> keyword on that latter one, because an object browser is not supposed to show the <code>_NewEnum</code>
 function. It is supposed to be a function that only a script engine 
would call internally, but an actual script would never call.) For the <code>Count</code> function, we can choose any positive ID number, so I arbitrarily chose 1. (It doesn't matter that <code>IExample2</code>'s <code>Buffer</code>
 function also has an ID of 1. These VTables are used in two different 
objects, so their IDs do not need to be unique between the two VTables).</p>
<p>Later, we'll actually get into writing these functions.</p>
<p>Before we change our <code>IExample2</code> sources, let's just copy the entire <i>IExample2</i> directory to a new directory named <i>IExample3</i>. We'll also rename all of the files to reflect this new directory (i.e., <i>IExample2.h</i> becomes <i>IExample3.h</i>, and <i>IExample2.c</i> becomes <i>IExample3.c</i>, etc.). And while we're at it, let's edit the files in this new directory, renaming our <code>IExample2</code> object to an <code>IExample3</code>,
 to distinguish it from our previous sources. All we do is search and 
replace every instance of "IExample2" with "IExample3". And, don't 
forget to run <i>GUIDGEN.EXE</i> to make new GUIDs for <code>IExample3</code>, its VTable, and the type library. Replace the old GUIDs in <i>IExample3.h</i>, and update the UUIDs in <i>IExample3.idl</i>. After all, we don't want our new DLL (which we'll name <i>IExample3.dll</i>) to conflict with our previous <i>IExample2.dll</i>. I've done all this for you, and put the resulting files in an <i>IExample3</i> directory.</p>
<h2><a name="BOOK">Some</a> helper functions</h2>
<p>We need to construct our list of port names. Let's write a helper 
function to do that. We'll arbitrarily assume we have three ports, and 
so create three <code>IENUMITEM</code>s. We'll store the head of this list in a global variable <code>PortsList</code>. And, we also need a helper function to free the list when we're done with it.</p><div class="pre-action-link" id="premain285369" style="width:100%;display:block;"><span id="prehide285369" onclick="processCodeBlocks.togglePre(285369);">Hide</span>  &nbsp; <span id="preShrink285369" onclick="processCodeBlocks.shrinkExpand(285369);">Shrink</span> <img id="preimg285369" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(285369);">  &nbsp; <span id="copycode285369" onclick="return processCodeBlocks.copyCode(285369);">Copy Code</span></div><pre id="pre285369" style="margin-top: 0px;" processed="true" class="notranslate">IENUMITEM  *PortsList;

// This is just a helper function to free
// up our PortsList. Called when our DLL unloads.
void freePortsCollection(void)
{
   IENUMITEM *item;

   item = PortsList;

   // Is there another item in the list?
   while ((item = PortsList))
   {
      // Get the next item *before* we delete this one
      PortsList = item-&gt;next;

      // If the item's value is an object, we need to Release()
      // it. If it's a BSTR, we need to SysFreeString() it.
      // VariantClear does this for us.
      VariantClear(&amp;item-&gt;value);

      // Free the IENUMITEM.
      GlobalFree(item);
   }
}

// This is just a helper function to initialize our Ports list.
// Called when our DLL first loads.
HRESULT initPortsCollection(void)
{
   IENUMITEM *item;

   // Add a "Port 1" IENUMITEM to our list.
   if ((PortsList = item = 
       (IENUMITEM *)GlobalAlloc(GMEM_FIXED, 
       sizeof(IENUMITEM))))
   {
      item-&gt;next = 0;
      item-&gt;value.vt = VT_BSTR;
      if ((item-&gt;value.bstrVal = SysAllocString(L"Port 1")))
      {
         // Add a "Port 2" IENUMITEM to our list.
         if ((item-&gt;next = (IENUMITEM *)GlobalAlloc(
                               GMEM_FIXED, sizeof(IENUMITEM))))
         {
            item = item-&gt;next;
            item-&gt;value.vt = VT_BSTR;
            if ((item-&gt;value.bstrVal = SysAllocString(L"Port 2")))
            {
               // Add a "Port 3" IENUMITEM to our list.
               if ((item-&gt;next = (IENUMITEM *)GlobalAlloc(
                                     GMEM_FIXED, sizeof(IENUMITEM))))
               {
                  item = item-&gt;next;
                  item-&gt;next = 0;
                  item-&gt;value.vt = VT_BSTR;
                  if ((item-&gt;value.bstrVal = 
                       SysAllocString(L"Port 3")))
                     return(S_OK);
               }
            }
         }
      }
   }

   // Error
   freePortsCollection();
   return(E_FAIL);
}</pre>
<p>We're also going to add a second global variable named <code>CollectionTypeInfo</code> to hold a <code>ITypeInfo</code> for our <code>ICollection</code>... uh, the <code>IDispatch</code>
 object. (We'll talk about why we need this, later). So, we need to add 
that global variable, and then let's write two helper functions -- one 
to initialize the variable to zero, and one to Release the <code>ITypeInfo</code>:</p><div class="pre-action-link" id="premain277533" style="width:100%;display:block;"><span id="prehide277533" onclick="processCodeBlocks.togglePre(277533);">Hide</span>  &nbsp; <span id="copycode277533" onclick="return processCodeBlocks.copyCode(277533);">Copy Code</span></div><pre id="pre277533" style="margin-top: 0px;" class="notranslate">// Our ICollection's ITypeInfo. We need only one of these so
// we can make it global
ITypeInfo    *CollectionTypeInfo;

// This helper function initializes our ICollection TypeInfo.
// It's called when our DLL is loading.
void initCollectionTypeInfo(void)
{
   // We haven't yet created the ITypeInfo for our ICollection
   CollectionTypeInfo = 0;
}

// This helper function just Release()'s our ICollection TypeInfo.
// It's called when our DLL is unloading.
void freeCollectionTypeInfo(void)
{
   if (CollectionTypeInfo)
       CollectionTypeInfo-&gt;lpVtbl-&gt;AddRef(CollectionTypeInfo);
}</pre>
<p>Now, we need to modify our <code>DllMain</code> to call these helper functions:</p><div class="pre-action-link" id="premain743735" style="width:100%;display:block;"><span id="prehide743735" onclick="processCodeBlocks.togglePre(743735);">Hide</span>  &nbsp; <span id="preShrink743735" onclick="processCodeBlocks.shrinkExpand(743735);">Shrink</span> <img id="preimg743735" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(743735);">  &nbsp; <span id="copycode743735" onclick="return processCodeBlocks.copyCode(743735);">Copy Code</span></div><pre id="pre743735" style="margin-top: 0px;" processed="true" class="notranslate">BOOL WINAPI DllMain(HINSTANCE instance, DWORD fdwReason, LPVOID lpvReserved)
{
   switch (fdwReason)
   {
      case DLL_PROCESS_ATTACH:
      {
         MyTypeInfo = 0;

         // Initialize our ICollection stuff
         initCollectionTypeInfo();

         // Initialize our Ports list
         if (initPortsCollection())
         {
            MessageBox(0, "Can't allocate the PortsList", "ERROR", MB_OK);
            return(0);
         }

         OutstandingObjects = LockCount = 0;

         MyIClassFactoryObj.lpVtbl = (IClassFactoryVtbl *)&amp;IClassFactory_Vtbl;

         DisableThreadLibraryCalls(instance);
         break;
      }

      case DLL_PROCESS_DETACH:
      {
         // Free our Ports list
         freePortsCollection();

         // Free our ICollection ITypeInfo
         freeCollectionTypeInfo();

         if (MyTypeInfo) MyTypeInfo-&gt;lpVtbl-&gt;Release(MyTypeInfo);
      }
   }

   return(1);
}</pre>
<h2><a name="COLLECT">Our</a> collection object's functions</h2>
<p>Now, let's write the actual functions for our <code>ICollection</code> (actually, our <code>MyRealICollection</code>). Rather than put this code in <i>IExample3.c</i>, let's create a separate source file for it, called <i>PortNames.c</i>. And, we'll put the definition of our <code>ICollection</code> VTable and its GUID in a separate <i>PortNames.h</i> file. (We can also put our above helper functions in <i>PortNames.c</i>.)</p>
<p>The <code>IUnknown</code> functions (<code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code>) and <code>IDispatch</code> functions (<code>GetTypeInfoCount</code>, <code>GetTypeInfo</code>, <code>GetIDsOfNames</code>, and <code>Invoke</code>) are almost the same as the respective functions for our <code>IExample3</code> object. So rather than reproduce the code here, I'll refer you to the file <i>PortNames.c</i> (in the directory <i>IExample3</i>).</p>
<p>One difference is that our <code>ICollection</code> functions are passed an <code>ICollection</code> object pointer (instead of an <code>IExample3</code> object pointer), of course. And, <code>ICollection</code>'s <code>Release</code> function is slightly different (since unlike <code>IExample3</code>'s <code>Release</code>, there is no buffer member to free).</p>
<p>The other key difference is the call to <code>GetTypeInfoOfGuid</code>. Note that we're passing the GUID for our <code>ICollection</code> VTable (instead of the GUID for our <code>IExample3</code> VTable, like we do in <i>IExample3.c</i>). Here's the deal. When we get an <code>ITypeInfo</code> for <code>IExample3</code> (by calling <code>loadMyTypeInfo</code> in <i>IExample3.c</i>), we pass the GUID of <code>IExample3</code>'s VTable to the OLE function <code>GetTypeInfoOfGuid</code>. The implication of this is that the default <code>ITypeInfo</code> Microsoft creates for us is good for getting information <b>only</b> about the functions in our <code>IExample3</code> VTable. <b>It cannot be used to get information about the functions in another object's VTable.</b> But, we <b>do</b> need an <code>ITypeInfo</code> that will provide us with information about our <code>ICollection</code>'s functions. So now, we have to call <code>GetTypeInfoOfGuid</code> again, but this time we pass the GUID for our <code>ICollection</code> object's VTable (i.e., the new GUID I created). This will return a second <code>ITypeInfo</code> (which we store in that global variable we added, named <code>CollectionTypeInfo</code>). This second <code>ITypeInfo</code> can be used with <code>ICollection</code>'s <code>IDispatch</code> functions to get information about <code>ICollection</code>'s functions. And it can be used with <code>DispInvoke</code> and <code>DispGetIDsOfNames</code> in <code>ICollection</code>'s <code>Invoke</code> and <code>GetIDsOfNames</code> functions to do almost all of the work for us -- just like we did with <code>IExample3</code>'s <code>ITypeInfo</code>.</p>
<p>Notice that <code>ICollection</code>'s <code>IDispatch</code> functions use this new <code>ITypeInfo</code>, whereas <code>IExample3</code>'s <code>IDispatch</code> functions use <code>IExample3</code>'s <code>ITypeInfo</code>. They are not the same <code>ITypeInfo</code>, and cannot be used interchangeably.</p>
<p>All that's left is to write the three extra functions, <code>Count</code>, <code>Item</code>, and <code>_NewEnum</code>.</p>
<p>The <code>Count</code> function is simple. It is passed a pointer to a <code>long</code>. <code>Count</code> fills in that pointer with the total number of items in our list. For example, above we have three ports (<code>IENUMITEM</code> structs) in our list, so we would return a 3.</p>
<p>Here's our <code>Count</code> function:</p><div class="pre-action-link" id="premain562926" style="width:100%;display:block;"><span id="prehide562926" onclick="processCodeBlocks.togglePre(562926);">Hide</span>  &nbsp; <span id="copycode562926" onclick="return processCodeBlocks.copyCode(562926);">Copy Code</span></div><pre id="pre562926" style="margin-top: 0px;" class="notranslate">STDMETHODIMP Count(ICollection *this, long *total)
{
   DWORD     count;
   IENUMITEM *item;

   // Count how many items in the list by just walking it all
   // the way to the last IENUMITEM, incrementing a count for
   // each item.
   count = 0;
   item = (IENUMITEM *)&amp;PortsList;
   while ((item = item-&gt;next)) ++count;

   // Return the total.
   *total = count;

   return(S_OK);
}</pre>
<p>The <code>Item</code> function is also simple. It is passed a <code>long</code> that tells us which item is being queried (where 0 is the first item, 1 is the second item, etc.). It is also passed a <code>VARIANT</code> into which we copy the value of that item.</p>
<p>Here's our <code>Item</code> function:</p><div class="pre-action-link" id="premain400687" style="width:100%;display:block;"><span id="prehide400687" onclick="processCodeBlocks.togglePre(400687);">Hide</span>  &nbsp; <span id="preShrink400687" onclick="processCodeBlocks.shrinkExpand(400687);">Shrink</span> <img id="preimg400687" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(400687);">  &nbsp; <span id="copycode400687" onclick="return processCodeBlocks.copyCode(400687);">Copy Code</span></div><pre id="pre400687" style="margin-top: 0px;" processed="true" class="notranslate">STDMETHODIMP Item(ICollection *this, long index, VARIANT *ret)
{
   IENUMITEM  *item;

   // Assume we have nothing to return.
   ret-&gt;vt = VT_EMPTY;

   // Locate to the item that the caller wants.
   item = (IENUMITEM *)PortsList;
   while (item &amp;&amp; index--) item = item-&gt;next;

   // Any more items left?
   if (item)
   {
      // Copy the item's value to the VARIANT that the caller supplied.
      // If what we're returning to the caller is an object, we must AddRef()
      // it on the caller's behalf. The caller is expected to Release() it
      // when done with it. If what we're returning is a BSTR, then we must
      // SysAllocString a copy of it. Caller is expected to SysFreeString it.
      // Other datatypes are simply copied to the caller's VARIANT as is.
      // VariantCopy() does all this for us. It also returns S_OK if all
      // went well.
      return(VariantCopy(ret, &amp;item-&gt;value));
   }

   // If no more items, return S_FALSE.
   return(S_FALSE);
}</pre>
<p>As you'll note from the comment above, the OLE function <code>VariantCopy</code> does half the work for us.</p>
<p>For now, we'll gloss over the <code>_NewEnum</code> function. We'll stick in a dummy one that returns <code>E_NOTIMPL</code>.</p>
<p>Once we have all the <code>ICollection</code> functions written, we can statically declare its VTable:</p><div class="pre-action-link" id="premain148908" style="width:100%;display:block;"><span id="prehide148908" onclick="processCodeBlocks.togglePre(148908);">Hide</span>  &nbsp; <span id="copycode148908" onclick="return processCodeBlocks.copyCode(148908);">Copy Code</span></div><pre id="pre148908" style="margin-top: 0px;" class="notranslate">static const ICollectionVtbl ICollectionVTable = 
      {Collection_QueryInterface,
       Collection_AddRef,
       Collection_Release,
       GetTypeInfoCount,
       GetTypeInfo,
       GetIDsOfNames,
       Invoke,
       Count,
       Item,
       _NewEnum};</pre>
<h2><a name="HOW">How</a> an application obtains our collection object</h2>
<p>Let's consider how an application gets hold of one of our <code>MyRealICollection</code> objects. The easiest thing to do is to add another (extra) function to our <code>IExample3</code> object. The application will call this new function to allocate and receive one of our <code>MyRealICollection</code> objects. (But we're going to lie to the application and tell it that it's just an ordinary <code>IDispatch</code>.)</p>
<p>We need to change the definition of <code>IExample3</code>'s VTable (in <i>IExample3.h</i>), to add this new function, which I'll arbitrarily call <code>GetPorts</code>. I'll define it as being passed a handle to an <code>IDispatch</code>, which is where we'll return the pointer to our newly allocated <code>MyRealICollection</code>... er, <code>IDispatch</code>. Yeah, that's it. It's just an <code>IDispatch</code>. Wink, wink. Here's our updated <code>IExample3</code> VTable:</p><div class="pre-action-link" id="premain353516" style="width:100%;display:block;"><span id="prehide353516" onclick="processCodeBlocks.togglePre(353516);">Hide</span>  &nbsp; <span id="copycode353516" onclick="return processCodeBlocks.copyCode(353516);">Copy Code</span></div><pre id="pre353516" style="margin-top: 0px;" class="notranslate">// IExample3's VTable
#undef  INTERFACE
#define INTERFACE IExample3
DECLARE_INTERFACE_ (INTERFACE, IDispatch)
{
    // IUnknown functions
    STDMETHOD  (QueryInterface) (THIS_ REFIID, void **) PURE;
    STDMETHOD_ (ULONG, AddRef) (THIS) PURE;
    STDMETHOD_ (ULONG, Release) (THIS) PURE;
    // IDispatch functions
    STDMETHOD_ (ULONG, GetTypeInfoCount)(THIS_ UINT *) PURE;
    STDMETHOD_ (ULONG, GetTypeInfo) (THIS_ UINT, LCID, ITypeInfo **) PURE;
    STDMETHOD_ (ULONG, GetIDsOfNames) (THIS_ REFIID, LPOLESTR *, 
                UINT, LCID, DISPID *) PURE;
    STDMETHOD_ (ULONG, Invoke) (THIS_ DISPID, REFIID, LCID, 
                WORD, DISPPARAMS *, VARIANT *, EXCEPINFO *, UINT *) PURE;
    // Extra functions
    STDMETHOD  (SetString) (THIS_ BSTR) PURE;
    STDMETHOD  (GetString) (THIS_ BSTR *) PURE;
    STDMETHOD  (GetPorts) (THIS_ IDispatch **) PURE;  // &lt;--- Added GetPorts here
};</pre>
<p>Notice that I added <code>GetPorts</code> to the end of the VTable. Also notice, I'm specifying that <code>GetPorts</code> will fill in an <code>IDispatch</code> pointer (even though it will really be our <code>MyRealICollection</code>). It's an <code>IDispatch</code>. Honest. Would I lie?</p>
<p>And I have to make the same change in the IDL file for our <code>IExample3</code> VTable:</p><div class="pre-action-link" id="premain17555" style="width:100%;display:block;"><span id="prehide17555" onclick="processCodeBlocks.togglePre(17555);">Hide</span>  &nbsp; <span id="copycode17555" onclick="return processCodeBlocks.copyCode(17555);">Copy Code</span></div><pre id="pre17555" style="margin-top: 0px;" class="notranslate">[uuid(CFADB388-9563-4591-AABB-BE7794AEC17C), dual, 
             oleautomation, hidden, nonextensible]
interface IExample3VTbl : IDispatch
{
   [helpstring("Sets the test string.")]
   [id(1), propput] HRESULT Buffer([in] BSTR);
   [helpstring("Gets the test string.")]
   [id(1), propget] HRESULT Buffer([out, retval] BSTR *);
   [helpstring("Gets the enumeration for our hardware ports.")]
   [id(2), propget] HRESULT Ports([out, 
           retval] IDispatch **);  // &lt;--- Added GetPorts here
};</pre>
<p>Notice, I made this newly added function a <code>propget</code>, just like <code>Buffer</code>. This is so that a script can use an ordinary assignment instruction to get our <code>MyRealICollection</code>... duh!... <code>IDispatch</code> object. The member is called "<code>Ports</code>" as far as the script is concerned. Never mind that we don't actually have a <code>Ports</code> data member in our <code>IExample3</code> object. This is sort of a phony member. But the script doesn't need to know that.</p>
<p>And, I arbitrarily gave it a DISPID of 2.</p>
<p>Don't forget that we need to add this function to our statically declared <code>IExample3Vtbl</code> in <i>IExample3.c</i>:</p><div class="pre-action-link" id="premain664944" style="width:100%;display:block;"><span id="prehide664944" onclick="processCodeBlocks.togglePre(664944);">Hide</span>  &nbsp; <span id="copycode664944" onclick="return processCodeBlocks.copyCode(664944);">Copy Code</span></div><pre id="pre664944" style="margin-top: 0px;" class="notranslate">static const IExample3Vtbl IExample3_Vtbl = {QueryInterface,
AddRef,
Release,
GetTypeInfoCount,
GetTypeInfo,
GetIDsOfNames,
Invoke,
SetString,
GetString,
GetPorts}; // &lt;--- Added GetPorts here</pre>
<p>So, we need to write the <code>GetPorts</code> function:</p><div class="pre-action-link" id="premain254782" style="width:100%;display:block;"><span id="prehide254782" onclick="processCodeBlocks.togglePre(254782);">Hide</span>  &nbsp; <span id="copycode254782" onclick="return processCodeBlocks.copyCode(254782);">Copy Code</span></div><pre id="pre254782" style="margin-top: 0px;" class="notranslate">static HRESULT STDMETHODCALLTYPE GetPorts(IExample3 *this, IDispatch **portsObj)
{
   // Create an IDispatch to enumerate our port names.
   // Caller is responsible for Release()'ing
   // it. NOTE: We're really returning a MyRealICollection,
   // but the caller doesn't know that.
   // He thinks we're returning an IDispatch,
   // which is ok because a MyRealICollection's
   // VTable starts with the 3 IUnknown functions
   // followed by the 4 IDispatch functions, just
   // like a real IDispatch object's VTable
   if (!(*portsObj = allocPortsCollection()))
      return(E_OUTOFMEMORY);
}</pre>
<p>The above simply calls another helper function (named <code>allocPortsCollection</code>) we'll put in <i>PortNames.c</i>. This helper function does the work of <code>GlobalAlloc</code>'ing a <code>MyRealICollection</code> and initializing it. It's fairly similar to how our <code>IClassFactory</code>'s <code>CreateInstance</code> <code>GlobalAlloc</code>s an <code>IExample3</code> and initializes it. We even bump up the count of outstanding objects because our <code>MyRealICollection</code>... er, <code>IDispatch</code> object is going to be given to some application (which is expected to later <code>Release</code> it).</p><div class="pre-action-link" id="premain934290" style="width:100%;display:block;"><span id="prehide934290" onclick="processCodeBlocks.togglePre(934290);">Hide</span>  &nbsp; <span id="copycode934290" onclick="return processCodeBlocks.copyCode(934290);">Copy Code</span></div><pre id="pre934290" style="margin-top: 0px;" class="notranslate">IDispatch * allocPortsCollection(void)
{
   MyRealICollection *collection;

   // Allocate a MyRealICollection
   if ((collection = (MyRealICollection *)GlobalAlloc(
                      GMEM_FIXED, sizeof(MyRealICollection))))
   {
      // Store its VTable
      collection-&gt;lpVtbl = (ICollectionVtbl *)&amp;ICollectionVTable;

      // AddRef it
      collection-&gt;count = 1;

      // Indicate another outstanding object since we'll be returning it
      // to an application which is expected to Release() it
      InterlockedIncrement(&amp;OutstandingObjects);
   }

   // Return it as if it were an IDispatch (which it can be used as)
   return((IDispatch *)collection);
}</pre>
<p>We're done. You can compile the <i>IExample3.dll</i>. To register it, just take <code>IExample2</code>'s register utility (<i>RegIExample2</i>) and replace every "IExample2" with "IExample3". After all, there is nothing about <code>IExample3</code> which requires us to register it any differently than <code>IExample2</code>. Likewise, to un-register it, modify <code>IExample2</code>'s un-register utility (<i>UnregIExample2</i>).</p>
<h2><a name="VB1">A</a> VBScript example</h2>
<p>Let's write a VBScript example that uses our collection to display the port names. I've written such an example (<i>IExample3.vbs</i>), and placed it in the <i>IExample3</i> directory.</p>
<p>Of course, the VBScript needs to first call <code>CreateObject</code> to get one of our <code>IExample3</code> objects. If you installed it properly, it should have a ProdID of "<code>IExample3.object</code>". Now that the script has our <code>IExample3</code>, it can simply access that phony "<code>Ports</code>" member to get one of our <code>MyRealICollection</code>... damn!... <code>IDispatch</code> objects to use. Here, we assign it to a variable named "<code>coll</code>".</p><div class="pre-action-link" id="premain784349" style="width:100%;display:block;"><span id="prehide784349" onclick="processCodeBlocks.togglePre(784349);">Hide</span>  &nbsp; <span id="copycode784349" onclick="return processCodeBlocks.copyCode(784349);">Copy Code</span></div><pre id="pre784349" style="margin-top: 0px;" class="notranslate" lang="vbscript"><span class="code-keyword">Set</span> coll = myObj.Ports</pre>
<p>Next, we can call the <code>Count</code> function to determine how many port names there are. Actually, because our type library defined this function as <code>propget</code>, the script can use an assignment.</p><div class="pre-action-link" id="premain45991" style="width:100%;display:block;"><span id="prehide45991" onclick="processCodeBlocks.togglePre(45991);">Hide</span>  &nbsp; <span id="copycode45991" onclick="return processCodeBlocks.copyCode(45991);">Copy Code</span></div><pre id="pre45991" style="margin-top: 0px;" class="notranslate" lang="vbscript">count = coll.Count</pre>
<p>Now, we loop around, calling the <code>Item</code> function to get each port name, and display it:</p><div class="pre-action-link" id="premain540877" style="width:100%;display:block;"><span id="prehide540877" onclick="processCodeBlocks.togglePre(540877);">Hide</span>  &nbsp; <span id="copycode540877" onclick="return processCodeBlocks.copyCode(540877);">Copy Code</span></div><pre id="pre540877" style="margin-top: 0px;" class="notranslate" lang="vbscript"><span class="code-keyword">For</span> i = <span class="code-digit">0</span> To count - <span class="code-digit">1</span>
   MsgBox coll.Item(i)
<span class="code-keyword">Next</span></pre>
<p>And, that's it.</p>
<h2><a name="C1">A</a> C example</h2>
<p>For a C/C++ application to use our collection object, it needs to call our <code>Count</code> and <code>Item</code> functions indirectly, through the <code>Invoke</code> function. Hold on to your seats because this is going to be a bumpy ride. The MS Visual Basic programmers designed the <code>IDispatch</code>
 functions to be passed arguments, and return values, such that those 
folks could easily add COM support to VB and get it out the door 
quickly. But they didn't give any concern to how easy it would be to 
utilize the <code>IDispatch</code> functions from any other language. It's a major pain in the butt from C/C++.</p>
<p>In the directory <i>IExample3App</i>, is an example C application that does just what the VBScript above does. It obtains our <code>Ports</code> collection object, and uses it to display the names of all ports. I'm not going to discuss how the C app gets our <code>IExample3</code> object. That is exactly the same as how it gets an <code>IExample2</code> object (except we <code>#include IExample3.h</code>, and use the <code>IExample3</code> object's GUID).</p>
<p>The main point of interest begins where we call our <code>IExample3</code>'s <code>GetPorts</code> function to get our <code>MyRealICollection</code>... *cough*... <code>IDispatch</code> object. That starts where I put the following comment (in <i>IExample3App.c</i>):</p><div class="pre-action-link" id="premain638830" style="width:100%;display:block;"><span id="prehide638830" onclick="processCodeBlocks.togglePre(638830);">Hide</span>  &nbsp; <span id="copycode638830" onclick="return processCodeBlocks.copyCode(638830);">Copy Code</span></div><pre id="pre638830" style="margin-top: 0px;" class="notranslate">// STUDY THIS</pre>
<p>Peruse all of that code and read the comments. They detail the steps you need to jump though to use <code>IDispatch</code>
 functions from C/C++. Then, take an MS Visual Basic programmer out to 
lunch to "thank" him, and slip lots of hot pepper into his food when he 
isn't looking.</p>
<h2><a name="ENUM">An</a> IEnumVARIANT object</h2>
<p>If we look at the following lines in our <code>Item</code> function, something may alarm us:</p><div class="pre-action-link" id="premain93647" style="width:100%;display:block;"><span id="prehide93647" onclick="processCodeBlocks.togglePre(93647);">Hide</span>  &nbsp; <span id="copycode93647" onclick="return processCodeBlocks.copyCode(93647);">Copy Code</span></div><pre id="pre93647" style="margin-top: 0px;" class="notranslate">// Locate to the item that the caller wants.
item = (IENUMITEM *)PortsList;
while (item &amp;&amp; index--) item = item-&gt;next;</pre>
<p>Every time someone calls our <code>Item</code> function, we have to 
start at the head of the list and search to the desired item. Assume we 
have 30,000 items in the list. Say, an application asks us to fetch item
 28,000. We have to walk through 27,000 items before we get to the 
desired item. Now, let's say the application calls <code>Item</code> 
again to request item 29,000. Even though it's only one more link away, 
we start all over from the head of the list and walk though the 28,000 
items. Obviously, this isn't very efficient.</p>
<p>We could perhaps add another data member to our <code>MyRealICollection</code>.
 This member would store the "position" where we last left off in the 
list. Microsoft thought about this, and then decided, instead of 
monkey-ing around with the collection object (which really isn't 
designed to be efficiently called from C/C++ anyway, thanks to VB 
developers), a second standard COM object, called an <code>IEnumVARIANT</code>, would be defined. The main purpose of an <code>IEnumVARIANT</code>
 is to store the current position that an application has "read from" 
within the list. But given how inefficient and troublesome it is for a 
C/C++ app to call our collection's <code>Item</code> function indirectly via <code>Invoke</code>, MS decided to have some functions in the <code>IEnumVARIANT</code> that an app can <b>directly</b> call to do what we previously did with the collection's <code>Item</code> function... and more. Specifically, an <code>IEnumVARIANT</code> has four functions in it (plus the three <code>IUnknown</code> functions, of course) named <code>Next</code>, <code>Skip</code>, <code>Reset</code>, and <code>Clone</code>.</p>
<ul>
<li>The <code>IEnumVARIANT</code>'s <code>Next</code> function makes our collection object's <code>Item</code> function superfluous. With a single call to <code>Next</code>, an app can return the values of several items at once (by supplying a count of how many items to return, and an array of <code>VARIANT</code>s to store all the values). So, an app could call <code>Next</code> to read four items. On the next call to <code>Next</code>, our <code>IEnumVARIANT</code> will automatically start reading at the fifth item in the list, and return however many values the app requests. 
</li><li>The <code>IEnumVARIANT</code>'s <code>Reset</code> simply resets the position back to the start of the list. 
</li><li>The <code>IEnumVARIANT</code>'s <code>Skip</code> sets the 
position to a particular point (i.e., it's analogous to seeking within a
 disk file, except, here it sets the position within our list). 
</li><li>The <code>IEnumVARIANT</code>'s <code>Clone</code> allocates (and returns to the app) another <code>IEnumVARIANT</code> object whose position is the same as the <code>IEnumVARIANT</code>
 being cloned. This is used in case an app wants to nest loops where 
it's necessary to remember more than one position in a particular list. </li></ul>
<p>Microsoft has already defined (in an include file that ships with your compiler) an <code>IEnumVARIANT</code>
 object and its VTable (i.e., Microsoft has already decided what 
functions are in the VTable, what those functions are passed, and what 
they return). So, we don't need to do that. But like with all the 
objects we've created so far, we need to add a couple extra data members
 to our <code>IEnumVARIANT</code>. So once again, we'll define a <code>MyRealIEnumVariant</code> that has these extra members.</p>
<p>But before we modify our <code>IExample3</code> sources, let's again make a new directory named <i>IExample4</i>.
 We'll do that thing where we copy the sources to this new directory, 
and rename/edit them. Search and replace "IExample3" with "IExample4". 
Run <i>GUIDGEN.EXE</i> to create new GUIDs, and put them in <i>IExample4.h</i>, <i>PortNames.h</i>, and <i>IExample4.idl</i>. Once again, I've done this for you, and created an <i>IExample4</i> directory with the new files.</p>
<p>In <i>PortNames.c</i>, we'll add the definition of our <code>MyRealIEnumVariant</code> object, write all its functions, and statically declare its VTable. This all done starting at the comment:</p><div class="pre-action-link" id="premain490446" style="width:100%;display:block;"><span id="prehide490446" onclick="processCodeBlocks.togglePre(490446);">Hide</span>  &nbsp; <span id="copycode490446" onclick="return processCodeBlocks.copyCode(490446);">Copy Code</span></div><pre id="pre490446" style="margin-top: 0px;" class="notranslate">//==============================================================
//=================== IEnumVARIANT functions ===================
//==============================================================</pre>
<p>In fact, you should now be quite familiar with what its <code>QueryInterface</code>, <code>AddRef</code>, and <code>Release</code>
 functions do. And the other four functions are rather trivial, so you 
can peruse the source code comments to get details about those 
functions.</p>
<p>The real question is <i>"How does an app get hold of one of my <code>IEnumVARIANT</code> objects?"</i>. Remember before, how we ignored our collection object's <code>_NewEnum</code> function, and just had it return <code>E_NOTIMPL</code>? Well, guess what. That's the function an app calls to get one of our <code>IEnumVARIANT</code> objects, so now we have to write some real code for it.</p>
<p>In other words, to get one of our <code>IEnumVARIANT</code>s, the app must first get our <code>IExample4</code> object, call our <code>IExample4</code>'s <code>GetPorts</code> function to get our collection object, and then call our collection's <code>_NewEnum</code> function to get an <code>IEnumVARIANT</code>. It's not the short way home, but that's how it works. Some bad news: a C/C++ app can't directly call our collection's <code>_NewEnum</code> function. Just like with our collection's <code>Count</code> and <code>Item</code> functions, a C/C++ app has to indirectly call <code>_NewEnum</code> through <code>Invoke</code>. Blech. The good news is that, once our C/C++ app has the <code>IEnumVARIANT</code>, the collection object can be <code>Release()</code>d and we're done with that latter aberration.</p>
<p>So, let's examine our collection's <code>_NewEnum</code> function:</p><div class="pre-action-link" id="premain398442" style="width:100%;display:block;"><span id="prehide398442" onclick="processCodeBlocks.togglePre(398442);">Hide</span>  &nbsp; <span id="copycode398442" onclick="return processCodeBlocks.copyCode(398442);">Copy Code</span></div><pre id="pre398442" style="margin-top: 0px;" class="notranslate">STDMETHODIMP _NewEnum(ICollection *this, IUnknown **enumObj)
{
   IEnumVARIANT *enumVariant;

   if (!(enumVariant = allocIEnumVARIANT())) return(E_OUTOFMEMORY);
   *enumObj = (IUnknown *)enumVariant;
   return(S_OK);
}</pre>
<p>This just calls our helper function named <code>allocIEnumVARIANT</code> which allocates and initializes our <code>IEnumVARIANT</code> (actually, a <code>MyRealIEnumVariant</code>) much like how our <code>IClassFactory</code>'s <code>CreateInstance</code> allocates our <code>IExample4</code> object, or our <code>IExample4</code>'s <code>GetPorts</code> function allocates our collection object. There's really nothing new here.</p>
<p>But notice that <code>_NewEnum</code> asks the app to pass a handle where we return an <code>IUnknown</code> object -- not an <code>IEnumVARIANT</code>. Yes, it's true that we're really returning our <code>IEnumVARIANT</code>, but it is masquerading as an <code>IUnknown</code> object, and it can do that because its VTable starts with the three <code>IUnknown</code> functions.</p>
<p><i>"But why masquerade? Didn't you just say that <code>_NewEnum</code> is used to get hold of our <code>IEnumVARIANT</code>?"</i></p>
<p>Yes... in a roundabout manner. [Cue scary monster movie soundtrack.]</p>
<p>In a previous article, I alluded to the fact that a COM object could 
actually have many VTables inside of it. We say that such an object has 
"multiple interfaces". Microsoft decided that <code>_NewEnum</code> should be able to pass back an object that could have multiple interfaces, and the <code>IEnumVARIANT</code>
 may be just one of many VTables in it (and not even the first VTable in
 the object). So, what an app is expected to do is take this <code>IUnknown</code> object we give it, and call that object's <code>QueryInterface</code>, passing the GUID for an <code>IEnumVARIANT</code> (<code>IID_IEnumVARIANT</code>, which is defined in Microsoft's include files for us). And then, <code>QueryInterface</code> will return a pointer to the <code>IEnumVARIANT</code> VTable (i.e., essentially, the <code>IEnumVARIANT</code> embedded inside of whatever object that <code>IUnknown</code> object really is -- because you just know it's something else masquerading as an <code>IUnknown</code>).</p>
<p>In our case, the app is going to call our <code>IEnumVARIANT</code>'s <code>QueryInterface</code>, asking us for an <code>IEnumVARIANT</code>.
 And, we're just going to return the same pointer again. Totally 
unnecessary. Inefficient. Illogical. But, that's sometimes how COM is 
when you've got parts of it that are designed by MS VB developers (who 
had a vested interest in making the whole <code>IDispatch</code> thing a
 lot like how VB internally calls its own built-in functions, thus 
minimizing their work, and foisting this design on everyone else 
regardless of how inconvenient and unwieldy that can be), and other 
programmers who wanted to use things like multiple interfaces (which a 
VBScript can't even directly use -- talk about a comedy of errors).</p>
<p>Anyway, we've got our <code>IEnumVARIANT</code> support done, so we can compile <i>IExample4.dll</i>. To register it, once again, you can modify <i>RegIExample2.c</i>, searching and replacing "IExample2" with "IExample4".</p>
<h2><a name="VB2">Another</a> VBScript example</h2>
<p>A VBScript can absolutely not call our collection's <code>_NewEnum</code> function (because this may return an object with multiple interfaces that need to be <code>QueryInterface</code>d -- and a VBScript can't deal with such an object). So, a VBScript cannot obtain our <code>IEnumVARIANT</code> and call its functions.</p>
<p>Does this mean an <code>IEnumVARIANT</code> is useless to a VBScript? Nope. The VBScript engine can itself use our <code>IEnumVARIANT</code>. When does the engine do that? When the script uses a <code lang="vbscript">For Each</code> loop to enumerate the items in our collection. In the directory <i>IExample4</i> is a VBScript named <i>IExample4.vbs</i> which uses such a <code lang="vbscript">For Each</code> loop. This is a slightly different way for the script to do the same thing that <i>IExample3.vbs</i> did, but it's more efficient under-the-hood (because the engine uses our <code>IEnumVARIANT</code>'s <code>Next</code> function, instead of the VBScript using our collection object's <code>Item</code>
 function). And, it's slightly less coding on the part of the script 
because the engine retrieves the item's value on behalf of the script. 
Here's how it's done:</p><div class="pre-action-link" id="premain235114" style="width:100%;display:block;"><span id="prehide235114" onclick="processCodeBlocks.togglePre(235114);">Hide</span>  &nbsp; <span id="copycode235114" onclick="return processCodeBlocks.copyCode(235114);">Copy Code</span></div><pre id="pre235114" style="margin-top: 0px;" class="notranslate" lang="vbscript"><span class="code-keyword">set</span> myObj = <span class="code-keyword">CreateObject</span>(<span class="code-string">"</span><span class="code-string">IExample4.object"</span>)
<span class="code-keyword">Set</span> coll = myObj.Ports
<span class="code-keyword">For</span> <span class="code-keyword">Each</span> elem In coll
   MsgBox elem
<span class="code-keyword">Next</span></pre>
<p>The first two lines are the same as <i>IExample3.vbs</i> (except that we use the ProdID for <i>IExample4.dll</i> now).</p>
<p>But the loop is different. When the VBScript engine executes that <code lang="vbscript">For Each</code> line, it gets hold of our <code>IEnumVARIANT</code> (by calling our collection's <code>_NewEnum</code>, and doing a <code>QueryInterface</code> for <code>IID_IEnumVARIANT</code>). It stores away this <code>IEnumVARIANT</code> internally so it can be used on subsequent iterations of the loop. Then, it calls our <code>IEnumVARIANT</code>'s <code>Next</code> function, asking for an item's value to be returned. Of course, the first time <code>Next</code>
 is called, we return the port name for the first item (i.e., the string
 "Port 1"). The VB engine stuffs this string into the variable "<code>elem</code>". This is all done in that one VBScript instruction. Now, the script simply displays the value of "<code>elem</code>" (which is the string "Port 1"). On the next iteration of the loop, the VB engine once again calls our <code>IEnumVARIANT</code>'s <code>Next</code> function, asking for one more item's value. This is the second time <code>Next</code> has been called, so of course, we return the second item's value, which is the string "Port 2". The VB engine now updates the <code>elem</code> variable to this new value. And the script displays "Port 2". This continues on until the VB engine calls our <code>IEnumVARIANT</code>'s <code>Next</code>, and we have no more items to return. At that point, <code>Next</code> returns <code>S_FALSE</code> (instead of <code>S_OK</code>) to the engine. And, the engine drops out of the loop (and <code>Release</code>s our <code>IEnumVARIANT</code>).</p>
<h2><a name="C2">Another</a> C example</h2>
<p>In the directory <i>IExample4App</i>, there is a C example that demonstrates how to get and use our <code>IEnumVARIANT</code>. We still have to mess with the collection object and its <code>Invoke</code>. But at least, the loop is more efficient. And the whole thing is less involved than using the collection object's <code>Item</code> function.</p>
<h2><a name="GENERIC">A</a> more generic approach</h2>
<p>If you look at the <code>IEnumVARIANT</code> and the collection functions in <i>PortName.c</i>, you'll see that these are hard-wired to work upon only our list of port names (i.e., <code>PortsList</code>). But with a small bit of retooling, we can rewrite those functions to work upon any linked list of <code>IENUMITEM</code>s
 we throw at them. In other words, we can make these functions generic, 
so if our component needs to maintain several different types of lists, 
we can more easily provide further collection and <code>IEnumVARIANT</code> objects that reuse these same functions without any further modification. So, let's separate just the <code>IEnumVARIANT</code> and the collection functions into a new, separate source file named <i>IEnumVariant.c</i>. The only stuff we'll leave in <i>PortNames.c</i> is the code that specifically accesses our <code>PortsList</code>.</p>
<p>But first, we'll do that thing where we create a new <i>IExample5</i> directory, copy the files there, and rename/edit them. You should know the routine by now. I've done the work, and created an <i>IExample5</i> directory.</p>
<p>Instead of simply declaring a global variable that is the list itself, we'll wrap the list in another struct we'll call a <code>IENUMLIST</code>, as so:</p><div class="pre-action-link" id="premain130250" style="width:100%;display:block;"><span id="prehide130250" onclick="processCodeBlocks.togglePre(130250);">Hide</span>  &nbsp; <span id="copycode130250" onclick="return processCodeBlocks.copyCode(130250);">Copy Code</span></div><pre id="pre130250" style="margin-top: 0px;" class="notranslate">typedef struct {
   struct _IENUMITEM *head;
   DWORD             count;
} IENUMLIST;</pre>
<p>The <code>head</code> member is where the list is stored. And we've added a <code>count</code> field that will be incremented each time we create another collection or <code>IEnumVARIANT</code> object that uses this particular list.</p>
<p>Now, we change our <code>PortsList</code> global to this new struct:</p><div class="pre-action-link" id="premain891504" style="width:100%;display:block;"><span id="prehide891504" onclick="processCodeBlocks.togglePre(891504);">Hide</span>  &nbsp; <span id="copycode891504" onclick="return processCodeBlocks.copyCode(891504);">Copy Code</span></div><pre id="pre891504" style="margin-top: 0px;" class="notranslate">IENUMLIST    PortsList;</pre>
<p>The key to making our collection and <code>IEnumVARIANT</code> functions more generic is adding an extra data member to our <code>MyRealIEnumVariant</code> and <code>MyRealICollection</code> objects. We'll add a member to our <code>MyRealICollection</code> that holds a pointer to the <code>IENUMLIST</code> it should operate upon. And, we'll write a new helper function that will allocate a <code>MyRealICollection</code> object. This helper function will be passed that <code>IENUMLIST</code> pointer, and will store it in this new data member added to our <code>MyRealICollection</code>. I've written such a function (<code>allocICollection</code>) and put it in <i>IEnumVariant.c</i>. It's passed a pointer to whatever <code>IENUMLIST</code> we want our collection object to operate upon.</p>
<p>We'll also add a data member to our <code>MyRealIEnumVariant</code>. It will do the same thing as the new data member added to our <code>MyRealICollection</code> (i.e., hold a pointer to the <code>IENUMLIST</code> that our <code>IEnumVARIANT</code> operates upon).</p>
<p>Other changes are trivial, but what we're left with in <i>PortNames.c</i> is just a little bit of code to create and delete our <code>PortsList</code>, and to create a collection object specifically to wrap <code>PortsList</code>.</p>
<p>To create another list, and add support for a collection and <code>IEnumVARIANT</code> objects, all we need do is create another source file, much like what is in <i>PortNames.c</i>. In fact, let's do this.</p>
<p>Let's assume that we want to create a list of network cards in a 
system. And for each network card, we want to provide two pieces of 
information: the name of the network card, and its MAC address. We'll 
put the code in <i>NetCards.c</i> and <i>NetCards.h</i>.</p>
<p>We want to return more than one piece of information per item. (I.e., each <code>IENUMITEM</code>
 will pertain to a single network card. And for each network card, we 
want to let the script know the card's name and its MAC address.) The 
best way to approach this is to create a "sub-object" which we'll 
arbitrarily call a <code>INetwork</code> object. We'll put two functions in this object, <code>Name</code> and <code>Address</code>. The <code>Name</code> function will return a <code>BSTR</code> of the network card's name, and the <code>Address</code> function will return a <code>BSTR</code> of the MAC address.</p>
<p>We're going to create an <code>INetwork</code> object for each network card in the computer. Then, we're going to create an <code>IENUMITEM</code> in our list for that card. We'll stuff the <code>INetwork</code> pointer into the <code>IENUMITEM</code> <code>VARIANT</code>'s <code>punkVal</code> field, and set the <code>vt</code> field to <code>VT_DISPATCH</code>. This list of <code>IENUMITEM</code>s (containing <code>INetwork</code> objects) is created in <code>allocNetworkObjectsCollection</code> (in <i>NetCards.c</i>).</p>
<p>In order to be accessible from VBScript, we'll need to include the <code>IDispatch</code> functions in our <code>INetwork</code>'s VTable. Of course, this means that we'll need an <code>ITypeInfo</code> for our <code>INetwork</code>'s VTable. So, we'll have to generate a new GUID for its VTable. And, we'll have to call <code>GetTypeInfoOfGuid</code>, passing that new GUID, to get an <code>ITypeInfo</code> for it. We'll save this in a global variable named <code>NetTypeInfo</code>. All this code is in <i>NetCards.c</i>. This code should look remarkably similar to what you saw with our collection and <code>IExample5</code> objects, because those also have <code>IDispatch</code> functions and need their <code>ITypeInfo</code> objects.</p>
<p>And to make our <code>INetwork</code>'s extra functions (i.e., <code>Name</code> and <code>Address</code>) directly callable from C/C++, we'll need to declare its VTable as "<code>dual</code>" in our IDL file. We'll also have to include its VTable definition in <i>IExample5.h</i> so a C/C++ app knows exactly what order and arguments those extra functions involve. I've added the definition of our <code>INetwork</code>'s VTable to both <i>IExample5.h</i> and <i>IExample5.idl</i>. Note that it looks remarkably similar to our <code>IExample5</code> object. Both contain <code>IDispatch</code> functions. Both are declared <code>dual</code>. Their only differences are in their extra functions. But like our <code>IEnumVARIANT</code> object, our <code>INetwork</code> object itself doesn't need to be declared in our IDL. Only its VTable needs to be declared. After all, our <code>INetwork</code> is going to look like a standard <code>IDispatch</code> object to an app, except that its extra functions <b>will</b> be in its VTable, and a C/C++ app can call them directly.</p>
<p>By giving our <code>IENUMLIST</code> a <code>count</code> field, we can determine when all the collection and <code>IEnumVARIANT</code>
 objects are done with its list, and therefore delete the list whenever 
we want. (I.e., unlike the previous example, we aren't restricted to 
deleting the list only when our DLL terminates.) In fact, you'll notice 
that we don't actually create our list of <code>INetwork</code> objects until an app actually asks us for our collection of network cards. And then, we delete the list of <code>INetwork</code> objects as soon as the last collection/<code>IEnumVARIANT</code> using that list is <code>Release()</code>d.</p>
<p>In the <i>IExample5</i> directory is a VBScript example that does a <code lang="vbscript">For Each</code> loop to gain access to each one of our <code>INetwork</code> objects, and then calls the <code>Name</code> and <code>Address</code> functions to display the card's name and MAC address.</p>
<h2><a name="ADD">Add/Remove</a> items</h2>
<p>Sometimes, we may want to give a script/app the ability to add or 
remove items from our list. The traditional approach for this is to put <code>Add</code> and <code>Remove</code>
 functions in our collection object. Because each list may contain 
different kinds of items, requiring different kinds of data, you'll have
 to define another collection object specific to a particular list. 
You'll define its VTable, and put these extra two functions (<code>Add</code> and <code>Remove</code>) in it. The <code>Add</code>
 function will have to be written so that the script/app can pass in 
whatever data is needed to create the new item. (And, the function may 
first search the list to see if there's already a matching item, so that
 duplicate items are avoided). The <code>Remove</code> function should be passed some arg(s) that allow you to locate the desired item to delete.</p>
<p>Of course, you'll need to generate a GUID for this new collection's VTable. And, you'll need to create an <code>ITypeInfo</code> for it by passing its GUID to <code>GetTypeInfoOfGuid</code>, and storing the <code>ITypeInfo</code> in a global that is used by <code>Invoke</code>, <code>GetTypeInfo</code>, and <code>GetIDsOfNames</code>.</p>
<p>The good news is that you can use many of the same functions (in <i>IEnumVariant.c</i>) that our original collection (<code>ICollection</code>) and <code>IEnumVARIANT</code> uses. So, there is not as much new code to write as you may expect.</p>


						</div>
						

						<div class="float-right" style="margin:20px 0 0 10px;border:1px solid #ccc">
						<div class="msg-300x250" data-format="300x250" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Platforms-Frameworks-Libraries/COM-COMplus/COM" data-country="US" data-loadonview="true" data-tags="C++, C, VBScript, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5" data-cookieconsent="true"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Platforms-Frameworks-Libraries/COM-COMplus/COM&sz=300x250&c=971274"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Platforms-Frameworks-Libraries/COM-COMplus/COM&sz=300x250&c=971274"  width="300px" height="250px" target="_blank"/></a></noscript></div>
						</div>
                        
                        
						
						<h2>License</h2>
						<div id="LicenseTerms"><p>This article, along with any associated source code and files, is licensed under <a href="http://www.codeproject.com/info/cpol10.aspx" rel="license">The Code Project Open License (CPOL)</a></p></div>
						<h2>Share</h2>
				        <div class="share-list">
					        

    <ul class="rrssb-buttons clearfix rrssb-1">
        <li id="ctl00_SocialLike_Email" class="email compact">
            <a href="mailto:?subject=COM%20in%20plain%20C%2c%20Part%203%20-%20CodeProject&amp;body=Here%27s%20an%20interesting%20article%20on%20for%20you%20on%20codeproject.com%0a%0ahttps%3a%2f%2fwww.codeproject.com%2fArticles%2f14037%2fCOM-in-plain-C-Part-3%0a">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                        <g>
                            <path d="M20.111 26.147c-2.336 1.051-4.361 1.401-7.125 1.401c-6.462 0-12.146-4.633-12.146-12.265 
                                c0-7.94 5.762-14.833 14.561-14.833c6.853 0 11.8 4.7 11.8 11.252c0 5.684-3.194 9.265-7.399 
                                9.3 c-1.829 0-3.153-0.934-3.347-2.997h-0.077c-1.208 1.986-2.96 2.997-5.023 2.997c-2.532 
                                0-4.361-1.868-4.361-5.062 c0-4.749 3.504-9.071 9.111-9.071c1.713 0 3.7 0.4 4.6 0.973l-1.169 
                                7.203c-0.388 2.298-0.116 3.3 1 3.4 c1.673 0 3.773-2.102 3.773-6.58c0-5.061-3.27-8.994-9.303-8.994c-5.957 
                                0-11.175 4.673-11.175 12.1 c0 6.5 4.2 10.2 10 10.201c1.986 0 4.089-0.43 5.646-1.245L20.111 
                                26.147z M16.646 10.1 c-0.311-0.078-0.701-0.155-1.207-0.155c-2.571 0-4.595 2.53-4.595 5.529c0 
                                1.5 0.7 2.4 1.9 2.4 c1.441 0 2.959-1.828 3.311-4.087L16.646 10.068z"></path>
                        </g>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Twitter" class="twitter compact">
            <a href="http://twitter.com/home?status=COM+in+plain+C%2c+Part+3+-+CodeProject+-+https%3a%2f%2fwww.codeproject.com%2fArticles%2f14037%2fCOM-in-plain-C-Part-3" class="popup">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32
                        c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155
                        C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965
                        C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683
                        c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851
                        C26.275,7.229,25.39,8.196,24.253,8.756z"></path>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Facebook" class="facebook compact">
            
            <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.codeproject.com%2fArticles%2f14037%2fCOM-in-plain-C-Part-3" class="popup">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                        <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434
                            c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726
                            c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"></path>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_LinkedIn" class="linkedin compact">
            <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.codeproject.com%2fArticles%2f14037%2fCOM-in-plain-C-Part-3&amp;title=COM+in+plain+C%2c+Part+3+-+CodeProject&amp;summary=&amp;source=codeproject.com" class="popup">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                        <path d="M25.424,15.887v8.447h-4.896v-7.882c0-1.979-0.709-3.331-2.48-3.331c-1.354,0-2.158,0.911-2.514,1.803
                            c-0.129,0.315-0.162,0.753-0.162,1.194v8.216h-4.899c0,0,0.066-13.349,0-14.731h4.899v2.088c-0.01,0.016-0.023,0.032-0.033,0.048
                            h0.033V11.69c0.65-1.002,1.812-2.435,4.414-2.435C23.008,9.254,25.424,11.361,25.424,15.887z M5.348,2.501
                            c-1.676,0-2.772,1.092-2.772,2.539c0,1.421,1.066,2.538,2.717,2.546h0.032c1.709,0,2.771-1.132,2.771-2.546
                            C8.054,3.593,7.019,2.501,5.343,2.501H5.348z M2.867,24.334h4.897V9.603H2.867V24.334z"></path>
                    </svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Reddit" class="reddit compact">
            <a href="http://www.reddit.com/submit?url=https%3a%2f%2fwww.codeproject.com%2fArticles%2f14037%2fCOM-in-plain-C-Part-3&amp;title=COM+in+plain+C%2c+Part+3+-+CodeProject">
                <span class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve"><g>
                    <path d="M11.794 15.316c0-1.029-0.835-1.895-1.866-1.895c-1.03 0-1.893 0.865-1.893 1.895s0.863 1.9 1.9 1.9 C10.958 17.2 11.8 16.3 11.8 15.316z"></path>
                    <path d="M18.1 13.422c-1.029 0-1.895 0.864-1.895 1.895c0 1 0.9 1.9 1.9 1.865c1.031 0 1.869-0.836 1.869-1.865 C19.969 14.3 19.1 13.4 18.1 13.422z"></path>
                    <path d="M17.527 19.791c-0.678 0.678-1.826 1.006-3.514 1.006c-0.004 0-0.009 0-0.014 0c-0.004 0-0.01 0-0.015 0 
                    c-1.686 0-2.834-0.328-3.51-1.005c-0.264-0.265-0.693-0.265-0.958 0c-0.264 0.265-0.264 0.7 0 1 c0.943 0.9 2.4 1.4 
                    4.5 1.402c0.005 0 0 0 0 0c0.005 0 0 0 0 0c2.066 0 3.527-0.459 4.47-1.402 c0.265-0.264 0.265-0.693 0.002-0.958C18.221 
                    19.5 17.8 19.5 17.5 19.791z"></path><path d="M27.707 13.267c0-1.785-1.453-3.237-3.236-3.237c-0.793 0-1.518 0.287-2.082 
                    0.761c-2.039-1.295-4.646-2.069-7.438-2.219 l1.483-4.691l4.062 0.956c0.071 1.4 1.3 2.6 2.7 2.555c1.488 0 2.695-1.208 
                    2.695-2.695C25.881 3.2 24.7 2 23.2 2 c-1.059 0-1.979 0.616-2.42 1.508l-4.633-1.091c-0.344-0.081-0.693 0.118-0.803 
                    0.455l-1.793 5.7 C10.548 8.6 7.7 9.4 5.6 10.75C5.006 10.3 4.3 10 3.5 10.029c-1.785 0-3.237 1.452-3.237 3.2 c0 1.1 0.6 
                    2.1 1.4 2.69c-0.04 0.272-0.061 0.551-0.061 0.831c0 2.3 1.3 4.4 3.7 5.9 c2.299 1.5 5.3 2.3 8.6 2.325c3.228 0 6.271-0.825 
                    8.571-2.325c2.387-1.56 3.7-3.66 3.7-5.917 c0-0.26-0.016-0.514-0.051-0.768C27.088 15.5 27.7 14.4 27.7 13.267z M23.186 
                    3.355c0.74 0 1.3 0.6 1.3 1.3 c0 0.738-0.6 1.34-1.34 1.34s-1.342-0.602-1.342-1.34C21.844 4 22.4 3.4 23.2 3.355z M1.648 
                    13.3 c0-1.038 0.844-1.882 1.882-1.882c0.31 0 0.6 0.1 0.9 0.209c-1.049 0.868-1.813 1.861-2.26 2.9 C1.832 14.2 1.6 13.8 1.6 
                    13.267z M21.773 21.57c-2.082 1.357-4.863 2.105-7.831 2.105c-2.967 0-5.747-0.748-7.828-2.105 
                    c-1.991-1.301-3.088-3-3.088-4.782c0-1.784 1.097-3.484 3.088-4.784c2.081-1.358 4.861-2.106 7.828-2.106 c2.967 0 5.7 
                    0.7 7.8 2.106c1.99 1.3 3.1 3 3.1 4.784C24.859 18.6 23.8 20.3 21.8 21.57z M25.787 14.6 
                    c-0.432-1.084-1.191-2.095-2.244-2.977c0.273-0.156 0.59-0.245 0.928-0.245c1.035 0 1.9 0.8 1.9 1.9 
                    C26.354 13.8 26.1 14.3 25.8 14.605z"></path></g></svg>
                </span>
                
            </a>
        </li><li id="ctl00_SocialLike_Pinterest" class="pinterest compact">
            <a href="http://pinterest.com/pin/create/bookmarklet/?is_video=false&amp;url=https%3a%2f%2fwww.codeproject.com%2fArticles%2f14037%2fCOM-in-plain-C-Part-3&amp;description=COM+in+plain+C%2c+Part+3+-+CodeProject">
                <span class="icon">
                    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <path d="M14.021,1.57C6.96,1.57,1.236,7.293,1.236,14.355c0,7.062,5.724,12.785,12.785,12.785c7.061,0,12.785-5.725,12.785-12.785
                        C26.807,7.294,21.082,1.57,14.021,1.57z M15.261,18.655c-1.161-0.09-1.649-0.666-2.559-1.219c-0.501,2.626-1.113,5.145-2.925,6.458
                        c-0.559-3.971,0.822-6.951,1.462-10.116c-1.093-1.84,0.132-5.545,2.438-4.632c2.837,1.123-2.458,6.842,1.099,7.557
                        c3.711,0.744,5.227-6.439,2.925-8.775c-3.325-3.374-9.678-0.077-8.897,4.754c0.19,1.178,1.408,1.538,0.489,3.168
                        C7.165,15.378,6.53,13.7,6.611,11.462c0.131-3.662,3.291-6.227,6.46-6.582c4.007-0.448,7.771,1.474,8.29,5.239
                        c0.579,4.255-1.816,8.865-6.102,8.533L15.261,18.655z"></path>
                    </svg>
                </span>
                
            </a>
        </li>

    </ul>



				        </div> 
    			        
                        <h2 id="ctl00_AboutHeading">About the Author</h2>
						    

<div class="author-wrapper">

    <div class="pic-wrapper"> 
        <img id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberPhoto" class="profile-pic" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/member_unknown.gif" style="border-width:0px;transform:rotate(1deg);">
    </div>

    <div class="container-member">  
        <b><a id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberProfileLink" class="author" href="https://www.codeproject.com/Members/Jeff-Glatt">Jeff Glatt</a></b>

        <table>
        <tbody><tr>
            <td rowspan="2" valign="middle" nowrap="nowrap">
            
            </td>
            <td nowrap="nowrap">
                <div class="company">
                    <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberJobTitle"></span>
	                <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberCompany"></span>
                </div>
            </td>
            <td rowspan="2" style="padding-left:15px">
                <a id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_FollowMember_FollowBtn" title="" class="button unfollowed align-center invisible tooltip" data-enabletooltip="true" data-tooltip="Have the articles and posts from this member appear in your Timeline so you can stay up to date." style="display: inline-block;">Follow<div class="tiny-text" style="margin-top:-3px;">this Member</div><div class="speech-bubble-container-up" style="width:150px">  <div class="speech-bubble-up" style="text-align:center"> Have the articles and posts from this member appear in your Timeline so you can stay up to date.</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></a>
	<a id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_FollowMember_UnfollowBtn" title="" class="button followed align-center invisible tooltip" data-enabletooltip="true" data-tooltip="Stop following this Member" style="display:none;">Unfollow<div class="speech-bubble-container-up" style="width:150px">  <div class="speech-bubble-up" style="text-align:center"> Stop following this Member</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></a>

            </td>
        </tr>
        <tr>
            <td>
                <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberLocation">United States <img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/US.gif" alt="United States" width="16px" height="11px"></span>
            </td>
        </tr>
        </tbody></table>
    </div>

    <div class="description">
        No Biography provided

        
    </div>

</div><br>
						
						

						<div class="clearfix"></div>

						<div style="padding-top:8px">
							
						</div>

					

				    
					</form>

				</div>

				
				<div class="bottom-promo"> 
				    <div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Platforms-Frameworks-Libraries/COM-COMplus/COM" data-country="US" data-loadonview="true" data-tags="C++, C, VBScript, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5,pos_bottom" data-cookieconsent="true"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Platforms-Frameworks-Libraries/COM-COMplus/COM&sz=728x90&c=971274"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Platforms-Frameworks-Libraries/COM-COMplus/COM&sz=728x90&c=971274"  width="728px" height="90px" target="_blank"/></a></noscript></div>
				</div>
				
                
                

				
				

					<h2>Comments and Discussions</h2>
					<a class="float-left" name="_comments" id="_comments">&nbsp;</a><div id="_MessageBoardctl00_MessageBoard" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(event, null)">
<table id="ForumTable" class="forum relaxed" cellspacing="0" cellpadding="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="3px" border="0">
<tbody><tr class="header1">
<td colspan="2" style="white-space:nowrap;"><div class="container">
<div class="button new-message compose float-left">
<a rel="nofollow" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;floc=/Articles/14037/COM-in-plain-C-Part-3" name="Frm_HoverNL" target="_top">Add a Comment or Question&nbsp;</a>
</div><div class="admin-links float-left align-middle" style="width:90px;line-height:24px;margin-top:4px;">
&nbsp;<a href="https://www.codeproject.com/KB/FAQs/MessageBoardsFAQ.aspx"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/help_sm.png" title="FAQ" alt="FAQ" style="border-width:0;width:16px;height:16px;vertical-align:middle;"></a>
</div><div class="float-right">
<form action="/Search.aspx?sbo=fm" method="get" class="searchbar">
<input type="hidden" name="fid" value="302281"><input type="hidden" name="sbo" value="fm"><input id="search_forumCtrl_ctl00_MessageBoard" type="search" class="search subdue" autocomplete="off" name="qf" value="Search Comments"><input type="image" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/search.gif">
</form>
</div><div class="tooltip email-alert" id="ctl00_MessageBoard_SubscribeDiv">
	<span class="nowrap medium-text">Email Alerts</span><div class="tooltip-flyout" style="width: 335px;margin-top: 24px;left: -270px;padding: 7px;">
		<b>Email me</b><input type="checkbox" id="ctl00_MessageBoard_SubscribeNew"><label for="ctl00_MessageBoard_SubscribeNew">New Posts</label><input type="checkbox" id="ctl00_MessageBoard_SubscribeReplies"><label for="ctl00_MessageBoard_SubscribeReplies">Replies to Posts</label><br><br><b>Send them</b><input type="radio" name="ctl00$MessageBoard_SubscribeSchedule" id="ctl00_MessageBoard_SubscribeInstant"><label for="ctl00_MessageBoard_SubscribeInstant">Instantly</label><input type="radio" name="ctl00$MessageBoard_SubscribeSchedule" id="ctl00_MessageBoard_SubscribeDaily"><label for="ctl00_MessageBoard_SubscribeDaily">Daily</label>&nbsp; <b>For</b> <select id="ctl00_MessageBoard_MessageType" class="tiny-text" style="width:80px;">
			<option value="0" selected="selected">
				All Types
			</option><option value="128">
				Announcements
			</option>
		</select><button class="button safe float-right update">Update</button>
	</div>
</div>
</div></td>
</tr><tr class="header2">
<td></td><td style="width:100%;"><div style="text-align:right;">
<form action="/script/Forums/SetOptions.aspx?floc=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3&amp;fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;prof=True" method="get" style="margin:0;padding:0;">
<input type="hidden" name="fid" value="302281"><input type="hidden" name="currentQS" value="floc=%2fArticles%2f14037%2fCOM-in-plain-C-Part-3&amp;fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;prof=True"><input type="hidden" name="floc" value="/Articles/14037/COM-in-plain-C-Part-3">Spacing<select size="1" class="dropdown" name="spc">
<option selected="selected" value="Relaxed">Relaxed</option><option value="Compact">Compact</option><option value="Tight">Tight</option>
</select>&nbsp;&nbsp;Layout<select size="1" class="dropdown" name="view">
<option selected="selected" value="Normal">Normal</option><option value="Topic">Open Topics</option><option value="Expanded">Open All</option><option value="Thread">Thread View</option>
</select>&nbsp;&nbsp;Per page<select size="1" class="dropdown" name="mpp">
<option value="10">10</option><option selected="selected" value="25">25</option><option value="50">50</option>
</select>&nbsp;&nbsp;&nbsp;<input type="submit" value="Update" name="SetOpt" class="button">
</form>
</div></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><a name="xx0xx"></a><table width="100%" cellspacing="0" cellpadding="2px" border="0">
<tbody><tr class="navbar">
<td></td><td style="text-align:right;width:50%;"></td><td style="text-align:right;white-space:nowrap;"><span class="nav-link disabled">First</span> <span class="nav-link disabled">Prev</span> <span class="nav-link disabled">Next</span></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><table class="fixed-layout blank-background" width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr id="F4481834_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4481834xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_question.gif" alt="Question" title="Question" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="4481834" parent="0" thread="4481834" href="https://www.codeproject.com/Messages/4481834/In-the-IExample4-function-next-may-less-some-sente.aspx">In the IExample4, function "next" may less some sentences</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">ligand</span><span class="date">27-Jan-13  21:59</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=3756817">ligand</a></span></td><td class="date"><span>27-Jan-13  21:59&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4481834_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="3756817" msgid="4481834" votingtype="GoodOrBad" done="true"><a href="#xx4481834xx" onclick="return rateItem(5, 4481834,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',3756817);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx4481834xx" onclick="return rateItem(1, 4481834,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',3756817);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2"><div class="pre-action-link" id="premain635352" style="width:100%;display:block;"><span id="prehide635352" onclick="processCodeBlocks.togglePre(635352);">Hide</span>  &nbsp; <span id="preShrink635352" onclick="processCodeBlocks.shrinkExpand(635352);">Shrink</span> <img id="preimg635352" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(635352);">  &nbsp; <span id="copycode635352" onclick="return processCodeBlocks.copyCode(635352);">Copy Code</span></div><pre id="pre635352" style="margin-top: 0px;" class="notranslate" lang="c++">count = <span class="code-digit">0</span>;

	<span class="code-comment">//</span><span class="code-comment"> Any more items left?</span>
	<span class="code-keyword">if</span> (item)
	{
		<span class="code-comment">//</span><span class="code-comment"> Retrieve the next numItemsDesired items</span>
		<span class="code-keyword">while</span> (item &amp;&amp; numItemsDesired--)
		{
			<span class="code-comment">//</span><span class="code-comment"> If what we're returning to the caller is an object, we must AddRef()</span>
			<span class="code-comment">//</span><span class="code-comment"> it on the caller's behalf. The caller is expected to Release() it</span>
			<span class="code-comment">//</span><span class="code-comment"> when done with it. If what we're returning is a BSTR, then we must</span>
			<span class="code-comment">//</span><span class="code-comment"> SysAllocString a copy of it. Caller is expected to SysFreeString it.</span>
			<span class="code-comment">//</span><span class="code-comment"> Other datatypes are simply copied to the caller's VARIANT as is.</span>
			<span class="code-comment">//</span><span class="code-comment"> VariantCopy() does all this for us</span>
			VariantCopy(&amp;rgVar[count], &amp;item-&gt;value);

			<span class="code-comment">//</span><span class="code-comment"> Another item fetched</span>
			++count;
		}</pre><br>
<br>
It seems loss some necessary sentences to alter the "item" pointer to 
point the next one.  In the test applications of IExample4.vbs and 
"IExmaple4App",  the "next" function only return one item. Thus that 
error is not exposed. If you use "next" function in  "IExmaple4App" with
 the parameter "numItemsDesired" greater than 1, you will find the 
results always the "Port 1". The correct souce code should be <br>
<br>
<br>
<div class="pre-action-link" id="premain152380" style="width:100%;display:block;"><span id="prehide152380" onclick="processCodeBlocks.togglePre(152380);">Hide</span>  &nbsp; <span id="preShrink152380" onclick="processCodeBlocks.shrinkExpand(152380);">Shrink</span> <img id="preimg152380" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(152380);">  &nbsp; <span id="copycode152380" onclick="return processCodeBlocks.copyCode(152380);">Copy Code</span></div><pre id="pre152380" style="margin-top: 0px;" class="notranslate" lang="c++">count = <span class="code-digit">0</span>;

	<span class="code-comment">//</span><span class="code-comment"> Any more items left?</span>
	<span class="code-keyword">if</span> (item)
	{
		<span class="code-comment">//</span><span class="code-comment"> Retrieve the next numItemsDesired items</span>
		<span class="code-keyword">while</span> (item &amp;&amp; numItemsDesired--)
		{
			<span class="code-comment">//</span><span class="code-comment"> If what we're returning to the caller is an object, we must AddRef()</span>
			<span class="code-comment">//</span><span class="code-comment"> it on the caller's behalf. The caller is expected to Release() it</span>
			<span class="code-comment">//</span><span class="code-comment"> when done with it. If what we're returning is a BSTR, then we must</span>
			<span class="code-comment">//</span><span class="code-comment"> SysAllocString a copy of it. Caller is expected to SysFreeString it.</span>
			<span class="code-comment">//</span><span class="code-comment"> Other datatypes are simply copied to the caller's VARIANT as is.</span>
			<span class="code-comment">//</span><span class="code-comment"> VariantCopy() does all this for us</span>
			VariantCopy(&amp;rgVar[count], &amp;item-&gt;value);

			<span class="code-comment">//</span><span class="code-comment"> Another item fetched</span>
			++count;
                        <b>item = item-&gt;next;</b>
		}</pre><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=4481834&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a class="nav-link" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=4481834&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=e" title="Send the author a private email" rel="nofollow noopener">Email</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=4481834" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF4481834" data-ref="3_4481834" class="rating-label" name="RateItem_4481834"><span class="rating-result"><span></span></span></span><a href="https://www.codeproject.com/Messages/4481834/In-the-IExample4-function-next-may-less-some-sente.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_4481834"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="3756817" msgid="4481834"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3678268_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="20px"><a name="xx3678268xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="3678268" parent="0" thread="3678268" href="https://www.codeproject.com/Messages/3678268/My-vote-of-5.aspx">My vote of 5</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">yao2007</span><span class="date">26-Nov-10  5:00</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=5666108">yao2007</a></span></td><td class="date"><span>26-Nov-10  5:00&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3678268_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="5666108" msgid="3678268" votingtype="GoodOrBad" done="true"><a href="#xx3678268xx" onclick="return rateItem(5, 3678268,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',5666108);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx3678268xx" onclick="return rateItem(1, 3678268,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',5666108);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2">Excellent<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=3678268&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3678268" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF3678268" data-ref="3_3678268" class="rating-label" name="RateItem_3678268"><span class="rating-result"><span></span></span></span><a href="https://www.codeproject.com/Messages/3678268/My-vote-of-5.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_3678268"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="5666108" msgid="3678268"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3674547_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="20px"><a name="xx3674547xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="3674547" parent="0" thread="3674547" href="https://www.codeproject.com/Messages/3674547/My-vote-of-5.aspx">My vote of 5</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">yao2007</span><span class="date">23-Nov-10  6:12</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=5666108">yao2007</a></span></td><td class="date"><span>23-Nov-10  6:12&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3674547_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="5666108" msgid="3674547" votingtype="GoodOrBad" done="true"><a href="#xx3674547xx" onclick="return rateItem(5, 3674547,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',5666108);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx3674547xx" onclick="return rateItem(1, 3674547,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',5666108);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2">excellent<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=3674547&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3674547" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF3674547" data-ref="3_3674547" class="rating-label" name="RateItem_3674547"><span class="rating-result"><span></span></span></span><a href="https://www.codeproject.com/Messages/3674547/My-vote-of-5.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_3674547"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="5666108" msgid="3674547"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3300391_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="20px"><a name="xx3300391xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="3300391" parent="0" thread="3300391" href="https://www.codeproject.com/Messages/3300391/Trivial-typos.aspx">Trivial typos</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">Hou Tianze</span><span class="date">10-Dec-09  23:08</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=2407417">Hou Tianze</a></span></td><td class="date"><span>10-Dec-09  23:08&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3300391_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="2407417" msgid="3300391" votingtype="GoodOrBad" done="true"><a href="#xx3300391xx" onclick="return rateItem(5, 3300391,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',2407417);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx3300391xx" onclick="return rateItem(1, 3300391,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',2407417);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2">In line 6 of IExample3\IExample3.vbs:<br>
Typo: MsgBox <b>coll.(i)</b><br>
Fix:  MsgBox <b>coll(i)</b><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=3300391&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a class="nav-link" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=3300391&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=e" title="Send the author a private email" rel="nofollow noopener">Email</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3300391" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF3300391" data-ref="3_3300391" class="rating-label" name="RateItem_3300391"><span class="rating-result"><span></span></span></span><a href="https://www.codeproject.com/Messages/3300391/Trivial-typos.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_3300391"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="2407417" msgid="3300391"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3054623_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="20px"><a name="xx3054623xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="3054623" parent="0" thread="3054623" href="https://www.codeproject.com/Messages/3054623/Nothing-of-examples-works-properly.aspx">Nothing of examples works properly</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">Member 1669820</span><span class="date">26-May-09  9:10</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=1669820">Member 1669820</a></span></td><td class="date"><span>26-May-09  9:10&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3054623_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="1669820" msgid="3054623" votingtype="GoodOrBad" done="true"><a href="#xx3054623xx" onclick="return rateItem(5, 3054623,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',1669820);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx3054623xx" onclick="return rateItem(1, 3054623,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',1669820);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2">I've compiled some of them using VS. But when I've tryed
 to register some DLLs from examples in Component Serivce I've got only a
 message that the DLL contains no components or classes. I've tryed the 
example that by description can register a DLL. But when I try it I get a
 message of succesful registration for any DLL but realy such succesful 
registration has no effects, because the list of available components (I
 need to use some ActiveX in Matlab) doesn't change after it. <br>
<br>
<div class="ForumSig">cogito ergo sum</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=3054623&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3054623" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF3054623" data-ref="3_3054623" class="rating-label" name="RateItem_3054623"><span class="rating-result"><span></span></span></span><a href="https://www.codeproject.com/Messages/3054623/Nothing-of-examples-works-properly.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_3054623"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="1669820" msgid="3054623"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F3300394_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="38px"><a name="xx3300394xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="3300394" parent="3054623" thread="3054623" href="https://www.codeproject.com/Messages/3300394/Re-Nothing-of-examples-works-properly.aspx">Re: Nothing of examples works properly</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">Hou Tianze</span><span class="date">10-Dec-09  23:12</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=2407417">Hou Tianze</a></span></td><td class="date"><span>10-Dec-09  23:12&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F3300394_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><span class="voteform vertical" ownerid="2407417" msgid="3300394" votingtype="GoodOrBad" done="true"><a href="#xx3300394xx" onclick="return rateItem(5, 3300394,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',2407417);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx3300394xx" onclick="return rateItem(1, 3300394,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',2407417);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,3054623);" href="https://www.codeproject.com/Messages/3054623/Nothing-of-examples-works-properly.aspx"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>You
 need to do a find-and-replace over the regiexample2 for example 3, 4, 5
 to register the COM *.dlls. You can't use regsvr32 to register, because
 there is DllRegisterServer() function exported/implemented int the 
example code.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=3300394&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a class="nav-link" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=3300394&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=e" title="Send the author a private email" rel="nofollow noopener">Email</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=3054623" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF3300394" data-ref="3_3300394" class="rating-label" name="RateItem_3300394"><span class="rating-result"><span></span></span></span><a href="https://www.codeproject.com/Messages/3300394/Re-Nothing-of-examples-works-properly.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_3300394"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="2407417" msgid="3300394"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2694350_h0" class="header hover-row root">
<td class="subject-line normal vote-hi" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="20px"><a name="xx2694350xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="2694350" parent="0" thread="2694350" href="https://www.codeproject.com/Messages/2694350/Link-error-error-LNK2005-IID-ICollection-already-d.aspx">Link error:error LNK2005: _IID_ICollection already defined in IExample3.obj</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">Member 4298929</span><span class="date">26-Aug-08  9:11</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=4298929">Member 4298929</a></span></td><td class="date"><span>26-Aug-08  9:11&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2694350_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="4298929" msgid="2694350" votingtype="GoodOrBad" done="true"><a href="#xx2694350xx" onclick="return rateItem(5, 2694350,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',4298929);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx2694350xx" onclick="return rateItem(1, 2694350,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',4298929);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2">when i compiled IExample3, some link errors appeared, why?<br>
<br>
--------------------Configuration: IExample3 - Win32 Debug--------------------<br>
Linking...<br>
PortNames.obj : error LNK2005: _IID_ICollection already defined in IExample3.obj<br>
PortNames.obj : error LNK2005: _IID_IExample3 already defined in IExample3.obj<br>
PortNames.obj : error LNK2005: _CLSID_IExample3 already defined in IExample3.obj<br>
PortNames.obj : error LNK2005: _CLSID_TypeLib already defined in IExample3.obj<br>
PortNames.obj : warning LNK4006: _IID_ICollection already defined in IExample3.obj; second definition ignored<br>
PortNames.obj : warning LNK4006: _IID_IExample3 already defined in IExample3.obj; second definition ignored<br>
PortNames.obj : warning LNK4006: _CLSID_IExample3 already defined in IExample3.obj; second definition ignored<br>
PortNames.obj : warning LNK4006: _CLSID_TypeLib already defined in IExample3.obj; second definition ignored<br>
   Creating library Debug/IExample3.lib and object Debug/IExample3.exp<br>
Debug/IExample3.dll : fatal error LNK1169: one or more multiply defined symbols found<br>
Error executing link.exe.<br>
<br>
IExample3.dll - 5 error(s), 4 warning(s)<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=2694350&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a class="nav-link" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=2694350&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=e" title="Send the author a private email" rel="nofollow noopener">Email</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2694350" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF2694350" data-ref="3_2694350" class="rating-label" name="RateItem_2694350"><span class="rating-result"><span>5.00/5 (2 votes)</span></span></span><a href="https://www.codeproject.com/Messages/2694350/Link-error-error-LNK2005-IID-ICollection-already-d.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_2694350"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="4298929" msgid="2694350"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2695622_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="38px"><a name="xx2695622xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="2695622" parent="2694350" thread="2694350" href="https://www.codeproject.com/Messages/2695622/Re-I-solve-this-problem.aspx">Re: I solve this problem</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">Member 4298929</span><span class="date">27-Aug-08  3:33</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=4298929">Member 4298929</a></span></td><td class="date"><span>27-Aug-08  3:33&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2695622_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><span class="voteform vertical" ownerid="4298929" msgid="2695622" votingtype="GoodOrBad" done="true"><a href="#xx2695622xx" onclick="return rateItem(5, 2695622,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',4298929);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx2695622xx" onclick="return rateItem(1, 2695622,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',4298929);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,2694350);" href="https://www.codeproject.com/Messages/2694350/Link-error-error-LNK2005-IID-ICollection-already-d.aspx"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Just include file "initguid.h" in file "PortNames.c", before include &lt;objbase.h&gt;<br>
<br>
just like this:<br>
#include &lt;windows.h&gt;<br>
#include &lt;initguid.h&gt;<br>
#include &lt;objbase.h&gt;<br>
#include "IExample3.h"<br>
#include "PortNames.h"<br>
<br>
<br>
delete the "include &lt;initguid.h&gt;" in file "IExample3.h"<br>
<br>
Good luck!!!<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=2695622&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a class="nav-link" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=2695622&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=e" title="Send the author a private email" rel="nofollow noopener">Email</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2694350" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF2695622" data-ref="3_2695622" class="rating-label" name="RateItem_2695622"><span class="rating-result"><span></span></span></span><a href="https://www.codeproject.com/Messages/2695622/Re-I-solve-this-problem.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_2695622"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="4298929" msgid="2695622"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F2207042_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="20px"><a name="xx2207042xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="2207042" parent="0" thread="2207042" href="https://www.codeproject.com/Messages/2207042/IExample4-lost-something.aspx">IExample4 lost something</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">scz</span><span class="date">31-Aug-07  5:04</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=986372">scz</a></span></td><td class="date"><span>31-Aug-07  5:04&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F2207042_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="986372" msgid="2207042" votingtype="GoodOrBad" done="true"><a href="#xx2207042xx" onclick="return rateItem(5, 2207042,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',986372);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx2207042xx" onclick="return rateItem(1, 2207042,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',986372);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2">Your IExample4 of com_in_c3_src.zip lost something, it's
 not working code. At least, where is IEnumVariant.h, where is struct 
IENUMVARIANT?<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=2207042&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a class="nav-link" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=2207042&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=e" title="Send the author a private email" rel="nofollow noopener">Email</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2207042" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF2207042" data-ref="3_2207042" class="rating-label" name="RateItem_2207042"><span class="rating-result"><span></span></span></span><a href="https://www.codeproject.com/Messages/2207042/IExample4-lost-something.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_2207042"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="986372" msgid="2207042"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F5100101_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="38px"><a name="xx5100101xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="5100101" parent="2207042" thread="2207042" href="https://www.codeproject.com/Messages/5100101/Re-IExample4-lost-something.aspx">Re: IExample4 lost something</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">while loop</span><span class="date">30-Jul-15  2:10</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=3568099">while loop</a></span></td><td class="date"><span>30-Jul-15  2:10&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5100101_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><span class="voteform vertical" ownerid="3568099" msgid="5100101" votingtype="GoodOrBad" done="true"><a href="#xx5100101xx" onclick="return rateItem(5, 5100101,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',3568099);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx5100101xx" onclick="return rateItem(1, 5100101,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',3568099);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,2207042);" href="https://www.codeproject.com/Messages/2207042/IExample4-lost-something.aspx"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>IENUMVARIANT in IEnumVariant.c is the same as MyRealIEnumVariant in PortNames.c<br>
For example4, IEnumVariant.c is redundant. The Next and Skip functions 
in PortNames.c still have bugs but they are not difficult to be fixed.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=5100101&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a class="nav-link" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=5100101&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=e" title="Send the author a private email" rel="nofollow noopener">Email</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=2207042" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF5100101" data-ref="3_5100101" class="rating-label" name="RateItem_5100101"><span class="rating-result"><span></span></span></span><a href="https://www.codeproject.com/Messages/5100101/Re-IExample4-lost-something.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_5100101"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="3568099" msgid="5100101"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1636153_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="20px"><a name="xx1636153xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="1636153" parent="0" thread="1636153" href="https://www.codeproject.com/Messages/1636153/About-of-freeCollectionTypeInfo.aspx">About of freeCollectionTypeInfo</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">Black.Stone</span><span class="date">22-Aug-06  5:52</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=55612">Black.Stone</a></span></td><td class="date"><span>22-Aug-06  5:52&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1636153_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="55612" msgid="1636153" votingtype="GoodOrBad" done="true"><a href="#xx1636153xx" onclick="return rateItem(5, 1636153,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',55612);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx1636153xx" onclick="return rateItem(1, 1636153,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',55612);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2">Should the helper funtion's body  be is as so?<br>
void freeCollectionTypeInfo(void)<br>
{<br>
   if (CollectionTypeInfo)<br>
       CollectionTypeInfo-&gt;lpVtbl-&gt;<code>Release</code>(CollectionTypeInfo);<br>
}<br>
 <br>
<br>
<div class="ForumSig">I'm sorry for my poor english!</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=1636153&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a class="nav-link" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=1636153&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=e" title="Send the author a private email" rel="nofollow noopener">Email</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1636153" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF1636153" data-ref="3_1636153" class="rating-label" name="RateItem_1636153"><span class="rating-result"><span></span></span></span><a href="https://www.codeproject.com/Messages/1636153/About-of-freeCollectionTypeInfo.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_1636153"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="55612" msgid="1636153"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1637139_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="38px"><a name="xx1637139xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="1637139" parent="1636153" thread="1636153" href="https://www.codeproject.com/Messages/1637139/Re-About-of-freeCollectionTypeInfo.aspx">Re: About of freeCollectionTypeInfo</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">22-Aug-06  15:44</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>22-Aug-06  15:44&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1637139_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><span class="voteform vertical" ownerid="88625" msgid="1637139" votingtype="GoodOrBad" done="true"><a href="#xx1637139xx" onclick="return rateItem(5, 1637139,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',88625);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx1637139xx" onclick="return rateItem(1, 1637139,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',88625);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1636153);" href="https://www.codeproject.com/Messages/1636153/About-of-freeCollectionTypeInfo.aspx"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Oops. Yes, it should be a call to Release, instead of AddRef.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=1637139&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a class="nav-link" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=1637139&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=e" title="Send the author a private email" rel="nofollow noopener">Email</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1636153" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF1637139" data-ref="3_1637139" class="rating-label" name="RateItem_1637139"><span class="rating-result"><span></span></span></span><a href="https://www.codeproject.com/Messages/1637139/Re-About-of-freeCollectionTypeInfo.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_1637139"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="88625" msgid="1637139"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1478132_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="20px"><a name="xx1478132xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="1478132" parent="0" thread="1478132" href="https://www.codeproject.com/Messages/1478132/Definition-of-a-collection.aspx">Definition of a collection</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">Vlad Vissoultchev</span><span class="date">8-May-06  9:09</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=68200">Vlad Vissoultchev</a></span></td><td class="date"><span>8-May-06  9:09&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1478132_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><span class="voteform vertical" ownerid="68200" msgid="1478132" votingtype="GoodOrBad" done="true"><a href="#xx1478132xx" onclick="return rateItem(5, 1478132,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',68200);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx1478132xx" onclick="return rateItem(1, 1478132,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',68200);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2">The only required part is the dispinterface to have a method with DISPID_NEWENUM (-4).<br>
<br>
There is no requirement on the method name -- NewEnum, _NewEnum, MyEnum,
 whatever. Also usually it's marked as hidden in the typelib but this is
 not a requirement. There is no requirement for Count, Item, Add, 
Remove, Clear or whatever props/methods. Usually DISPID_VALUE (0) is 
used on the Item property for convenience when consumed -- m_oCol(3) 
instead of m_oCol.Item(3). E.g. some of the Shell and AD interfaces 
don't have Item/Count props but do support DISPID_NEWENUM through 
IDispatch.<br>
<br>
So basicly your complaints on the wrong design are baseless when most of
 the things are not part of the design per se. I agree that IEnumXxxx 
class of interfaces usually encapsulate just a current pointer, but one 
has to realize that collections (IEnumVARIANT based) are a convenience 
for "higher" COM consumer languages, not C/C++.<br>
<br>
cheers,<br>
&lt;/wqw&gt;<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=1478132&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a class="nav-link" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=1478132&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=e" title="Send the author a private email" rel="nofollow noopener">Email</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1478132" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF1478132" data-ref="3_1478132" class="rating-label" name="RateItem_1478132"><span class="rating-result"><span></span></span></span><a href="https://www.codeproject.com/Messages/1478132/Definition-of-a-collection.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_1478132"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="68200" msgid="1478132"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1478681_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="38px"><a name="xx1478681xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="1478681" parent="1478132" thread="1478132" href="https://www.codeproject.com/Messages/1478681/Re-Definition-of-a-collection.aspx">Re: Definition of a collection</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">Jeff Glatt</span><span class="date">8-May-06  14:20</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=88625">Jeff Glatt</a></span></td><td class="date"><span>8-May-06  14:20&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1478681_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><span class="voteform vertical" ownerid="88625" msgid="1478681" votingtype="GoodOrBad" done="true"><a href="#xx1478681xx" onclick="return rateItem(5, 1478681,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',88625);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx1478681xx" onclick="return rateItem(1, 1478681,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',88625);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1478132);" href="https://www.codeproject.com/Messages/1478132/Definition-of-a-collection.aspx"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Yes,
 I do know that there is no requirement for Add or Remove (and I never 
described them as "required" in my article). I never mentioned a Clear 
method at all. As far as the other comments:<br>
<br>
I refer you to <a href="http://msdn.microsoft.com/library/default.asp?url=/archive/en-us/dnarguion/html/drgui042099.asp" rel="nofollow noopener">http://msdn.microsoft.com/library/default.asp?url=/archive/en-us/dnarguion/html/drgui042099.asp</a>[<a href="http://msdn.microsoft.com/library/default.asp?url=/archive/en-us/dnarguion/html/drgui042099.asp" target="_blank" rel="nofollow noopener" title="New Window">^</a>]<br>
<br>
Note the URL. And pertinent excerpts from the article:<br>
<br>
"The simplest standard way to access the data [in a collection] is to expose a property called Count and a method called Item."<br>
<br>
"Collections that are compatible with For Each must have a method called
 _NewEnum that has the dispid DISPID_NEWENUM. Note that the leading 
underscore in the name _NewEnum indicates that the method should be 
hidden from object browsers."<br>
<br>
Here's another URL (and again note where it comes from):<br>
<br>
<a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dncomg/html/msdn_cpptocom.asp" rel="nofollow noopener">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dncomg/html/msdn_cpptocom.asp</a>[<a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dncomg/html/msdn_cpptocom.asp" target="_blank" rel="nofollow noopener" title="New Window">^</a>]<br>
<br>
And pertinent quotes:<br>
<br>
"Collection objects have a Count property that allows users to determine
 the number of items in a collection. You should provide your collection
 object with this property."<br>
<br>
"Collection objects have an Item(Index) property."<br>
<br>
"In order to support [a For Each loop], a collection object needs to have a hidden method that is defined in IDL as follows:<br>
<br>
[id(0xfffffffc)] HRESULT _NewEnum([out, retval] IUnknown** ppunk);<br>
<br>
The method name must be '_NewEnum'."<br>
<br>
Here's an except about ATL collections. Granted, an ATL collection is 
not necessarily a COM collection, but since ATL is very, very often used
 to create COM components, it does tend to speak to the design of a COM 
collection. <a href="http://msdn2.microsoft.com/en-us/library/x416d0xc.aspx" rel="nofollow noopener">http://msdn2.microsoft.com/en-us/library/x416d0xc.aspx</a>[<a href="http://msdn2.microsoft.com/en-us/library/x416d0xc.aspx" target="_blank" rel="nofollow noopener" title="New Window">^</a>]<br>
<br>
"At a minimum, collection interfaces must provide a Count property that 
returns the number of items in the collection, an Item property that 
returns an item from the collection based on an index, and a _NewEnum 
property that returns an enumerator for the collection."<br>
<br>
I did a search and did not come up with any MSDN document about COM 
collections that supports your assertations. In fact, as shown above, 
there is MSDN documentation that contradicts such, and supports what I 
stated in my article. Now, it certainly may be the case that there are 
script engines and applications out there whose only requirement of a 
COM Collection is that it meet your minimum requirements. (After all, 
why would an engine need both a collection's Item function as well as an
 IEnumVARIANT's Next?) And there may certainly be Microsoft components 
that adhere only to those minimum standards. But MSDN documentation 
confirms that your minimum requirements are not the "standard" design, 
and does not state the opposite.<br>
<br>
Ironically, it seems that you've come up with more examples where 
Microsoft is schizophrenic when it comes to COM software design (one 
group states something should be done as so, and another group does 
exactly the opposite. That's bound to happen at such a large software 
house).<br>
<br>
I therefore do stand by my comments/complaints, and disagree that they are "baseless".<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=1478681&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a class="nav-link" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=1478681&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=e" title="Send the author a private email" rel="nofollow noopener">Email</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1478132" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF1478681" data-ref="3_1478681" class="rating-label" name="RateItem_1478681"><span class="rating-result"><span></span></span></span><a href="https://www.codeproject.com/Messages/1478681/Re-Definition-of-a-collection.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_1478681"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="88625" msgid="1478681"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F1480171_h0" class="header hover-row">
<td class="subject-line normal vote-hi" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td class="indent" width="56px"><a name="xx1480171xx"></a><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" title="General" width="16px" height="16px" align="top"></td><td class="subject hover-container"><a class="message-link" name="1480171" parent="1478681" thread="1478132" href="https://www.codeproject.com/Messages/1480171/Re-Definition-of-a-collection.aspx">Re: Definition of a collection</a> <a onclick="return forumCtrl_ctl00_MessageBoard.Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/pin.png" alt="Pin" width="13px" height="13px" border="0" align="top"></a><div class="mobile-only">
	<span class="author">Vlad Vissoultchev</span><span class="date">9-May-06  11:40</span>
</div></td><td class="icon"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/icn-member-16.gif" title="Member" alt="Member" height="16px" border="0"></td><td class="author"><span><a href="https://www.codeproject.com/script/Membership/View.aspx?mid=68200">Vlad Vissoultchev</a></span></td><td class="date"><span>9-May-06  11:40&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F1480171_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"><span class="voteform vertical" ownerid="68200" msgid="1480171" votingtype="GoodOrBad" done="true"><a href="#xx1480171xx" onclick="return rateItem(5, 1480171,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',68200);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" width="16px" height="16px" border="0" align="absmiddle"></a>
<br><a href="#xx1480171xx" onclick="return rateItem(1, 1480171,3,0, false, true, 0, 'TextOnly', 'GoodOrBad',68200);" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" width="16px" height="16px" border="0" align="absmiddle"></a>
</span></td><td class="text"><table width="100%" cellspacing="5px" cellpadding="0" border="0">
<tbody><tr>
<td><table width="100%" cellspacing="0" cellpadding="0" border="0">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow noopener" onclick="return forumCtrl_ctl00_MessageBoard.SwitchMessage(null,1478681);" href="https://www.codeproject.com/Messages/1478681/Re-Definition-of-a-collection.aspx"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>I
 see what you mean. My point is that a collection is a coclass that has a
 DISPID_NEWENUM method on the default dispinterface. This is everything 
that's required for a VB6/VBScript client to use For Each operator.<br>
<br>
There are collections with no Item/Count properties. Or the enumerator 
property is not hidden, or the enumerator property is with arbitrary 
name. I've seen ones with ItemByPosition property and 
Filter/Clear/ClearAll methods. The standard VB6 Collection has Item and 
Count methods (not properties). But these still are collections in the 
sense that they can be looped with For Each.<br>
<br>
The URLs you refer to do not "nail" the design -- these comment on 
common practices. The design seems to be loose but gives kind of 
implementation flexability. One can supercharge a collection coclass 
with utility props/methods.<br>
<br>
Wrinting a C/C++ consumer one has to call 
IDispatch::Invoke(DISPID_NEWENUM) to get an IEnumVARIANT interface to an
 enumerator -- kind of clumsy -- and this is the only supported way to 
emulate For Each syntax on an arbitrary collection. One can't depend on 
_NewEnum name, or early-bound calls, or early/late-bound calls to Item 
or Count properties.<br>
<br>
In fact VB6 supports implementing collection classes, but _NewEnum is 
not a valid name for a property so the common way is to expose just 
NewEnum/WhatEver and mark it as hidden -- it makes no difference to the 
consumers.<br>
<br>
cheers,<br>
&lt;/wqw&gt;<br>
<br>
 -- modified at 10:41 Tuesday 9th May, 2006<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=1480171&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=r" title="Reply" rel="nofollow noopener">Reply</a>Â·<wbr><a class="nav-link" href="https://www.codeproject.com/script/Forums/Edit.aspx?fid=302281&amp;select=1480171&amp;floc=/Articles/14037/COM-in-plain-C-Part-3&amp;action=e" title="Send the author a private email" rel="nofollow noopener">Email</a>Â·<wbr><a href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;tid=1478132" title="View&nbsp;Thread" rel="nofollow noopener">View&nbsp;Thread</a></td><td style="text-align:right;"><span id="MVF1480171" data-ref="3_1480171" class="rating-label" name="RateItem_1480171"><span class="rating-result"><span>5.00/5 (1 vote)</span></span></span><a href="https://www.codeproject.com/Messages/1480171/Re-Definition-of-a-collection.aspx" title="Get permanent link" style="border:0 !important" rel="nofollow noopener"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/link32.png" style="width:14px;height:14px;border:0"></a>&nbsp;<span data-type="bookmark" data-size="small" data-ref="3_1480171"><span data-direction="up-right" title="" data-enabletooltip="true" data-tooltip="bookmark this" class="tooltip"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;border:none;cursor:pointer;"><div class="speech-bubble-container-up-right" style="width:150px">  <div class="speech-bubble-up-right" style="text-align:center"> bookmark this</div>  <div class="speech-bubble-pointer-up-right">    <div class="speech-bubble-pointer-up-right-inner"></div>  </div></div></span></span>&nbsp;<span class="reportform" ownerid="68200" msgid="1480171"></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><table width="100%" cellspacing="0" cellpadding="2px">
<tbody><tr class="footer">
<td><span class="last-visit desktop-only tablet-only">Last Visit: 14-Jan-20  11:58 &nbsp; &nbsp; Last Update: 14-Jan-20  12:13</span></td><td><a rel="nofollow" href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;prof=True&amp;view=Normal">Refresh</a></td><td style="text-align:right;white-space:nowrap;"><input id="_mbnUrl" type="hidden" value="/Articles/14037/COM-in-plain-C-Part-3?fid=302281&amp;df=90&amp;mpp=25&amp;sort=Position&amp;spc=Relaxed&amp;prof=True&amp;view=Normal&amp;fr=16"><span class="nav-link selected">1</span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table>
</div><p class="small-text"><img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_general.gif" alt="General" width="16px" height="16px" align="top"> General &nbsp;&nbsp; <img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_news.gif" alt="News" width="16px" height="16px" align="top"> News &nbsp;&nbsp; <img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_idea.gif" alt="Suggestion" width="16px" height="16px" align="top"> Suggestion &nbsp;&nbsp; <img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_question.gif" alt="Question" width="16px" height="16px" align="top"> Question &nbsp;&nbsp; <img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_bug.gif" alt="Bug" width="16px" height="16px" align="top"> Bug &nbsp;&nbsp; <img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_answer.gif" alt="Answer" width="16px" height="16px" align="top"> Answer &nbsp;&nbsp; <img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_joke.gif" alt="Joke" width="16px" height="16px" align="top"> Joke &nbsp;&nbsp; <img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_kudos.gif" alt="Praise" width="16px" height="16px" align="top"> Praise &nbsp;&nbsp; <img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_rant.gif" alt="Rant" width="16px" height="16px" align="top"> Rant &nbsp;&nbsp; <img src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/msg_admin.gif" alt="Admin" width="16px" height="16px" align="top"> Admin &nbsp;&nbsp; </p><p class="small-text">Use Ctrl+Left/Right to switch messages, Ctrl+Up/Down to switch threads, Ctrl+Shift+Left/Right to switch pages.</p>
				

			</div>
			

			
		    <div id="ctl00_LeftSideBar" class="article-left-sidebar">

                <div id="ctl00_StickyBlock" class="article-left-sidebar-inner">
                    
    		        

<div class="tabs">
	<div class=" selected">Article</div>
<div class="browse-code"><a href="https://www.codeproject.com/script/Articles/ViewDownloads.aspx?aid=14037">Browse Code</a></div>
<div><a href="https://www.codeproject.com/script/Articles/Statistics.aspx?aid=14037">View Stats</a></div>
<div><a href="https://www.codeproject.com/script/Articles/ListVersions.aspx?aid=14037">Revisions</a></div>
<div><a href="#_comments">Comments (15)</a></div>
<div>Posted 7 May 2006</div>


    
</div>



			        

			        <div>
                        <h4 id="ctl00_TaggedAsWrapper">Tagged as</h4>
			            <span id="ctl00_TagList_TagWrp" class="tags vertical">

	
	

	
	<span id="ctl00_TagList_VisibleTags"><div class="t tooltip" data-followinit="true" data-enabletooltip="true" data-tooltip="Click the star to follow this tag" data-width="125px" title=""><img class="follow" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/follow.png" width="12px" height="12px"><a rel="tag" href="https://www.codeproject.com/Tags/Cplusplus" data-id="78">C++</a><div class="speech-bubble-container-up" style="width:125px">  <div class="speech-bubble-up" style="text-align:center"> Click the star to follow this tag</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></div><div class="t tooltip" data-followinit="true" data-enabletooltip="true" data-tooltip="Click the star to follow this tag" data-width="125px" title=""><img class="follow" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/follow.png" width="12px" height="12px"><a rel="tag" href="https://www.codeproject.com/Tags/C" data-id="80">C</a><div class="speech-bubble-container-up" style="width:125px">  <div class="speech-bubble-up" style="text-align:center"> Click the star to follow this tag</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></div><div class="t tooltip" data-followinit="true" data-enabletooltip="true" data-tooltip="Click the star to follow this tag" data-width="125px" title=""><img class="follow" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/follow.png" width="12px" height="12px"><a rel="tag" href="https://www.codeproject.com/Tags/VBScript" data-id="86">VBScript</a><div class="speech-bubble-container-up" style="width:125px">  <div class="speech-bubble-up" style="text-align:center"> Click the star to follow this tag</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></div><div class="t tooltip" data-followinit="true" data-enabletooltip="true" data-tooltip="Click the star to follow this tag" data-width="125px" title=""><img class="follow" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/follow.png" width="12px" height="12px"><a rel="tag" href="https://www.codeproject.com/Tags/Windows" data-id="94">Windows</a><div class="speech-bubble-container-up" style="width:125px">  <div class="speech-bubble-up" style="text-align:center"> Click the star to follow this tag</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></div><div class="t tooltip" data-followinit="true" data-enabletooltip="true" data-tooltip="Click the star to follow this tag" data-width="125px" title=""><img class="follow" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/follow.png" width="12px" height="12px"><a rel="tag" href="https://www.codeproject.com/Tags/Visual-Studio" data-id="103">Visual-Studio</a><div class="speech-bubble-container-up" style="width:125px">  <div class="speech-bubble-up" style="text-align:center"> Click the star to follow this tag</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></div><div class="t tooltip" data-followinit="true" data-enabletooltip="true" data-tooltip="Click the star to follow this tag" data-width="125px" title=""><img class="follow" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/follow.png" width="12px" height="12px"><a rel="tag" href="https://www.codeproject.com/Tags/COM" data-id="130">COM</a><div class="speech-bubble-container-up" style="width:125px">  <div class="speech-bubble-up" style="text-align:center"> Click the star to follow this tag</div>  <div class="speech-bubble-pointer-up">    <div class="speech-bubble-pointer-up-inner"></div>  </div></div></div></span> 

	
	
</span>


			        </div>

                    <div id="ctl00_VerticalStatsWrapper" class="stats">
                    <h4>Stats</h4>
                    <div id="ctl00_VerticalStats"><div class="stats"><div>93.3K views</div><div>2.1K downloads</div><div>114 bookmarked</div></div></div>
                    </div>

                    
                </div>
		    </div>
            

            
            <div id="ctl00_RightSideBar" class="article-right-sidebar">

                <div id="RHSticky" class="container-article-info-sticky">
        		    

<div class="article-summary">

    
    

</div>

				    <div id="ctl00_SectionSponsor" class="padded-top" style="width:160px;margin:10px auto">
					    <div class="msg-160x200" data-format="160x200" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Platforms-Frameworks-Libraries/COM-COMplus/COM" data-country="US" data-showindicator="true" data-tags="C++, C, VBScript, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5" data-cookieconsent="true"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Platforms-Frameworks-Libraries/COM-COMplus/COM&sz=160x200&c=908512"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Platforms-Frameworks-Libraries/COM-COMplus/COM&sz=160x200&c=908512"  width="160px" height="200px" target="_blank"/></a></noscript></div>
				    </div>

				    <div style="width:160px;margin: 10px auto;">
					    <div class="msg-160x600" data-format="160x600" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="Platforms-Frameworks-Libraries/COM-COMplus/COM" data-country="US" data-tags="C++, C, VBScript, Windows, Visual-Studio, Dev, COM, Beginner,rating4.5" data-cookieconsent="true"><noscript><a href="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Platforms-Frameworks-Libraries/COM-COMplus/COM&sz=160x600&c=908512"><img src="https://pubads.g.doubleclick.net/gampad/jump?iu=/6839/lqm.codeproject.site/Platforms-Frameworks-Libraries/COM-COMplus/COM&sz=160x600&c=908512"  width="160px" height="600px" target="_blank"/></a></noscript></div>
				    </div>

                    

				    

				    

                    <div class="anchorLink gototop" id="gototop">
                        <a id="ctl00_GoToTop" href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3#_articleTop">Go to top</a>
                    </div>

			    </div>
            </div>
            

        </div>
        

		
		<div class="theme1-background" style="height:2px;margin:5px 0" id="stickyStop"></div>

		<div class="site-footer">
			<div class="align-left">
				<a id="ctl00_PermaLink" href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3">Permalink</a><br>
				<a id="ctl00_AdvertiseLink" href="http://developermedia.com/">Advertise </a><br>
				<a id="ctl00_PrivacyLink" href="https://www.codeproject.com/info/privacy.aspx">Privacy</a><br>
    			<a id="ctl00_CookiePolicyLink" href="https://www.codeproject.com/info/cookie.aspx">Cookies</a><br>
                <a id="ctl00_TermsOfUseLink" href="https://www.codeproject.com/info/TermsOfUse.aspx">Terms of Use</a><br>
			</div>

            <div class="align-center">
				


<div class="page-width">
    Layout: <a id="ctl00_PageWidth_FixedT" title="Fixed width layout" rel="nofollow" class=" active" href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?PageFlow=FixedWidth">fixed</a>
    |
    <a id="ctl00_PageWidth_FluidT" title="Fluid layout" rel="nofollow" href="https://www.codeproject.com/Articles/14037/COM-in-plain-C-Part-3?PageFlow=Fluid">fluid</a>
</div>


				

				

	            

                <br>
			</div>
                
			<div class="align-right">
				Article Copyright 2006 by Jeff Glatt<br>Everything else
				Copyright Â© <a href="mailto:webmaster@codeproject.com">CodeProject</a>, 1999-2020 <br>
                <br>
				Web03 
				2.8.200113.1<br>
			</div>
		</div>
		

		<br clear="all">
		
			

	</div> 
	</div> 
</div>



<img id="ctl00_Audience" src="COM%20in%20plain%20C,%20Part%203%20-%20CodeProject_files/DFPAudiencePixel.gif" style="border-width:0px;height:1px;width:1px;">



<script type="text/javascript"> // IMMEDIATE script

var readLaterList

var notificationAlert

var followService_ctl00_ActionLinks_ArticleFollow;

var bookmark_medium_true_false_ = null;

function PostBack_ctl00_RateArticle_RateItemWrapper() {
  return rateItem(null, 14037,2,1,true,true,0,'LargeStars', null, 88625);
}

function getVotesHistogram(objectId, objectTypeId, containerId, loadingId) {
                        if (!$('#' + containerId).attr('alreadyRequested')){
                            $.ajax({
                                url: '/script/Ratings/Ajax/Histogram.aspx?obid=' + objectId + '&obtid='+objectTypeId+'&wd=130',
                            })
                            .done(function (data) {
                                $('#' + containerId).html(data);
                                $('#' + loadingId).hide();
                            });

                            $('#' + containerId).attr('alreadyRequested', 'true');
                        }
                    }

document.addEventListener('DOMContentLoaded', function() {
  $('#ctl00_RateArticle_SubmitRateBtn').hide();
});
function ChkRtctl00_RateArticle(val) {
}

var followService_ctl00_AboutAuthorRptr_ctl00_AboutAuthor_FollowMember;

var forumConfig_ctl00_MessageBoard;
var forumCtrl_ctl00_MessageBoard;
var forumCtrl_ctl00_MessageBoard_forumMsgFlag;

var subscriptionConfig_ctl00_MessageBoard = {
 ParentId      : 'ctl00_MessageBoard_SubscribeDiv',
 NewId         : 'ctl00_MessageBoard_SubscribeNew',
 ReplyId       : 'ctl00_MessageBoard_SubscribeReplies',
 InstantId     : 'ctl00_MessageBoard_SubscribeInstant',
 DailyId       : 'ctl00_MessageBoard_SubscribeDaily',
 MessageTypeId : 'ctl00_MessageBoard_MessageType',
 GetInfoUrl    : '/script/Forums/WebServices/ForumSubscriptionServices.aspx/GetSubscriptions',
 UpdateInfoUrl : '/script/Forums/WebServices/ForumSubscriptionServices.aspx/UpdateSubscription',
 ForumId       : 302281,
};
var subscriptions_ctl00_MessageBoard;
</script>

<script type="text/javascript"> // DEFERRED script

document.addEventListener('DOMContentLoaded', function() {

	processCodeBlocks.Initialise('#contentdiv');
	
	$('.author-wrapper .description').shorten({showChars: 400});
	
	anchorAnimate();
	$('#RHSticky').sticky($('#stickyStop'));
	$('#ctl00_StickyBlock').sticky($('#stickyStop'));
	
	$('#__EVENTVALIDATION').attr('autocomplete', 'off');
	
	readLaterList = new ReadLaterList('ReadLaterListIcon', 'ItemsToRead','/script/Bookmarks/WebServices/BookmarkService.aspx','https://codeproject.freetls.fastly.net/App_Themes/CodeProject/Img/','/script/Bookmarks/Ajax/Add.aspx?obrfgd=%5bObjectRefGuid%5d&bis=small',true);
	readLaterList.initialise();
	
	notificationAlert = new NotificationAlert('ctl00_MemberBar_Messages_NotificationCount','Notifications','/script/Membership/Ajax/NotificationList.aspx');
	notificationAlert.initialise();
	
	var oSrchFlt = false, oSrchBox=false, srchBoxFoc=false;
	var sbar     = $('#sb_tb');
	var sfilter  = $('#SearchFilter');
	
	if (typeof(InitWatermark) !== 'undefined')
	  InitWatermark('sb_tb', 'Search for articles, questions, tips');
	if (sbar && sfilter) {
	  sfilter.removeClass('popup'); sfilter.hide(); sfilter.removeClass('open');
	  sbar.blur(function() {
	    if (!oSrchFlt) { sfilter.hide(); sfilter.removeClass('open'); }
	    srchBoxFoc = false;
	  });
	  sbar.focus(function() {
	    oSrchFlt   = false;
	    srchBoxFoc = true;
	    sfilter.show();
	    sfilter.addClass('open');
	  });
	  sbar.mouseleave(function()    { oSrchBox = false; });
	  sbar.mouseover(function()     { oSrchBox = true; });
	  sfilter.mouseleave(function() {
	    oSrchFlt=false;
	    if (!srchBoxFoc && !oSrchBox) { sfilter.hide(); sfilter.removeClass('open'); }
	  });
	  sfilter.mouseover(function()  { oSrchFlt = true; });
	}
	
	followService_ctl00_ActionLinks_ArticleFollow = new FollowService('/script/follow/webservices/followServices.aspx/', true);
	followService_ctl00_ActionLinks_ArticleFollow.initFollowObjectButtons({
	    item : { 
	        objectTypeId   : 2,
	        objectId       : 14037
	    },
	    followButtonId   : 'ctl00_ActionLinks_ArticleFollow_FollowBtn',
	    unfollowButtonId : 'ctl00_ActionLinks_ArticleFollow_UnfollowBtn'
	}, false);
	
	bookmark_medium_true_false_ = new Bookmark('[data-type="bookmark"]','https://codeproject.freetls.fastly.net/App_Themes/CodeProject/Img/','/script/Bookmarks/Ajax/Add.aspx?obrfgd=%5bObjectRefGuid%5d&bis=medium',false,true);
	bookmark_medium_true_false_.Initialise();
	
	$('#clear-rate_ctl00_RateArticle_RCD').click(function () {    $('#ctl00_RateArticle_RCD').hide(); return false;});
	
	new starRating('#ctl00_RateArticle_RateItemWrapper', PostBack_ctl00_RateArticle_RateItemWrapper,'ctl00_RateArticle');
	  $('#ctl00_RateArticle_VR').mouseenter(function() {     getVotesHistogram(14037,2   ,'ctl00_RateArticle_HistogramR','ctl00_RateArticle_LoadingR');
	  });
	
	followService_ctl00_AboutAuthorRptr_ctl00_AboutAuthor_FollowMember = new FollowService('/script/follow/webservices/followServices.aspx/', true);
	followService_ctl00_AboutAuthorRptr_ctl00_AboutAuthor_FollowMember.initFollowObjectButtons({
	    item : { 
	        objectTypeId   : 1,
	        objectId       : 88625
	    },
	    followButtonId   : 'ctl00_AboutAuthorRptr_ctl00_AboutAuthor_FollowMember_FollowBtn',
	    unfollowButtonId : 'ctl00_AboutAuthorRptr_ctl00_AboutAuthor_FollowMember_UnfollowBtn'
	}, false);
	
	forumConfig_ctl00_MessageBoard = {
	    objectName          : 'forumCtrl_ctl00_MessageBoard',
	    messageTypeId       : 3,
	    searchPrompt        : 'Search Comments',
	    smoothScroll        : true,
	    allowReporting      : false,
	    allowRating         : true,
	    allowRatingDisplay  : true,
	    forumDir            : '/script/Forums/',
	    staticServer        : 'https://codeproject.freetls.fastly.net',
	    switchMsgCallback   : null,
	    getVoteFormMethod   : getVoteFormHtml,
	    getReportFormMethod : getReportFormHtml,
	    voteHiThreshold     : 5 - 0.5,
	    getRatingUrl        : '/script/Ratings/Ajax/GetRatings.aspx',
	    getRatingRefKey     : 'obrs',
	    reportOptions       : [
	       { reportTypeId : 19, name : 'Abusive / Trolling'},
	       { reportTypeId : 20, name : 'Inappropriate'},
	       { reportTypeId : 5, name : 'Spam'},
	    ],
	};
	forumCtrl_ctl00_MessageBoard = new ForumControl(forumConfig_ctl00_MessageBoard, -1);
	forumCtrl_ctl00_MessageBoard.Initialise();
	
	subscriptions_ctl00_MessageBoard = new Subscriptions(subscriptionConfig_ctl00_MessageBoard);
	subscriptions_ctl00_MessageBoard.initialise();
	
	var followService = new FollowService('/script/follow/webservices/followServices.aspx/', true);
	var followAttributeIds = [];
	followService.initAttributeUI(undefined, followAttributeIds);

})
</script>










<style type="text/css">.copied::after {  position: absolute;  display: inline-block;  content: 'copied'; color: #fff; background-color: #f90;  border-radius: 3px; padding:1px 3px; opacity: 0;  will-change: opacity, transform; animation: showcopied 1.5s ease; } @keyframes showcopied { 0% { opacity: 0; transform: translateX(-100%); } 70% { opacity: 1; transform: translateX(0); } 100% { opacity: 0; } } </style><style type="text/css">.copied::after {  position: absolute;  display: inline-block;  content: 'copied'; color: #fff; background-color: #f90;  border-radius: 3px; padding:1px 3px; opacity: 0;  will-change: opacity, transform; animation: showcopied 1.5s ease; } @keyframes showcopied { 0% { opacity: 0; transform: translateX(-100%); } 70% { opacity: 1; transform: translateX(0); } 100% { opacity: 0; } } </style><canvas id="cv1" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><canvas id="cv2" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><div id="MemberProfilePopupDiv" class="raised box" style="display: none; position: absolute;"></div><div id="MemberProfilePopupDiv" class="raised box" style="display: none; position: absolute;"></div><div id="MemberProfilePopupDiv" class="raised box" style="display: none; position: absolute;"></div></body></html>